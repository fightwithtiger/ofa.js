/*!
* ofa v3.0.0
* https://github.com/kirakiray/ofa.js
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(glo=>{"use strict";const getRandomId=()=>Math.random().toString(32).substr(2);var objectToString=Object.prototype.toString,getType=e=>objectToString.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const isFunction=e=>getType(e).search("function")>-1;var isEmptyObj=e=>!Object.keys(e).length;const defineProperties=Object.defineProperties,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,isxdata=e=>e instanceof XData,isDebug=null!==document.currentScript.getAttribute("debug"),nextTick=(()=>{if(isDebug){let e=new Map;return(t,r)=>{r||(r=getRandomId());let a=e.get(r);clearTimeout(a),e.set(r,setTimeout(()=>{t(),e.delete(r)}))}}let e=new Map,t=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(t=process.nextTick);let r=!1;return(a,s)=>{s||(s=getRandomId()),e.set(s,{key:s,fun:a}),r||(r=!0,t(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),r=!1}))}})(),collect=e=>{let t=[];const r=a=>{t.push(a),nextTick(()=>{e(t),t.length=0},r)};return r},extend=(e,t)=>{Object.keys(t).forEach(r=>{let{get:a,set:s,value:n}=getOwnPropertyDescriptor(t,r);n?e.hasOwnProperty(r)?e[r]=n:Object.defineProperty(e,r,{value:n}):Object.defineProperty(e,r,{get:a,set:s})})},startTime=Date.now(),XDATASELF=Symbol("self"),WATCHS=Symbol("watchs"),CANUPDATE=Symbol("can_update"),cansetXtatus=new Set(["root","sub","revoke"]),emitUpdate=(e,t)=>{e[WATCHS].forEach(e=>e(t)),e.owner.forEach(e=>emitUpdate(e,t))};class XData{constructor(e,t){let r;e.get?(r=new Proxy(this,{get:e.get,ownKeys:e.ownKeys,getOwnPropertyDescriptor:e.getOwnPropertyDescriptor,set:xdataHandler.set}),delete e.get,delete e.ownKeys,delete e.getOwnPropertyDescriptor):r=new Proxy(this,xdataHandler);let a=t;defineProperties(this,{[XDATASELF]:{value:this},xid:{value:"x_"+getRandomId()},_xtatus:{get:()=>a,set(e){if(!cansetXtatus.has(e))throw{target:r,desc:`xtatus not allowed to be set ${e}`};const t=this.owner.size;if("revoke"===e&&t)throw{target:r,desc:"the owner is not empty"};if("revoke"===a&&"revoke"!==e)t||fixXDataOwner(this);else if("sub"===a&&"root"===e)throw{target:r,desc:"cannot modify sub to root"};a=e}},owner:{value:new Set},length:{configurable:!0,writable:!0,value:0},[WATCHS]:{value:new Map},[CANUPDATE]:{writable:!0,value:0}});let s=-1;return Object.keys(e).forEach(t=>{let a=getOwnPropertyDescriptor(e,t),{value:n,get:i,set:l}=a;"get"!==t&&(/\D/.test(t)||(t=parseInt(t))>s&&(s=t),i||l?defineProperties(this,{[t]:a}):r[t]=n)}),s>-1&&(this.length=s+1),this[CANUPDATE]=1,r}watch(e){const t="e_"+getRandomId();return this[WATCHS].set(t,e),t}unwatch(e){return this[WATCHS].delete(e)}setData(e,t){let r=getType(t);"array"!=r&&"object"!=r||(t=createXData(t,"sub")).owner.add(this);const a=this[e];if(a===t)return!0;let s=Reflect.set(this,e,t);return this[CANUPDATE]&&emitUpdate(this,{xid:this.xid,name:"setData",args:[e,t]}),clearXDataOwner(a,this),s}delete(e){if(/^_/.test(e)||"symbol"==typeof e)return Reflect.deleteProperty(this,e);if(!e)return!1;const t=this[XDATASELF];let r=t[e];clearXDataOwner(r,t);let a=Reflect.deleteProperty(t,e);return emitUpdate(this,{xid:this.xid,name:"delete",args:[e]}),a}}const xdataHandler={set:(e,t,r,a)=>"symbol"==typeof t?Reflect.set(e,t,r,a):/^_/.test(t)?(e.hasOwnProperty(t)?Reflect.set(e,t,r,a):defineProperties(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0):e.setData(t,r),deleteProperty:function(e,t){return e.delete(t)}},clearXDataOwner=(e,t)=>{if(!isxdata(e))return;const{owner:r}=e;r.delete(t),r.size||(e._xtatus="revoke",Object.values(e).forEach(t=>{clearXDataOwner(t,e[XDATASELF])}))},fixXDataOwner=e=>{"revoke"===e._xtatus&&Object.values(e).forEach(t=>{isxdata(t)&&(fixXDataOwner(t),t.owner.add(e),t._xtatus="sub")})},createXData=(e,t="root")=>isxdata(e)?(e._xtatus=t,e):new XData(e,t);extend(XData.prototype,{seek(e){let t=[];if(!isFunction(e)){let t=new Function(`with(this){return ${e}}`);e=(e=>{try{return t.call(e,e)}catch(e){}})}return e.call(this,this)&&t.push(this),Object.values(this).forEach(r=>{isxdata(r)&&t.push(...r.seek(e))}),t},watchTick(e){return this.watch(collect(e))},watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r=new Function(`\n        try{with(this){\n            return ${e}\n        }}catch(e){}`).bind(this);const a=this.watch(()=>{let e=r();e&&(this.unwatch(a),t(e))})})},toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach(a=>{let s=this[a];/\D/.test(a)?t=!1:(a=parseInt(a))>r&&(r=a),isxdata(s)&&(s=s.toJSON()),e[a]=s}),t&&(e.length=r+1,e=Array.from(e));const a=this.xid;return defineProperties(e,{xid:{get:()=>a}}),e},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&defineProperties(XData.prototype,{[e]:{value:t}})});const arraySplice=Array.prototype.splice;extend(XData.prototype,{splice(e,t,...r){let a=this[XDATASELF];r=r.map(e=>{let t=getType(e);return"array"!=t&&"object"!=t||(e=createXData(e,"sub")).owner.add(a),e});let s=arraySplice.call(a,e,t,...r);return s.forEach(e=>clearXDataOwner(e,a)),emitUpdate(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),s},unshift(...e){return this.splice(0,0,...e),this.length},push(...e){return this.splice(this.length,0,...e),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(e=>{const t=Array.prototype[e];t&&defineProperties(XData.prototype,{[e]:{value(...r){let a=t.apply(this[XDATASELF],r);return emitUpdate(this,{xid:this.xid,name:e}),a}}})});const createXEle=e=>e?e.__xEle__?e.__xEle__:e.__xEle__=new XEle(e):null,meetTemp=document.createElement("template"),meetsEle=(e,t)=>!!e.tagName&&(e===t||e!==document&&(meetTemp.innerHTML=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`,!!meetTemp.content.querySelector(t))),parseStringToDom=e=>{const t=document.createElement("div");return t.innerHTML=e,Array.from(t.children).map(function(e){return t.removeChild(e),e})},parseDataToDom=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let r=0;for(;r in e;){let a=parseDataToDom(e[r]);t.appendChild(a),r++}return t},attrToProp=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),propToAttr=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),XEleHandler={get:(e,t,r)=>"string"!=typeof t||/\D/.test(t)?Reflect.get(e,t,r):createXEle(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},EVENTS=Symbol("events"),xSetData=XData.prototype.setData,xEleDefaultSetKeys=["text","html","show","style"],CANSETKEYS=Symbol("cansetkeys");class XEle extends XData{constructor(e){super(Object.assign({},XEleHandler));const t=this[XDATASELF];t.tag=e.tagName?e.tagName.toLowerCase():"",defineProperties(t,{ele:{get:()=>e},[EVENTS]:{writable:!0,value:""}}),delete t.length,"input"==t.tag&&renderInput(t)}setData(e,t){if(!this[CANSETKEYS]||this[CANSETKEYS].has(e))return xSetData.call(this,e,t)}get root(){return createXEle(this.ele.getRootNode())}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t?createXEle(t):null}get shadow(){return createXEle(this.ele.shadowRoot)}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?createXEle(e):null}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get length(){return this.ele.children.length}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get style(){return this.ele.style}set style(e){if("string"==getType(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),a=Object.keys(e);r.forEach(e=>{a.includes(e)||(t[e]="")}),Object.assign(t,e)}get show(){return"none"!==this.ele.style.display}set show(e){this.ele.style.display=e?"":"none"}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get next(){const e=this.ele.nextElementSibling;return e?createXEle(e):null}get prev(){const e=this.ele.previousElementSibling;return e?createXEle(e):null}$(e){const t=this.ele.querySelector(e);return t?createXEle(t):null}all(e){return Array.from(this.ele.querySelectorAll(e)).map(e=>createXEle(e))}is(e){return meetsEle(this.ele,e)}attr(...e){let[t,r]=e,{ele:a}=this;if(1==e.length)return t instanceof Object&&Object.keys(t).forEach(e=>{a.setAttribute(e,t[e])}),a.getAttribute(t);a.setAttribute(t,r)}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(meetsEle(t,e))return!0})),t.map(e=>createXEle(e))}parents(e,t){let r=[],a=this.parent;if(e){if("string"==getType(e))for(;a&&a;)meetsEle(a.ele,e)&&r.push(a),a=a.parent}else for(;a;)r.push(a),a=a.parent;if(t)if(t instanceof XEle){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==getType(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}clone(){let e=createXEle(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}}defineProperties(XEle.prototype,{[CANSETKEYS]:{value:new Set(xEleDefaultSetKeys)}});const renderInput=e=>{let t=e.attr("type")||"text";const{ele:r}=e;let a={type:{enumerable:!0,get:()=>t},name:{enumerable:!0,get:()=>r.name},value:{enumerable:!0,get:()=>r.value,set(e){r.value=e}},disabled:{enumerable:!0,get:()=>r.disabled,set(e){r.disabled=e}},[CANSETKEYS]:{value:new Set(["value","disabled",...xEleDefaultSetKeys])}};switch(t){case"radio":case"checkbox":Object.assign(a,{checked:{enumerable:!0,get:()=>r.checked,set(e){r.checked=e}},name:{enumerable:!0,get:()=>r.name}}),e.on("change",t=>{emitUpdate(e,{xid:e.xid,name:"setData",args:["checked",r.checked]})}),a[CANSETKEYS].value.add("checked");break;case"file":Object.assign(a,{accept:{enumerable:!0,get:()=>r.accept}});break;case"text":default:e.on("input",t=>{emitUpdate(e,{xid:e.xid,name:"setData",args:["value",r.value]})})}defineProperties(e,a)};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{const t=Array.prototype[e];t&&Object.defineProperty(XEle.prototype,e,{value(...e){return t.apply(Array.from(this.ele.children).map(createXEle),e)}})}),extend(XEle.prototype,{splice(e,t,...r){const{ele:a}=this,s=Array.from(a.children),n=[];let i=e,l=t,o=s[i];for(;o&&l>0;)n.push(o),a.removeChild(o),l--,o=s[++i];if(r.length){let t=document.createDocumentFragment();r.forEach(e=>{if(e instanceof Element)return void t.appendChild(e);if(e instanceof XEle)return void t.appendChild(e.ele);let r=getType(e);"string"==r?parseStringToDom(e).forEach(e=>{t.appendChild(e)}):"object"==r&&t.appendChild(parseDataToDom(e))}),e>=this.length?a.appendChild(t):a.insertBefore(t,a.children[e])}return emitUpdate(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),n},sort(e){const t=this.ele,r=Array.from(t.children).map(createXEle).sort(e);return rebuildXEleArray(t,r),emitUpdate(this,{xid:this.xid,name:"sort"}),this},reverse(){const e=this.ele,t=Array.from(e.children).reverse();return rebuildXEleArray(e,t),emitUpdate(this,{xid:this.xid,name:"reverse"}),this}});const rebuildXEleArray=(e,t)=>{const{children:r}=e;t.forEach((t,a)=>{let s=t.ele||t;const n=r[a];n?s!==n&&e.insertBefore(s,n):e.appendChild(s)})},getEventsMap=e=>e[EVENTS]?e[EVENTS]:e[EVENTS]=new Map,MOUSEEVENT=glo.MouseEvent||Event,TOUCHEVENT=glo.TouchEvent||Event,EventMap=new Map([["click",MOUSEEVENT],["mousedown",MOUSEEVENT],["mouseup",MOUSEEVENT],["mousemove",MOUSEEVENT],["mouseenter",MOUSEEVENT],["mouseleave",MOUSEEVENT],["touchstart",TOUCHEVENT],["touchend",TOUCHEVENT],["touchmove",TOUCHEVENT]]),triggerEvenet=(e,t,r,a=!0)=>{let s=EventMap.get(t)||CustomEvent;const n=t instanceof Event?t:new s(t,{bubbles:a,cancelable:!0});return n.data=r,e.ele.dispatchEvent(n)};extend(XEle.prototype,{on(e,t,r){if(isFunction(t))r=t,t=void 0;else{const e=r,{ele:a}=this;r=(r=>{let s;r.path?s=r.path:(s=createXEle(r.target).parents(null,a).map(e=>e.ele)).unshift(r.target),s.some(s=>{if(s==a)return!0;createXEle(s).is(t)&&(r.selector=s,e(r),delete r.selector)})})}this.ele.addEventListener(e,r);const a="e_"+getRandomId();return getEventsMap(this).set(a,{name:e,selector:t,callback:r}),a},off(e){let t=getEventsMap(this).get(e);return!!t&&(this.ele.removeEventListener(t.name,t.callback),this[EVENTS].delete(e),!0)},one(e,t,r){let a,s;return"string"==typeof t?(s=r,r=(e=>{s(e),this.off(a)})):(s=t,t=(e=>{s(e),this.off(a)})),a=this.on(e,t,r)},trigger(e,t){return triggerEvenet(this,e,t)},triggerHandler(e,t){return triggerEvenet(this,e,t,!1)}}),["click","focus","blur"].forEach(e=>{extend(XEle.prototype,{[e](t){if(!isFunction(t))return this.trigger(e,t);this.on(e,t)}})});const register=e=>{const t={tag:"",temp:"",attrs:{},data:{},watch:{},proto:{}};let r;if(Object.assign(t,e),t.temp){const e=transTemp(t.temp);t.temp=e.html,r=e.temps}const a=class extends XEle{constructor(e){super(e)}forceUpdate(){}};extend(a.prototype,t.proto);const s=getCansetKeys(t);defineProperties(a.prototype,{[CANSETKEYS]:{writable:!0,value:new Set([...xEleDefaultSetKeys,...s])}});customElements.define(t.tag,class extends HTMLElement{constructor(...e){super(...e);let s=this.__xEle__;s&&console.warn({target:s,desc:"please re-instantiate the object"}),this.__xEle__=new a(this);const n=createXEle(this);if(Object.assign(n,t.data,t.attrs),t.created&&t.created.call(n),t.temp){const e=this.attachShadow({mode:"open"});e.innerHTML=t.temp,renderTemp({host:n,xdata:n,content:e,temps:r}),t.ready&&t.ready.call(n)}}connectedCallback(){this.__x_connected=!0,t.attached&&!this.__x_runned_connected&&nexTick(()=>{this.__x_connected&&!this.__x_runned_connected&&(this.__x_runned_connected=!0,t.attached.call(createXEle(this)))})}disconnectedCallback(){this.__x_connected=!1,t.detached&&!this.__x_runnded_disconnected&&nexTick(()=>{this.__x_connected||this.__x_runnded_disconnected||(this.__x_runnded_disconnected=!0,t.detached.call(createXEle(this)))})}attributeChangedCallback(e,t,r){xele[attrToProp(e)]=r}static get observedAttributes(){return Object.keys(t.attrs).map(e=>propToAttr(e))}})},getCansetKeys=e=>{const{attrs:t,data:r,watch:a,proto:s}=e,n=[...Object.keys(t),...Object.keys(r),...Object.keys(a)],i=Object.getOwnPropertyDescriptors(s);return Object.keys(i).forEach(e=>{let{set:t}=i[e];t&&n.push(e)}),n},transTemp=e=>{var t=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);t&&t.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<x-span prop="${encodeURI(r[1])}"></x-span>`))});const r=document.createElement("template");r.innerHTML=e,Array.from(r.content.querySelectorAll("*")).forEach(e=>{const t={},r={},a={},s={},n=[],i={};let l="",o=[];Array.from(e.attributes).forEach(e=>{let{name:c,value:d}=e;if(/^if:/.exec(c))return l=d,void o.push(c);const p=/^attr:(.+)/.exec(c);if(p)return t[p[1]]=d,void o.push(c);const h=/^:(.+)/.exec(c);if(h)return r[h[1]]=d,void o.push(c);const u=/^sync:(.+)/.exec(c);if(u)return a[u[1]]=d,void o.push(c);const m=/^fill:(.+)/.exec(c);if(m)return n.push(m[1],d),void o.push(c);const f=/^item:(.+)/.exec(c);if(f)return i[f[1]]=d,void o.push(c);const g=/^@(.+)/.exec(c)||/^on:(.+)/.exec(c);return g?(s[g[1]]={name:d},void o.push(c)):void 0}),l&&e.setAttribute("x-if",l),!isEmptyObj(t)&&e.setAttribute("x-attr",JSON.stringify(t)),!isEmptyObj(r)&&e.setAttribute("x-prop",JSON.stringify(r)),!isEmptyObj(a)&&e.setAttribute("x-sync",JSON.stringify(a)),n.length&&e.setAttribute("x-fill",JSON.stringify(n)),!isEmptyObj(i)&&e.setAttribute("x-item",JSON.stringify(i)),!isEmptyObj(s)&&e.setAttribute("x-on",JSON.stringify(s)),o.forEach(t=>e.removeAttribute(t))}),Array.from(r.content.querySelectorAll("template")).forEach(e=>{e.innerHTML=transTemp(e.innerHTML).html}),wrapIfTemp(r);let a=new Map;return Array.from(r.content.querySelectorAll("template[name]")).forEach(e=>{a.set(e.getAttribute("name"),{ele:e,code:e.content.children[0].outerHTML}),e.parentNode.removeChild(e)}),{temps:a,html:r.innerHTML}},wrapIfTemp=e=>{e.content.querySelectorAll("[x-if]").forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");t.setAttribute("x-if",e.getAttribute("x-if")),e.removeAttribute("x-if"),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),Array.from(e.content.querySelectorAll("template")).forEach(wrapIfTemp)},getCanRenderEles=(e,t)=>{let r=Array.from(e.querySelectorAll(t));return e instanceof Element&&meetsEle(e,t)&&r.push(e),r},postionNode=e=>{let t=new Comment("x-marker"),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{marker:t,parent:r}},exprToFunc=e=>new Function("...$args",`\nconst [$event] = $args;\n\nwith(this){\n    return ${e};\n}\n    `),moveAttrExpr=(e,t,r)=>{e.removeAttribute(t);let a=e.__renderData;a||(a=e.__renderData={},e.setAttribute("x-rendered","")),a[t]=r},bindWatch=(e,t,r)=>{let a=e.watchTick(t);r.push({eid:a,target:e})},exprToSet=({xdata:e,host:t,expr:r,callback:a,isArray:s})=>{let n,i,l,o;n=regIsFuncExpr.test(r)?exprToFunc(r).bind(e):()=>e[r];const c=e=>{const t=n();if(isxdata(t))if(s){let r=t.map(e=>e&&e.xid?e.xid:e).join(",");l!==r&&(a({val:t,modifys:e}),l=r)}else{let r=t.toJSON();i===t&&r===o||(a({val:t,modifys:e}),o=r)}else i!==t&&(a({val:t,modifys:e}),o=null);i=t};c();const d=[];if(e instanceof XEle)bindWatch(e,c,d);else if(r.includes("$host"))r.includes("$index")&&bindWatch(e,c,d),bindWatch(t,c,d);else if(r.includes("$index")||r.includes("$item"))bindWatch(e,c,d),isxdata(e.$data)&&bindWatch(e.$data,c,d);else{if(!r.includes("$data"))throw{desc:"fill element must use $data $host $item or $index",target:t,expr:r};isxdata(e.$data)&&bindWatch(e.$data,c,d)}return d},addBindingData=(e,t)=>{(e.__bindings||(e.__bindings=[])).push(...t)},regIsFuncExpr=/[\(\)\;\.\=\>\<]/,elementDeepEach=(e,t)=>{Array.from(e.childNodes).forEach(e=>{t(e),e instanceof Element&&elementDeepEach(e,t)})},removeElementBind=e=>{elementDeepEach(e,e=>{e.__bindings&&e.__bindings.forEach(e=>{let{target:t,eid:r}=e;t.unwatch(r)})})},renderTemp=({host:e,xdata:t,content:r,temps:a})=>{getCanRenderEles(r,"[x-on]").forEach(e=>{let r=JSON.parse(e.getAttribute("x-on")),a=[];const s=createXEle(e);Object.keys(r).forEach(e=>{let n,{name:i}=r[e];if(regIsFuncExpr.test(i)){const r=exprToFunc(i);n=s.on(e,e=>{r.call(t,e)})}else n=s.on(e,e=>{t[i]&&t[i].call(t,e)});a.push(n)}),moveAttrExpr(e,"x-on",r)}),getCanRenderEles(r,"[x-attr]").forEach(r=>{const a=JSON.parse(r.getAttribute("x-attr"));moveAttrExpr(r,"x-attr",a),Object.keys(a).forEach(s=>{const n=exprToSet({xdata:t,host:e,expr:a[s],callback:({val:e})=>{r.setAttribute(s,e)}});addBindingData(r,n)})}),getCanRenderEles(r,"[x-prop]").forEach(r=>{const a=JSON.parse(r.getAttribute("x-prop")),s=createXEle(r);moveAttrExpr(r,"x-prop",a),Object.keys(a).forEach(n=>{const i=exprToSet({xdata:t,host:e,expr:a[n],callback:({val:e})=>{s[n]=e}});addBindingData(r,i)})}),getCanRenderEles(r,"[x-sync]").forEach(r=>{const a=JSON.parse(r.getAttribute("x-sync")),s=createXEle(r);Object.keys(a).forEach(n=>{let i=a[n];if(regIsFuncExpr.test(i))throw{desc:"sync only accepts attribute names"};const l=exprToSet({xdata:t,host:e,expr:i,callback:({val:e})=>{s[n]=e}}),o=exprToSet({xdata:s,host:e,expr:n,callback:({val:e})=>{t[i]=e}});addBindingData(r,[...l,...o])})}),getCanRenderEles(r,"x-span").forEach(r=>{let a=decodeURI(r.getAttribute("prop")),{marker:s,parent:n}=postionNode(r);const i=document.createTextNode("");n.replaceChild(i,s);const l=exprToSet({xdata:t,host:e,expr:a,callback:({val:e})=>{i.textContent=e}});addBindingData(i,l)}),getCanRenderEles(r,"[x-if]").forEach(r=>{const s=r.getAttribute("x-if");let{marker:n,parent:i}=postionNode(r),l=null;const o=exprToSet({xdata:t,host:e,expr:s,callback:({val:s})=>{s&&!l?(l=$(r.content.children[0].outerHTML).ele,i.insertBefore(l,n),renderTemp({host:e,xdata:t,content:l,temps:a})):!s&&l&&(removeElementBind(l),l.parentNode.removeChild(l),l=null)}});addBindingData(n,o)}),getCanRenderEles(r,"[x-fill]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-fill"));let n=r.getAttribute("x-item");n&&(n=JSON.parse(n));const i=r;let l,[o,c]=s;moveAttrExpr(r,"x-fill",s),moveAttrExpr(r,"x-item",n);const d=exprToSet({xdata:t,host:e,expr:c,isArray:1,callback:r=>{const s=r.val;let c=a.get(o);if(!c)throw{target:e.ele,desc:"this template was not found",name:o};if(l){const r=Array.from(i.children),l=r.map(e=>e.__fill_item.$data),o=Symbol("holder"),d=[];s.forEach((s,i)=>{let p=l.indexOf(s);if(-1===p){let r=createFillItem({host:e,data:s,index:i,tempData:c,temps:a});n&&initKeyToItem(r,n,t,e),d.push(r.ele)}else{let e=r[p];e.__fill_item.$index=i,d.push(e),l[p]=o}});const p=[];l.forEach((e,t)=>{if(e!==o){let e=r[t];p.push(e),i.removeChild(e)}}),p.forEach(e=>removeElementBind(e)),rebuildXEleArray(i,d)}else s.forEach((r,s)=>{const l=createFillItem({host:e,data:r,index:s,tempData:c,temps:a});n&&initKeyToItem(l,n,t,e),i.appendChild(l.ele)}),l=s.xid}});addBindingData(r,d)})},initKeyToItem=(e,t,r,a)=>{let s=e.$item;Object.keys(t).forEach(n=>{let i=t[n];const l=attrToProp(n);let o=exprToSet({xdata:r,host:a,expr:i,callback:({val:e})=>{s[l]=e}});addBindingData(e.ele,o)})},createFillItem=({host:e,data:t,index:r,tempData:a,temps:s})=>{const n=createXEle(parseStringToDom(a.code)[0]),i=createXData({get $host(){return e},$index:r,get $data(){return t},get $item(){return i}});return defineProperties(n,{$item:{get:()=>i},$data:{get:()=>t}}),n.ele.__fill_item=i,renderTemp({host:e,xdata:i,content:n.ele,temps:s}),n};function $(e){if(e instanceof Element)return createXEle(e);const t=getType(e);let r;return"string"==t?r=/\<.+\>/.test(e)?parseStringToDom(e)[0]:document.querySelector(e):"object"==t?r=parseDataToDom(e):(e===document||e instanceof DocumentFragment)&&(r=e),r?createXEle(r):null}Object.assign($,{all:e=>Array.from(document.querySelectorAll(e)).map(e=>createXEle(e)),register:register}),(glo=>{const getRandomId=()=>Math.random().toString(32).substr(2);var objectToString=Object.prototype.toString,getType=e=>objectToString.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const isFunction=e=>getType(e).search("function")>-1;var isEmptyObj=e=>!(0 in Object.keys(e));const nextTick=(()=>{const e=e=>Promise.resolve().then(()=>e());return"object"==typeof process&&process.nextTick&&(e=process.nextTick),e})(),getFileType=e=>{let t,r=e.split("/").pop().match(/(.+)\.(.+)/);return r&&(t=r[2]),t},getDir=e=>{let t=(e=(e=e.replace(/(.+)#.+/,"$1")).replace(/(.+)\?.+/,"$1")).match(/(.+\/).*/);return t&&t[1]},getFullPath=(e,t)=>{!t&&(t=getDir(document.location.href));let r=e;return/^.+:\/\//.test(t)||(t=getDir(getFullPath(t))),/^.+:\/\//.test(e)||(r=/^\/.+/.test(e)?location.origin+e:t+e),r},removeParentPath=e=>{let t=[];return e.split(/\//g).forEach(e=>{".."==e&&t.length&&".."!=t.slice(-1)[0]?t.pop():t.push(e)}),t.join("/")},processors=new Map,loaders=new Map,bag=new Map,paths=new Map,dirpaths={};let offline=!1;const cacheDress=new Map;let errInfo={time:100,backups:[]},baseUrl=getDir(location.href),base={processors:processors,loaders:loaders,bag:bag,paths:paths,dirpaths:dirpaths,errInfo:errInfo,baseUrl:"",tempM:{}};loaders.set("css",e=>new Promise((t,r)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=e.link;let s=!1;a.onload=(async()=>{t(async e=>(s||(s=!0,e.param.includes("-unAppend")&&document.head.removeChild(a)),a))}),a.onerror=(e=>{r({desc:"load link error",target:a,event:e})}),document.head.appendChild(a)})),loaders.set("json",async e=>{let t=await fetch(e.link);return t=await t.json(),async()=>t}),loaders.set("wasm",async e=>{let t=await fetch(e.link);t=await t.arrayBuffer();let r=await WebAssembly.compile(t);const a=new WebAssembly.Instance(r);return async()=>a.exports}),loaders.set("frame",async e=>{let t=document.createElement("iframe");Object.assign(t.style,{position:"absolute","z-index":"-1",border:"none",outline:"none",opacity:"0",width:"0",height:"0"});let{link:r,path:a}=e,s=a.replace(/\.frame$/,"/frame.html"),n=r.replace(a,s);t.src=n;let i=new Map,l=()=>{bag.delete(a),document.body.removeChild(t),window.removeEventListener("message",o),o=e=l=null};e.timer=setTimeout(l,1e4);let o,c=r=>new Promise(a=>{let s=getRandomId();clearTimeout(e.timer),i.set(s,{res:a}),t.contentWindow.postMessage({type:"drillFrameTask",taskId:s,data:r.data},"*")});return window.addEventListener("message",o=(t=>{let{data:r,taskId:a}=t.data;if(i.has(a)){let e=i.get(a);i.delete(a),e.res(r)}i.size||(e.timer=setTimeout(l,1e4))})),new Promise((e,r)=>{t.addEventListener("load",t=>{e(c)}),t.addEventListener("error",e=>{l(),r()}),document.body.appendChild(t)})}),loaders.set("js",e=>new Promise((t,r)=>{let a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=e.link,a.addEventListener("load",async()=>{let r,{tempM:a}=base,{type:s}=a,n=processors.get(s||"file");if(!n)throw"no such this processor => "+s;r=await n(e),t(r)}),a.addEventListener("error",()=>{r()}),document.head.appendChild(a)}));try{eval('\n    loaders.set("mjs", async packData => {\n        let d = await import(packData.link);\n\n        return async () => {\n            return d;\n        }\n    });\n    ')}catch(e){console.warn("browser does not support asynchronous es module")}const returnUrlSets=new Set(["png","jpg","jpeg","bmp","gif","webp"]),getLoader=e=>{let t=loaders.get(e);return t||(t=getByUtf8),returnUrlSets.has(e)&&(t=getByUrl),t},getByUtf8=async e=>{let t=await fetch(e.link);return t=await t.text(),async()=>t},getByUrl=async e=>{if(e.offlineUrl)return async()=>e.offlineUrl;let t=await fetch(e.link),r=await t.blob(),a=URL.createObjectURL(r);return async()=>a},isHttpFront=e=>/^http/.test(e);class PackData{constructor(e){Object.assign(this,e),this.stat=1,this.passPromise=new Promise((e,t)=>{this._passResolve=e,this._passReject=t}),this.errPaths=[]}get dir(){return getDir(this.path)}get nextLink(){this.stat=2;let e=void 0!=this._backupId?++this._backupId:this._backupId=0,{backups:t}=errInfo,r=t[e-1]||base.baseUrl,a=t[e];if(!a)return;let s=getFullPath(r),n=getFullPath(a);this.errPaths.push(this.link);let i=this.link.replace(s,n);return this.link=i,i}resolve(e){this.getPack=e,this.stat=3,this._passResolve()}reject(){this.stat=4,this._passReject({desc:"load source error",link:this.errPaths,packData:this})}}let agent=async e=>{if(e.param&&e.param.includes("-getLink")&&!offline)return Promise.resolve(e.link);let t=bag.get(e.path);if(!t)for(t=new PackData({path:e.path,link:e.link,fileType:e.fileType}),bag.set(e.path,t);;)try{t.link=await cacheSource({packData:t});let r=await getLoader(e.fileType)(t)||(async()=>{});t.resolve(r);break}catch(r){if(t.stat=2,isHttpFront(e.str)){t.reject();break}if(!t.nextLink){t.reject();break}await new Promise(e=>setTimeout(e,errInfo.time))}return await t.passPromise,e.param&&e.param.includes("-getLink")&&offline?Promise.resolve(t.link):await t.getPack(e)};const drill={load:(...e)=>load(toUrlObjs(e)),remove(e){let{path:t}=fixUrlObj({str:e});if(bag.has(t))return bag.delete(t),!0;console.warn(`pack %c${e}`,"color:red","does not exist")},has(e){let{path:t}=fixUrlObj({str:e}),r=bag.get(t);return r&&r.stat},config(e){e.baseUrl&&(base.baseUrl=e.baseUrl);let t=e.paths;t&&Object.keys(t).forEach(e=>{let r=t[e];if(/^@.+\/$/.test(e)){let t="^"+e;r=r.replace(/\/\.\//,"/"),/^\.\./.test(r)?r=removeParentPath(getDir(document.location.href)+base.baseUrl+r):/^\//.test(r)&&(r=location.origin+r);let a=new RegExp(t);dirpaths[e]={reg:a,value:r}}else/^\w+$/.test(e)?paths.set(e,r):console.warn("this Paths settings do not meet specifications",e)}),base.baseUrl&&e.backups&&e.backups.forEach(e=>errInfo.backups.push(e))},ext(e,t){if(isFunction(e))e(base);else{let r,a=(...e)=>t(e,r,base);switch(e){case"fixUrlObj":r=fixUrlObj,fixUrlObj=a;break;case"load":r=load,load=a;break;case"agent":r=agent,agent=a;break;case"cacheSource":r=cacheSource,cacheSource=a}}},cacheInfo:{k:"d_ver",v:""},get offline(){return offline},set offline(e){offline?console.error("offline mode has been activated"):offline=e},debug:{bag:bag},version:"3.5.5",v:3005005},setProcessor=(e,t)=>{processors.set(e,async e=>{let r=base.tempM.d;return base.tempM={},await t(e,r,{relativeLoad:(...t)=>load(toUrlObjs(t,e.dir))})});let r=t=>{base.tempM={type:e,d:t}};drill[e]||(drill[e]=r),glo[e]||(glo[e]=r)},setCacheDress=(e,t)=>{cacheDress.set(e,async({file:e,packData:r})=>{let a=e,s=await e.text(),n=await t({fileText:s,file:e,relativeLoad:(...e)=>load(toUrlObjs(e,r.dir))});return s!==n&&(a=new File([n],e.name,{type:e.type})),a})};let load=e=>{let t,r=new Promise((r,a)=>{let s=[],{length:n}=e,i=n,l=[];e.forEach(async(e,o)=>{let c,d="succeed";await new Promise(e=>nextTick(e)),c=await agent(e).catch(t=>{d="error",Object.assign(e,{type:"error",descript:t}),l.push(e)}),s[o]=c,t&&t({id:o,sum:i,ready:i-n+1,stat:d}),--n||(l.length?a(l):r(1==i?c:s),s=null)})});return r.post=function(t){return e.forEach(e=>e.data=t),this},r.pend=function(e){return t=e,this},r},fixUrlObj=e=>{let t,r,a,s,n,{str:i,relative:l}=e;if(bag.has(i)){let t=bag.get(i);return Object.assign(e,{path:t.path,link:t.link}),e}[t,...n]=i.split(/\s/).filter(e=>e&&e),(a=t.match(/(.+)\?(\S+)$/)||"")&&(t=a[1],a=a[2]);let o=paths.get(t);if(o)t=o;else for(let e in dirpaths){let r=dirpaths[e];if(r.reg.test(t)){t=t.replace(r.reg,r.value);break}}/^.+:\/\//.test(t)||(t=n.includes("-r")?getFullPath(t):/^\./.test(t)?getFullPath(t,l||base.baseUrl):getFullPath(t,base.baseUrl)),t=t.replace(/\/\.\//,"/"),/\.\.\//.test(t)&&(t=removeParentPath(t)),(s=getFileType(t))||/\/$/.test(t)||(n.includes("-p")&&(t=t+"/"+t.replace(/.+\/(.+)/,"$1")),t+=".js",s="js"),r=a?t+"?"+a:t;{let{k:e,v:t}=drill.cacheInfo;e&&t&&!n.includes("-unCacheSearch")&&(r=r.includes("?")?`${r}&${e}=${t}`:`${r}?${e}=${t}`)}return n.includes("-mjs")&&(s="mjs"),Object.assign(e,{link:r,search:a,fileType:s,path:t.replace(location.origin,""),param:n}),e};const toUrlObjs=(e,t)=>{let r=getRandomId();return e.map((e,a)=>fixUrlObj({loadId:getRandomId(),id:a,str:e,groupId:r,relative:t}))};processors.set("file",e=>{}),setProcessor("define",async(e,t,{relativeLoad:r})=>{let a={},s={exports:a};if(isFunction(t)){let{path:n,dir:i}=e;t=t(r,a,s,{FILE:n,DIR:i})}return t instanceof Promise&&(t=await t),t||isEmptyObj(s.exports)||(t=s.exports),async()=>t}),setProcessor("task",(e,t,{relativeLoad:r})=>{if(!isFunction(t))throw"task must be a function";let{path:a,dir:s}=e;return async e=>{return await t(r,e.data,{FILE:a,DIR:s})}}),setProcessor("init",(e,t,{relativeLoad:r})=>{if(!isFunction(t))throw"init must be a function";let a,{path:s,dir:n}=e,i=0;return async e=>i?a:(a=await t(r,e.data,{FILE:s,DIR:n}),i=1,a)}),setCacheDress("css",async({fileText:e,relativeLoad:t})=>{let r=e.match(/@import ["'](.+?)["']/g);r&&await Promise.all(r.map(async r=>{let a=r.replace(/@import ["'](.+?)["']/,"$1"),s=await t(`${a} -getLink`);e=e.replace(r,`@import "${s}"`)}));let a=e.match(/url\((.+?)\)/g);return a&&await Promise.all(a.map(async r=>{let a=r.replace(/url\((.+?)\)/,"$1").replace(/["']/g,"");if(/(^http:)|(^https:)/.test(a))return Promise.resolve("");let s=await t(`${a} -getLink`);e=e.replace(r,`url("${s}")`)})),e}),setCacheDress("mjs",async({fileText:e,relativeLoad:t})=>{let r=e.match(/import .+ from ['"](.+?)['"];/g);r&&await Promise.all(r.map(async r=>{let a=r.match(/(import .+ from) ['"](.+?)['"];/,"$1");if(a){let s=a[2],n=await t(`${s} -getLink`);e=e.replace(r,`${a[1]} "${n}"`)}}));let a=e.match(/import\(.+?\)/g);return a&&await Promise.all(a.map(async r=>{let a=r.replace(/import\(["'](.+?)['"]\)/,"$1"),s=await t(`${a} -getLink`);e=e.replace(r,`import("${s}")`)})),e});const DBNAME="drill-cache-db",FILESTABLENAME="files";let mainDB,isInitDB=new Promise((e,t)=>{const r=glo.indexedDB||glo.webkitIndexedDB||glo.mozIndexedDB||glo.msIndexedDB;if(r){let t=r.open(DBNAME,drill.cacheInfo.v||1);t.onupgradeneeded=(e=>{let t=e.target.result;t.objectStoreNames.contains(FILESTABLENAME)?(t.deleteObjectStore(FILESTABLENAME),t.createObjectStore(FILESTABLENAME,{keyPath:"path"})):t.createObjectStore(FILESTABLENAME,{keyPath:"path"})}),t.onsuccess=(t=>{mainDB=t.target.result,e()})}else t("rubish browser no indexDB")}),cacheSource=async({packData:e})=>{if(!offline)return e.link;await isInitDB;let t=await getFile(e.path);if(!t){let r=await fetch(e.link);if(200!=r.status)throw{type:"cacheSource",desc:"statusError",status:r.status};let a=r.headers.get("Content-Type").replace(/;.+/,""),s=e.path.replace(/.+\//,""),n=await r.blob();t=new File([n],s,{type:a}),await saveFile(e.path,t)}let r=cacheDress.get(e.fileType);return r&&(t=await r({file:t,packData:e})),e.offlineFile=t,e.offlineUrl=URL.createObjectURL(t)};const getFile=e=>new Promise((t,r)=>{let a=mainDB.transaction([FILESTABLENAME],"readonly").objectStore(FILESTABLENAME).get(e);a.onsuccess=(()=>{t(a.result&&a.result.data)}),a.onerror=(t=>{r(),console.error(`error load ${e}`,t)})}),saveFile=(e,t)=>new Promise((r,a)=>{let s=mainDB.transaction([FILESTABLENAME],"readwrite").objectStore(FILESTABLENAME).put({path:e,data:t});s.onsuccess=(()=>{r({stat:1}),console.log(`save ${e} succeed`)}),s.onerror=(t=>{r({stat:0}),console.error(`save (${e}) error`,t)})});Object.defineProperty(base,"main",{value:{get agent(){return agent},get load(){return load},get fixUrlObj(){return fixUrlObj},get toUrlObjs(){return toUrlObjs},get setProcessor(){return setProcessor}}}),glo.load||(glo.load=drill.load);let cScript=document.currentScript;if(!cScript&&(cScript=document.querySelector(["drill-cache"])),cScript){let e=cScript.getAttribute("drill-cache");e&&(drill.cacheInfo.v=e)}let oldDrill=glo.drill;Object.defineProperty(glo,"drill",{get:()=>drill,set(e){isFunction(e)?nextTick(()=>e(drill)):console.error("drill type error =>",e)}}),oldDrill&&nextTick(()=>oldDrill(drill))})(window)})(window);