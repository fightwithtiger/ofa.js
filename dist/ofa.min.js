/*!
* ofa v3.0.0
* https://github.com/kirakiray/ofa.js
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=()=>Math.random().toString(32).substr(2);var r=Object.prototype.toString,s=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const n=e=>s(e).search("function")>-1;var a=e=>!Object.keys(e).length;const o=Object.defineProperties,i=Object.getOwnPropertyDescriptor,l=e=>e instanceof w,c=null!==document.currentScript.getAttribute("debug"),h=(()=>{if(c){let e=new Map;return(r,s)=>{s||(s=t());let n=e.get(s);clearTimeout(n),e.set(s,setTimeout(()=>{r(),e.delete(s)}))}}let e=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let s=!1;return(n,a)=>{a||(a=t()),e.set(a,{key:a,fun:n}),s||(s=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),s=!1}))}})(),d=e=>{let t=[];const r=s=>{t.push(s),h(()=>{e(t),t.length=0},r)};return r},u=(e,t)=>{Object.keys(t).forEach(r=>{let{get:s,set:n,value:a}=i(t,r);a?e.hasOwnProperty(r)?e[r]=a:Object.defineProperty(e,r,{value:a}):Object.defineProperty(e,r,{get:s,set:n})})},p=(Date.now(),Symbol("self")),f=Symbol("proxy"),m=Symbol("watchs"),g=Symbol("can_update"),y=new Set(["root","sub","revoke"]),b=(e,t,r)=>{let s;s=t.path=r?[e[f],...r]:[e[f]],e[m].forEach(e=>e(t)),e.owner&&e.owner.forEach(e=>b(e,t,s.slice()))};class w{constructor(e,r){let s;e.get?(s=new Proxy(this,{get:e.get,ownKeys:e.ownKeys,getOwnPropertyDescriptor:e.getOwnPropertyDescriptor,set:x.set}),delete e.get,delete e.ownKeys,delete e.getOwnPropertyDescriptor):s=new Proxy(this,x);let n=r;o(this,{[p]:{value:this},[f]:{value:s},xid:{value:"x_"+t()},_xtatus:{get:()=>n,set(e){if(!y.has(e))throw{target:s,desc:`xtatus not allowed to be set ${e}`};const t=this.owner.size;if("revoke"===e&&t)throw{target:s,desc:"the owner is not empty"};if("revoke"===n&&"revoke"!==e)t||v(this);else if("sub"===n&&"root"===e)throw{target:s,desc:"cannot modify sub to root"};n=e}},owner:{writable:!0,value:new Set},length:{configurable:!0,writable:!0,value:0},[m]:{value:new Map},[g]:{writable:!0,value:0}});let a=-1;return Object.keys(e).forEach(t=>{let r=i(e,t),{value:n,get:l,set:c}=r;"get"!==t&&(/\D/.test(t)||(t=parseInt(t))>a&&(a=t),l||c?o(this,{[t]:r}):s[t]=n)}),a>-1&&(this.length=a+1),this[g]=1,s}watch(e){const r="e_"+t();return this[m].set(r,e),r}unwatch(e){return this[m].delete(e)}setData(e,t){let r=s(t);"array"!=r&&"object"!=r||(t=E(t,"sub")).owner.add(this);const n=this[e];if(n===t)return!0;let a=Reflect.set(this,e,t);return this[g]&&b(this,{xid:this.xid,name:"setData",args:[e,t]}),_(n,this),a}delete(e){if(/^_/.test(e)||"symbol"==typeof e)return Reflect.deleteProperty(this,e);if(!e)return!1;const t=this[p];let r=t[e];_(r,t);let s=Reflect.deleteProperty(t,e);return b(this,{xid:this.xid,name:"delete",args:[e]}),s}}const x={set:(e,t,r,s)=>"symbol"==typeof t?Reflect.set(e,t,r,s):/^_/.test(t)?(e.hasOwnProperty(t)?Reflect.set(e,t,r,s):o(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0):e.setData(t,r),deleteProperty:function(e,t){return e.delete(t)}},_=(e,t)=>{if(!l(e))return;const{owner:r}=e;r.delete(t),r.size||(e._xtatus="revoke",Object.values(e).forEach(t=>{_(t,e[p])}))},v=e=>{"revoke"===e._xtatus&&Object.values(e).forEach(t=>{l(t)&&(v(t),t.owner.add(e),t._xtatus="sub")})},E=(e,t="root")=>l(e)?(e._xtatus=t,e):new w(e,t);u(w.prototype,{seek(e){let t=[];if(!n(e)){let t=new Function(`with(this){return ${e}}`);e=(e=>{try{return t.call(e,e)}catch(e){}})}return e.call(this,this)&&t.push(this),Object.values(this).forEach(r=>{l(r)&&t.push(...r.seek(e))}),t},watchTick(e){return this.watch(d(e))},watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r,s=new Function(`\n        try{with(this){\n            return ${e}\n        }}catch(e){}`).bind(this);const n=this.watch(r=(()=>{let e=s();e&&(this.unwatch(n),t(e))}));r()})},watchKey(e,t){t&&Object.keys(e).forEach(t=>e[t].call(this,this[t]));let r={};return this.watch(d(t=>{Object.keys(e).forEach(s=>{let n=this[s];if(r[s]!==n)e[s].call(this,n);else if(l(n)){t.some(e=>{if(e.path[1]==r[s])return!0})&&e[s].call(this,n)}r[s]=n})}))},toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach(s=>{let n=this[s];/\D/.test(s)?t=!1:(s=parseInt(s))>r&&(r=s),l(n)&&(n=n.toJSON()),e[s]=n}),t&&(e.length=r+1,e=Array.from(e));const s=this.xid;return o(e,{xid:{get:()=>s}}),e},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&o(w.prototype,{[e]:{value:t}})});const k=Array.prototype.splice;u(w.prototype,{splice(e,t,...r){let n=this[p];r=r.map(e=>{let t=s(e);return"array"!=t&&"object"!=t||(e=E(e,"sub")).owner.add(n),e});let a=k.call(n,e,t,...r);return a.forEach(e=>_(e,n)),b(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),a},unshift(...e){return this.splice(0,0,...e),this.length},push(...e){return this.splice(this.length,0,...e),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(e=>{const t=Array.prototype[e];t&&o(w.prototype,{[e]:{value(...r){let s=t.apply(this[p],r);return b(this,{xid:this.xid,name:e}),s}}})});const A=e=>e?e.__xEle__?e.__xEle__:e.__xEle__=new M(e):null,O=document.createElement("template"),S=(e,t)=>!!e.tagName&&(e===t||e!==document&&(O.innerHTML=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`,!!O.content.querySelector(t))),j=e=>{const t=document.createElement("div");return t.innerHTML=e,Array.from(t.children).map(function(e){return t.removeChild(e),e})},$=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot);const r=A(t);r[D].forEach(t=>{e[t]&&(r[t]=e[t])});let s=0;for(;s in e;){let r=$(e[s]);t.appendChild(r),s++}return t},L=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),C={get:(e,t,r)=>"string"!=typeof t||/\D/.test(t)?Reflect.get(e,t,r):A(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},T=Symbol("events"),P=w.prototype.setData,N=["text","html","show","style"],D=Symbol("cansetkeys");class M extends w{constructor(e){super(Object.assign({},C));const t=this[p];t.tag=e.tagName?e.tagName.toLowerCase():"",t.owner=null,o(t,{ele:{get:()=>e},[T]:{writable:!0,value:""}}),delete t.length,"input"==t.tag&&H(t)}setData(e,t){if(!this[D]||this[D].has(e))return P.call(this,e,t)}get root(){return A(this.ele.getRootNode())}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t?A(t):null}get shadow(){return A(this.ele.shadowRoot)}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?A(e):null}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get length(){return this.ele.children.length}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get style(){return this.ele.style}set style(e){if("string"==s(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),n=Object.keys(e);r.forEach(e=>{n.includes(e)||(t[e]="")}),Object.assign(t,e)}get show(){return"none"!==this.ele.style.display}set show(e){this.ele.style.display=e?"":"none"}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get next(){const e=this.ele.nextElementSibling;return e?A(e):null}get prev(){const e=this.ele.previousElementSibling;return e?A(e):null}$(e){const t=this.ele.querySelector(e);return t?A(t):null}all(e){return Array.from(this.ele.querySelectorAll(e)).map(e=>A(e))}is(e){return S(this.ele,e)}attr(...e){let[t,r]=e,{ele:s}=this;if(1==e.length)return t instanceof Object&&Object.keys(t).forEach(e=>{s.setAttribute(e,t[e])}),s.getAttribute(t);s.setAttribute(t,r)}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(S(t,e))return!0})),t.map(e=>A(e))}parents(e,t){let r=[],n=this.parent;if(e){if("string"==s(e))for(;n&&n;)S(n.ele,e)&&r.push(n),n=n.parent}else for(;n;)r.push(n),n=n.parent;if(t)if(t instanceof M){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==s(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}clone(){let e=A(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}remove(){const{ele:e}=this;e.parentNode.removeChild(e)}}o(M.prototype,{[D]:{value:new Set(N)}});const H=e=>{let t=e.attr("type")||"text";const{ele:r}=e;let s={type:{enumerable:!0,get:()=>t},name:{enumerable:!0,get:()=>r.name},value:{enumerable:!0,get:()=>r.value,set(e){r.value=e}},disabled:{enumerable:!0,get:()=>r.disabled,set(e){r.disabled=e}},[D]:{value:new Set(["value","disabled",...N])}};switch(t){case"radio":case"checkbox":Object.assign(s,{checked:{enumerable:!0,get:()=>r.checked,set(e){r.checked=e}},name:{enumerable:!0,get:()=>r.name}}),e.on("change",t=>{b(e,{xid:e.xid,name:"setData",args:["checked",r.checked]})}),s[D].value.add("checked");break;case"file":Object.assign(s,{accept:{enumerable:!0,get:()=>r.accept}});break;case"text":default:e.on("input",t=>{b(e,{xid:e.xid,name:"setData",args:["value",r.value]})})}o(e,s)};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{const t=Array.prototype[e];t&&Object.defineProperty(M.prototype,e,{value(...e){return t.apply(Array.from(this.ele.children).map(A),e)}})}),u(M.prototype,{splice(e,t,...r){const{ele:n}=this,a=Array.from(n.children),o=[];let i=e,l=t,c=a[i];for(;c&&l>0;)o.push(c),n.removeChild(c),l--,c=a[++i];if(r.length){let t=document.createDocumentFragment();r.forEach(e=>{if(e instanceof Element)return void t.appendChild(e);if(e instanceof M)return void t.appendChild(e.ele);let r=s(e);"string"==r?j(e).forEach(e=>{t.appendChild(e)}):"object"==r&&t.appendChild($(e))}),e>=this.length?n.appendChild(t):n.insertBefore(t,n.children[e])}return b(this,{xid:this.xid,name:"splice",args:[e,t,...r]}),o},sort(e){const t=this.ele,r=Array.from(t.children).map(A).sort(e);return I(t,r),b(this,{xid:this.xid,name:"sort"}),this},reverse(){const e=this.ele,t=Array.from(e.children).reverse();return I(e,t),b(this,{xid:this.xid,name:"reverse"}),this}});const I=(e,t)=>{const{children:r}=e;t.forEach((t,s)=>{let n=t.ele||t;const a=r[s];a?n!==a&&e.insertBefore(n,a):e.appendChild(n)})},R=e=>e[T]?e[T]:e[T]=new Map,J=e.MouseEvent||Event,q=e.TouchEvent||Event,U=new Map([["click",J],["mousedown",J],["mouseup",J],["mousemove",J],["mouseenter",J],["mouseleave",J],["touchstart",q],["touchend",q],["touchmove",q]]),z=(e,t,r,s=!0)=>{let n=U.get(t)||CustomEvent;const a=t instanceof Event?t:new n(t,{bubbles:s,cancelable:!0});return a.data=r,e.ele.dispatchEvent(a)};u(M.prototype,{on(e,r,s){if(n(r))s=r,r=void 0;else{const e=s,{ele:t}=this;s=(s=>{let n;s.path?n=s.path:(n=A(s.target).parents(null,t).map(e=>e.ele)).unshift(s.target),n.some(n=>{if(n==t)return!0;A(n).is(r)&&(s.selector=n,e(s),delete s.selector)})})}this.ele.addEventListener(e,s);const a="e_"+t();return R(this).set(a,{name:e,selector:r,callback:s}),a},off(e){let t=R(this).get(e);return!!t&&(this.ele.removeEventListener(t.name,t.callback),this[T].delete(e),!0)},one(e,t,r){let s,n;return"string"==typeof t?(n=r,r=(e=>{n(e),this.off(s)})):(n=t,t=(e=>{n(e),this.off(s)})),s=this.on(e,t,r)},trigger(e,t){return z(this,e,t)},triggerHandler(e,t){return z(this,e,t,!1)}}),["click","focus","blur"].forEach(e=>{u(M.prototype,{[e](t){if(!n(t))return this.trigger(e,t);this.on(e,t)}})});const F=({xele:e,defs:t,temps:r,_this:s})=>{if(Object.assign(e,t.data,t.attrs),t.created&&t.created.call(e),t.temp){const n=s.attachShadow({mode:"open"});n.innerHTML=t.temp,ae({host:e,xdata:e,content:n,temps:r})}t.ready&&t.ready.call(e),!a(t.attrs)&&e.watchTick(r=>{s.__set_attr=1,Object.keys(t.attrs).forEach(t=>{s.setAttribute(t,e[t])}),delete s.__set_attr});let n=t.watch;a(n)||e.watchKey(n,!0)},K=e=>{const t={tag:"",temp:"",attrs:{},data:{},watch:{},proto:{}};let r;if(Object.assign(t,e),t.temp){const e=B(t.temp);t.temp=e.html,r=e.temps}const s=class extends M{constructor(e){super(e)}revoke(){Object.values(this).forEach(e=>{e instanceof M||!l(e)||_(e,this[p])}),ne(this.shadow.ele)}};u(s.prototype,t.proto);const n=W(t);o(s.prototype,{[D]:{writable:!0,value:new Set([...N,...n])}});customElements.define(t.tag,class extends HTMLElement{constructor(...e){super(...e);let n=this.__xEle__;n&&console.warn({target:n,desc:"please re-instantiate the object"}),this.__xEle__=new s(this);const a=A(this);F({xele:a,defs:t,temps:r,_this:this})}connectedCallback(){this.__x_connected=!0,t.attached&&!this.__x_runned_connected&&h(()=>{this.__x_connected&&!this.__x_runned_connected&&(this.__x_runned_connected=!0,t.attached.call(A(this)))})}disconnectedCallback(){this.__x_connected=!1,t.detached&&!this.__x_runnded_disconnected&&h(()=>{this.__x_connected||this.__x_runnded_disconnected||(this.__x_runnded_disconnected=!0,t.detached.call(A(this)))})}attributeChangedCallback(e,t,r){this.__set_attr||(A(this)[L(e)]=r)}static get observedAttributes(){return Object.keys(t.attrs).map(e=>(e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e))(e))}})},W=e=>{const{attrs:t,data:r,watch:s,proto:n}=e,a=[...Object.keys(t),...Object.keys(r),...Object.keys(s)],o=Object.getOwnPropertyDescriptors(n);return Object.keys(o).forEach(e=>{let{set:t}=o[e];t&&a.push(e)}),a},B=e=>{var t=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);t&&t.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<x-span prop="${encodeURI(r[1])}"></x-span>`))});const r=document.createElement("template");r.innerHTML=e,Array.from(r.content.querySelectorAll("*")).forEach(e=>{const t={},r={},s={},n={},o=[],i={};let l="",c=[];Array.from(e.attributes).forEach(e=>{let{name:a,value:h}=e;if(/^if:/.exec(a))return l=h,void c.push(a);const d=/^attr:(.+)/.exec(a);if(d)return t[d[1]]=h,void c.push(a);const u=/^:(.+)/.exec(a);if(u)return r[u[1]]=h,void c.push(a);const p=/^sync:(.+)/.exec(a);if(p)return s[p[1]]=h,void c.push(a);const f=/^fill:(.+)/.exec(a);if(f)return o.push(f[1],h),void c.push(a);const m=/^item:(.+)/.exec(a);if(m)return i[m[1]]=h,void c.push(a);const g=/^@(.+)/.exec(a)||/^on:(.+)/.exec(a);return g?(n[g[1]]={name:h},void c.push(a)):void 0}),l&&e.setAttribute("x-if",l),!a(t)&&e.setAttribute("x-attr",JSON.stringify(t)),!a(r)&&e.setAttribute("x-prop",JSON.stringify(r)),!a(s)&&e.setAttribute("x-sync",JSON.stringify(s)),o.length&&e.setAttribute("x-fill",JSON.stringify(o)),!a(i)&&e.setAttribute("x-item",JSON.stringify(i)),!a(n)&&e.setAttribute("x-on",JSON.stringify(n)),c.forEach(t=>e.removeAttribute(t))}),Array.from(r.content.querySelectorAll("template")).forEach(e=>{e.innerHTML=B(e.innerHTML).html}),Z(r);let s=new Map;return Array.from(r.content.querySelectorAll("template[name]")).forEach(e=>{s.set(e.getAttribute("name"),{ele:e,code:e.content.children[0].outerHTML}),e.parentNode.removeChild(e)}),{temps:s,html:r.innerHTML}},Z=e=>{e.content.querySelectorAll("[x-if]").forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");t.setAttribute("x-if",e.getAttribute("x-if")),e.removeAttribute("x-if"),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),Array.from(e.content.querySelectorAll("template")).forEach(Z)},G=(e,t)=>{let r=Array.from(e.querySelectorAll(t));return e instanceof Element&&S(e,t)&&r.push(e),r},Q=e=>{let t=new Comment("x-marker"),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{marker:t,parent:r}},V=e=>new Function("...$args",`\nconst [$e] = $args;\n\nwith(this){\n    return ${e};\n}\n    `),X=(e,t,r)=>{e.removeAttribute(t);let s=e.__renderData;s||(s=e.__renderData={},e.setAttribute("x-rendered","")),s[t]=r},Y=(e,t,r)=>{let s=e.watchTick(t);r.push({eid:s,target:e})},ee=({xdata:e,host:t,expr:r,callback:s,isArray:n})=>{let a,o,i,c;a=re.test(r)?V(r).bind(e):()=>e[r];const h=e=>{const t=a();if(l(t))if(n){let r=t.map(e=>e&&e.xid?e.xid:e).join(",");i!==r&&(s({val:t,modifys:e}),i=r)}else{let r=t.toJSON();o===t&&r===c||(s({val:t,modifys:e}),c=r)}else o!==t&&(s({val:t,modifys:e}),c=null);o=t};h();const d=[];if(e instanceof M)Y(e,h,d);else if(r.includes("$host"))r.includes("$index")&&Y(e,h,d),Y(t,h,d);else if(r.includes("$index")||r.includes("$item"))Y(e,h,d),l(e.$data)&&Y(e.$data,h,d);else{if(!r.includes("$data"))throw{desc:"fill element must use $data $host $item or $index",target:t,expr:r};l(e.$data)&&Y(e.$data,h,d)}return d},te=(e,t)=>{(e.__bindings||(e.__bindings=[])).push(...t)},re=/[\(\)\;\.\=\>\<]/,se=(e,t)=>{Array.from(e.childNodes).forEach(e=>{t(e),e instanceof Element&&se(e,t)})},ne=e=>{se(e,e=>{e.__bindings&&e.__bindings.forEach(e=>{let{target:t,eid:r}=e;t.unwatch(r)})})},ae=({host:e,xdata:t,content:r,temps:s})=>{G(r,"[x-on]").forEach(e=>{let r=JSON.parse(e.getAttribute("x-on")),s=[];const n=A(e);Object.keys(r).forEach(e=>{let a,{name:o}=r[e];if(re.test(o)){const r=V(o);a=n.on(e,e=>{r.call(t,e)})}else a=n.on(e,e=>{t[o]&&t[o].call(t,e)});s.push(a)}),X(e,"x-on",r)}),G(r,"[x-attr]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-attr"));X(r,"x-attr",s),Object.keys(s).forEach(n=>{const a=ee({xdata:t,host:e,expr:s[n],callback:({val:e})=>{r.setAttribute(n,e)}});te(r,a)})}),G(r,"[x-prop]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-prop")),n=A(r);X(r,"x-prop",s),Object.keys(s).forEach(a=>{const o=ee({xdata:t,host:e,expr:s[a],callback:({val:e})=>{n[a]=e}});te(r,o)})}),G(r,"[x-sync]").forEach(r=>{const s=JSON.parse(r.getAttribute("x-sync")),n=A(r);Object.keys(s).forEach(a=>{let o=s[a];if(re.test(o))throw{desc:"sync only accepts attribute names"};const i=ee({xdata:t,host:e,expr:o,callback:({val:e})=>{n[a]=e}}),l=ee({xdata:n,host:e,expr:a,callback:({val:e})=>{t[o]=e}});te(r,[...i,...l])})}),G(r,"x-span").forEach(r=>{let s=decodeURI(r.getAttribute("prop")),{marker:n,parent:a}=Q(r);const o=document.createTextNode("");a.replaceChild(o,n);const i=ee({xdata:t,host:e,expr:s,callback:({val:e})=>{o.textContent=e}});te(o,i)}),G(r,"[x-if]").forEach(r=>{const n=r.getAttribute("x-if");let{marker:a,parent:o}=Q(r),i=null;const l=ee({xdata:t,host:e,expr:n,callback:({val:n})=>{n&&!i?(i=le(r.content.children[0].outerHTML).ele,o.insertBefore(i,a),ae({host:e,xdata:t,content:i,temps:s})):!n&&i&&(ne(i),i.parentNode.removeChild(i),i=null)}});te(a,l)}),G(r,"[x-fill]").forEach(r=>{const n=JSON.parse(r.getAttribute("x-fill"));let a=r.getAttribute("x-item");a&&(a=JSON.parse(a));const o=r;let i,[l,c]=n;X(r,"x-fill",n),X(r,"x-item",a);const h=ee({xdata:t,host:e,expr:c,isArray:1,callback:r=>{const n=r.val;let c=s.get(l);if(!c)throw{target:e.ele,desc:"this template was not found",name:l};if(i){const r=Array.from(o.children),i=r.map(e=>e.__fill_item.$data),l=Symbol("holder"),h=[];n.forEach((n,o)=>{let d=i.indexOf(n);if(-1===d){let r=ie({host:e,data:n,index:o,tempData:c,temps:s});a&&oe(r,a,t,e),h.push(r.ele)}else{let e=r[d];e.__fill_item.$index=o,h.push(e),i[d]=l}});const d=[];i.forEach((e,t)=>{if(e!==l){let e=r[t];d.push(e),o.removeChild(e)}}),d.forEach(e=>ne(e)),I(o,h)}else n.forEach((r,n)=>{const i=ie({host:e,data:r,index:n,tempData:c,temps:s});a&&oe(i,a,t,e),o.appendChild(i.ele)}),i=n.xid}});te(r,h)})},oe=(e,t,r,s)=>{let n=e.$item;Object.keys(t).forEach(a=>{let o=t[a];const i=L(a);let l=ee({xdata:r,host:s,expr:o,callback:({val:e})=>{n[i]=e}});te(e.ele,l)})},ie=({host:e,data:t,index:r,tempData:s,temps:n})=>{const a=A(j(s.code)[0]),i=E({get $host(){return e},$index:r,get $data(){return t},get $item(){return i}});return o(a,{$item:{get:()=>i},$data:{get:()=>t}}),a.ele.__fill_item=i,ae({host:e,xdata:i,content:a.ele,temps:n}),a};function le(e){if(e instanceof Element)return A(e);const t=s(e);let r;return"string"==t?r=/\<.+\>/.test(e)?j(e)[0]:document.querySelector(e):"object"==t?r=$(e):(e===document||e instanceof DocumentFragment)&&(r=e),r?A(r):null}Object.assign(le,{all:e=>Array.from(document.querySelectorAll(e)).map(e=>A(e)),register:K}),(e=>{const t=()=>Math.random().toString(32).substr(2);var r=Object.prototype.toString;const s=e=>(e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""))(e).search("function")>-1;const{defineProperties:n}=Object,a=(()=>{const e=e=>Promise.resolve().then(()=>e());return"object"==typeof process&&process.nextTick&&(e=process.nextTick),e})(),o=new Map,i=(t,r)=>{o.set(t,r),n(e,{[t]:{value:e=>{let s=document.currentScript.src,n=d.get(s);n||(n=new u(s),d.set(s,n)),n.status=1,n.ptype=t,r({respone:e,record:n,relativeLoad(...e){let t=new x(...e);return t.__relative__=s,t}})}}})};i("define",async({respone:e,record:t,relativeLoad:r})=>{let n;if(s(e)){const s={};let a=await e({load:r,FILE:t.src,exports:s});void 0!==a||(e=>!(0 in Object.keys(e)))(s)||(a=s),n=(e=>a)}else n=(t=>e);t.done(n)}),i("task",async({respone:e,record:t,relativeLoad:r})=>{if(!s(e))throw"task must be a function";t.done(async s=>await e({data:s.data,load:r,FILE:t.src}))});const l=new Map,c=(e,t)=>{l.set(e,r=>{const s=d.get(r);s.type=e,t({src:r,record:s})})};c("js",({src:e,record:t})=>new Promise((r,s)=>{let n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,t.sourceElement=n,n.addEventListener("load",async()=>{t.loadedTime=Date.now(),0==t.status&&(t.ptype="script",t.done(e=>{})),r()}),n.addEventListener("error",()=>{s()}),document.head.appendChild(n)})),c("mjs",async({src:e,record:t})=>{let r=await import(e);t.done(()=>r)}),c("wasm",async({src:e,record:t})=>{let r=await fetch(e).then(e=>e.arrayBuffer()),s=await WebAssembly.compile(r);const n=new WebAssembly.Instance(s);t.done(()=>n.exports)}),c("json",async({src:e,record:t})=>{let r=await fetch(e);r=await r.json(),t.done(()=>r)}),c("css",async({src:e,record:t})=>{let r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,t.sourceElement=r;let s=!1;t.done(async e=>{if(e.params.includes("-unpull"))return r;s||(document.head.appendChild(r),s=!0),r.sheet||await new Promise(e=>{r.addEventListener("load",t=>{e()})})})}),["html"].forEach(e=>{c(e,async({src:e,record:t})=>{let r=await fetch(e).then(e=>e.text());t.done(()=>r)})});const h=async({src:e,record:t})=>{let r=await fetch(e);t.done(()=>r)},d=new Map;class u{constructor(e){this.src=e,this.status=0,this.bid="b_"+t(),this.data=new Promise((e,t)=>{this.__resolve=e,this.__reject=t}),this.startTime=Date.now()}done(e){this.status=2,this.__resolve(e),delete this.__resolve,delete this.__reject,this.doneTime=Date.now()}}const p=new Map;class f{constructor(e,t){let[r,...s]=e.split(" ");this.url=r,this.params=s,this.bag=t}get src(){let{url:e}=this;if(/^@.+/.test(e))for(let[t,r]of p)if(t.test(e)){e=e.replace(t,r);break}if(this.params.includes("-p")){e+=`/${e.replace(/.+\/(.+)/,"$1")}.js`}return new URL(e,this.relative).href}get ftype(){let e=new URL(this.src).pathname.replace(/.+\.(.+)/,"$1");return this.params.some(t=>{if(/^:(.+)/.test(t))return e=t.replace(/^:(.+)/,"$1"),!0}),e}get data(){return this.bag[b]}get relative(){return this.bag.__relative__||location.href}}function m(e){e.args.forEach(t=>e.result.push(void 0));let t=0,r=!1,{result:s}=e;const n=e[w];e.args.forEach((a,o)=>{let i=new f(a,e),c=a=>{s[o]=a,t++,n&&n({index:o,pkg:i,data:a}),1===e.args.length?e[g](a):t!==e.args.length||r||e[g](s),c=null};i.params.includes("-link")?c(i.src):i.params.includes("-pkg")?c(i):async function(e){let t=d.get(e.src);if(t){const r=await t.data;return await r(e)}t=new u(e.src),d.set(e.src,t);let r=l.get(e.ftype);r?r(t.src):(console.warn({desc:"did not find this loader",type:e.ftype}),h({src:t.src,record:t}));const s=await t.data;return await s(e)}(i).then(c).catch(t=>{r=!0,s[o]=t,e[y]({expr:a,error:t}),c=null})})}const g=Symbol("resolve"),y=Symbol("reject"),b=Symbol("postData"),w=Symbol("pendFunc");class x extends Promise{constructor(...e){if(s(e[0]))return super(...e),this;let r,o;super((e,t)=>{r=e,o=t}),this.id="d_"+t(),n(this,{[g]:{value:r},[y]:{value:o},args:{value:e},result:{value:[]},__relative__:{writable:!0,value:""}}),a(()=>m(this))}pend(e){if(this[w])throw{desc:"pend has been used",target:this};return n(this,{[w]:{value:e}}),this}post(e){if(this[b])throw{desc:"post has been used",target:this};return n(this,{[b]:{value:e}}),this}}const _=e.load=((...e)=>new x(...e));n(e,{drill:{value:{load:_,config:e=>{let{paths:t}=e;t&&Object.keys(t).forEach(e=>{let r=t[e];if(!/^@.+\/$/.test(e))throw{desc:"incorrect definition of paths",key:e};if(!/.+\/$/.test(e))throw{desc:"incorrect definition of paths",key:e,path:r};p.set(new RegExp("^"+e),r)})},async has(e){let t=await _(`${e} -link`);return!!d.get(t)},async remove(e){let t=await _(`${e} -link`),r=d.get(t).sourceElement;r&&r.parentNode.removeChild(r),d.delete(t)},ext(e){e({bag:d,addLoader:c,addProcess:i})},version:"4.0.0",v:4e6}}})})("undefined"!=typeof globalThis?globalThis:window),drill.ext(({addProcess:e})=>{e("Component",async({respone:e,record:t,relativeLoad:r})=>{let s=e;n(e)&&(s=await e({load:r,FILE:t.src}));const a=await ce(t,r,s);K(a),t.done(async e=>{})})});const ce=async(e,t,r)=>{const s={temp:"",data:{},attrs:{},proto:{},watch:{}};Object.assign(s,r);let n=new URL(e.src).pathname.replace(/.+\/(.+)/,"$1").replace(/\.js$/,"");if(s.tag||(s.tag=n),""===s.temp){let e=await t(`./${n}.html`);s.temp=await he(e,t)}return s},he=async(e,t)=>{let r=document.createElement("template");r.innerHTML=e;let s=r.content.querySelectorAll("[href]"),n=r.content.querySelectorAll("[src]"),a=r.content.querySelectorAll('[style*="url("]');const o=[];s&&Array.from(s).forEach(e=>{o.push((async()=>{let r=await t(`${e.getAttribute("href")} -link`);e.setAttribute("href",r)})())}),n&&Array.from(n).forEach(e=>{o.push((async()=>{let r=await t(`${e.getAttribute("src")} -link`);e.setAttribute("src",r)})())}),a&&Array.from(a).forEach(e=>{o.push((async()=>{e.setAttribute("style",await de(e.getAttribute("style"),t))})())});let i=r.content.querySelectorAll("style");return i&&Array.from(i).forEach(e=>{o.push((async()=>{e.innerHTML=await de(e.innerHTML,t)})())}),await Promise.all(o),r.innerHTML},de=async(e,t)=>{let r=e.match(/url\(.+?\)/g);return r&&await Promise.all(r.map(async r=>{let s=r.replace(/url\((.+?)\)/,"$1"),n=await t(`${s} -link`);e=e.replace(r,`url(${n})`)})),e};drill.ext(({addProcess:e})=>{e("Page",async({respone:e,record:t,relativeLoad:r})=>{let s=e;n(e)&&(s=await e({load:r,FILE:t.src}));const a=await ce(t,r,s);let o=B(a.temp);a.temp=o.html;const i=W(a);t.done(async e=>({defaults:a,cansetKeys:i,temps:o.temps}))})});const ue=Symbol("page_status"),pe=e=>{if(e.parent.is("o-app"))return e;for(;e.host;)if((e=e.host).is("o-page")&&e.parent.is("o-app"))return e};K({tag:"o-page",attrs:{src:null,[ue]:"empty"},proto:{get status(){return this[ue]},get app(){let e=pe(this);if(e)return e.parent;throw{desc:"cannot find the app",target:this}},get query(){let e=new URL(this._realsrc),t={};for(const[r,s]of e.searchParams.entries())t[r]=s;return t},navigateTo(e){let t=pe(this);const{router:r}=this.app;let s=r.findIndex(e=>e._page==t);r.splice(s+1,r.length,e)},replaceTo(e){let t=pe(this);const{router:r}=this.app;let s=r.findIndex(e=>e._page==t);r.splice(s,r.length,e)},back(){this.app.back()}},watch:{async src(e){if(!e)return;this[ue]="loading";let t=await load(e);this._realsrc=await load(e+" -link");const r=new Set([...Array.from(this[D]),...t.cansetKeys]);r.delete("src"),this[D]=r;let{defaults:s}=t;u(this,s.proto),F({xele:this,defs:Object.assign({},s,{attrs:{}}),temps:t.temps,_this:this.ele}),this[ue]="loaded",b(this,{xid:this.xid,name:"setData",args:["status",this[ue]]}),s.attached&&this.__attached_pms.then(()=>s.attached.call(this)),s.detached&&this.__detached_pms.then(()=>s.detached.call(this))}},created(){this.__attached_pms=new Promise(e=>this.__attached_resolve=e),this.__detached_pms=new Promise(e=>this.__detached_resolve=e)},attached(){this.__attached_resolve()},detached(){this.__detached_resolve()}});Symbol("router_page");K({tag:"o-app",temp:'\n<style>\n    :host{\n        display: block;\n    }\n\n    ::slotted(o-page){\n        position: absolute;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n    }\n\n    ::slotted(o-page[page-area]){\n        transition: all ease-in-out .25s;\n        z-index: 2;\n    }\n\n    ::slotted(o-page[page-area="back"]){\n        transform: translate(-30px, 0);\n        opacity: 0;\n        z-index: 1;\n    }\n\n    ::slotted(o-page[page-area="next"]){\n        transform: translate(30px, 0);\n        opacity: 0;\n        z-index: 1;\n    }\n\n    .container {\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        height: 100%;\n    }\n\n    .main {\n        position: relative;\n        flex: 1;\n    }\n</style>\n<div class="container">\n    <div>\n        <slot name="header"></slot>\n    </div>\n    <div class="main">\n        <slot></slot>\n    </div>\n</div>\n',attrs:{home:"",appmode:null},data:{router:[],rect:{width:"",height:""},visibility:document.hidden?"hide":"show",homeLoaded:!1},watch:{appmode(e){void 0!==e&&null!==e&&me(this)},home(e){e&&(this.router.push({path:e}),h(()=>{this.router[0]._page.watchUntil("status == 'loaded'").then(e=>{this.homeLoaded=!0})}))},router(e){if(!e.length)return;let t=this._backup_router;t||(t=this._backup_router=[]);const r=t.filter(t=>!e.includes(t)),s=[];let n=e.length-1;const a=e.map((r,a)=>{if("string"==typeof r&&(r=E({path:r})).owner.add(e[p]),r._page||((o=r)._page=le({tag:"o-page",src:o.path})),r.state&&void 0===r._page.state){let e=r.state;u(r._page,{get state(){return e}})}return t.includes(r)||s.push(r),a<n?r._page.attr("page-area","back"):a==n&&(null===r._page.attr("page-area")?(r._page.attr("page-area","next"),setTimeout(()=>{r._page.attr("page-area","")},10)):r._page.attr("page-area","")),r});var o;s.forEach(e=>{this.push(e._page)}),r.forEach(e=>{e._page.attr("page-area","next"),e._page.one("transitionend",()=>{e._page.remove(),clearTimeout(t)});let t=setTimeout(()=>e._page.remove(),500)}),e[p].splice(0,1e3,...a),this._backup_router=e.slice(),e.slice(-1)[0]._page.trigger("activepage")}},proto:{get currentPage(){return this.router.slice(-1)[0]._page},back(){this.router.length>1&&this.router.splice(-1,1)}},ready(){window.addEventListener("visibilitychange",e=>{this.visibility=document.hidden?"hide":"show"});const e=()=>{this.rect.width=this.ele.clientWidth,this.rect.height=this.ele.clientHeight};if(e(),window.ResizeObserver){new ResizeObserver(t=>{e()}).observe(this.ele)}else{let t;window.addEventListener("resize",r=>{clearTimeout(t),t=setTimeout(()=>e(),300)})}}});let fe=!1;const me=async e=>{if(fe)throw{desc:"the existing app is initialized globally",target:fe};fe=e,await e.watchUntil("homeLoaded"),window.addEventListener("popstate",t=>{switch(t.state.type){case"back":e.currentPage.back(),history.forward()}}),e.watchKey({router:t=>{setTimeout(()=>{history.replaceState({type:"now"},"",`#src=${encodeURIComponent(e.currentPage.src)}`)},50)}}),history.state&&"now"===history.state.type||(history.pushState({type:"back"},"","#back"),history.pushState({type:"now"},"",`#src=${encodeURIComponent(e.currentPage.src)}`))};let ge=e.ofa;const ye={v:3e6,version:"3.0.0",get config(){return drill.config}};o(e,{ofa:{set(e){e(ye)},get:()=>ye}}),ge&&ge(ye),e.$=le})(window);