/*!
* ofa v2.9.0
* https://github.com/kirakiray/ofa.js
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/(glo=>{"use strict";(e=>{const t=()=>Math.random().toString(32).substr(2);let r=Object.prototype.toString;const a=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),s=e=>void 0===e,n=e=>a(e).includes("function"),i=e=>e instanceof T?e.object:JSON.parse(JSON.stringify(e)),l=(()=>{if(null!==document.currentScript.getAttribute("debug")){let e=new Map;return(r,a)=>{a||(a=t());let s=e.get(a);clearTimeout(s),e.set(a,setTimeout(()=>{r(),e.delete(a)}))}}let e=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let a=!1;return(s,n)=>{n||(n=t()),e.set(n,{key:n,fun:s}),a||(a=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),a=!1}))}})(),o=(e,r,a,s,n)=>{let l;l=e._modifyId?e._modifyId:t(),$(e,O).push(l),d(e);let o=new w({type:"update",target:e[E]||e});Object.defineProperties(o,{trend:{get:()=>new I(o)}}),s&&Object.assign(o,s),o.modify={name:r,args:a.map(e=>e instanceof T?e.object:e instanceof Object?i(e):e),mid:l},n&&n(o),e.emit(o)};let c,h=new Set;const d=e=>{e[O].length<50||(clearTimeout(c),h.add(e),c=setTimeout(()=>{let e=Array.from(h);setTimeout(()=>{e.forEach(e=>d(e))},1e3),h.forEach(e=>{let t=e[O];t.splice(0,Math.ceil(t.length/2))}),h.clear()},3e3))},u=e=>{if(e instanceof L)return void(e=>{e.index=void 0,e.parent=void 0,e[C].mirrorHost.off("update",e[N]),e[C].mirrorHost=void 0})(e);if(!(e instanceof T))return;let t=e[j];if(t)try{t.index=void 0,t.parent=void 0}catch(e){}if(t[A])for(let[r,a]of t[A])e.unsync(r);t.emit("clearxdata"),t[P]&&t[P].clear(),t[g]&&t[g].clear()},p=(e,t)=>{if(e instanceof L)return e;let r=e;switch(a(e)){case"object":case"array":r=new T(e,t)}return r},f=(e,t)=>{if(e instanceof Array)return e.map(e=>f(e,t));if(e instanceof Object){let r={},a=[];return Object.keys(e).forEach(s=>{/\D/.test(s)?r[s]=f(e[s]):a.push(f(e[s],t))}),a.length&&(r[t]=a),r}return e},g=Symbol("events"),m=(e,t)=>{let r=t[g];r||(r=new Map,Object.defineProperty(t,g,{value:r}));let a=r.get(e);return a||(a=[],r.set(e,a)),a},b=(e,t)=>{let r;return e instanceof w?e=(r=e).type:r=new w({type:e,target:t[E]||t}),r};class y{constructor(e={}){Object.defineProperties(this,{parent:{writable:!0,value:e.parent,configurable:!0},index:{writable:!0,value:e.index,configurable:!0}})}on(e,t,r){this.addListener({type:e,data:r,callback:t})}one(e,t,r){this.addListener({count:1,type:e,data:r,callback:t})}addListener(e={}){let{type:t,data:r,callback:a,count:n=1/0,eventId:i}=e;if(!t)throw{desc:"addListener no type",options:e};let l=t.split("#");1 in l&&(t=l[0],i=l[1]);let o=m(t,this);s(i)||Array.from(o).some(e=>{if(e.eventId===i){let t=o.indexOf(e);return t>-1&&o.splice(t,1),!0}}),a&&o.push({type:t,data:r,callback:a,eventId:i,count:n})}off(e,t){if(e){if(!t)throw{desc:"off must have callback"};{let r=m(e,this),a=r.findIndex(e=>e.callback==t);a>-1&&r.splice(a,1)}}}emitHandler(e,t){let r=b(e,this);e=r.type;let a=m(e,this),s=[];return r.currentTarget=this[E]||this,a.some(e=>{e.data&&(r.data=e.data),e.eventId&&(r.eventId=e.eventId);let a={self:this,event:r,emitData:t};if((e.before?e.before(a):1)&&e.callback.call(this[E]||this,r,t),e.after&&e.after(a),delete r.data,delete r.eventId,e.count--,e.count||s.push(e),r.cancel)return!0}),delete r.currentTarget,s.forEach(e=>{let t=a.indexOf(e);t>-1&&a.splice(t,1)}),r}emit(e,t){let r=this.emitHandler(e,t);if(r.bubble&&!r.cancel){let{parent:e}=this;e&&(r.keys.unshift(this.index),e.emit(r,t))}}}class w extends y{constructor(e){super(),this.type=e.type,this.target=e.target,this._bubble=!0,this._cancel=!1,this.keys=[]}get bubble(){return this._bubble}set bubble(e){this._bubble!==e&&(this.emitHandler("set-bubble",e),this._bubble=e)}get cancel(){return this._cancel}set cancel(e){this._cancel!==e&&(this.emitHandler("set-cancel",e),this._cancel=e)}}const v=/^_.+|^index$|^length$|^object$|^getData$|^setData$/,x=/^parent$|^index$|^length$|^object$/;let k={get:(e,t,r)=>"symbol"==typeof t||v.test(t)?Reflect.get(e,t,r):e.getData(t),set:(e,t,r,a)=>"symbol"==typeof t?Reflect.set(e,t,r,a):e.setData(t,r)};const E=Symbol("proxyThis"),j=Symbol("XDataSelf"),P=Symbol("WatchHost"),O=Symbol("ModifyIDS"),A=Symbol("SyncHost"),_=Symbol("StanzID"),$=(e,t)=>{let r=e[t];if(!r){switch(t){case P:case A:r=new Map;break;case O:case VIRDATAHOST:r=[]}Object.defineProperty(e,t,{value:r})}return r},S="undefined"!=typeof Element;class T extends y{constructor(e,r={}){super(r);let a=new Proxy(this,k),s=0,n=Object.getOwnPropertyDescriptors(e);Object.keys(n).forEach(e=>{let{value:t,get:r,set:a}=n[e];r||a?Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:r,set:a}):/^\_/.test(e)||S&&t instanceof Element?Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}):(/\D/.test(e)||(e=parseInt(e))>=s&&(s=e+1),t instanceof L?(this[e]=t,t.parent=this,t.index=e):t instanceof Object?this[e]=new T(t,{parent:this,index:e}):this[e]=t)});const i=t();Object.defineProperties(this,{[j]:{get:()=>this},[E]:{value:a},[_]:{value:i},xid:{get:()=>i},_modifyId:{value:null,writable:!0},length:{configurable:!0,writable:!0,value:s}})}setData(e,t){if(x.test(e))return console.warn("you can't set this key in XData => ",e),!1;if(/^_.+/.test(e))return Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}),!0;let r=this[j];if(/\./.test(e)){let a=e.split("."),s=a.length-1;return a.some((t,a)=>{if(a==s)return e=t,!0;r=r[t]}),r.setData(e,t),!0}let s=a(e);if("string"===s||"number"===s){let a=r[e];return t===a||(a instanceof T&&(a=a.object),t instanceof L?(t.parent&&t.remove(),t.parent=r,t.index=e):t instanceof T?(t[j]&&(t=t[j]),t.parent&&t.remove(),t.parent=r,t.index=e):t instanceof Object&&(t=p(t,{parent:r,index:e})),r[e]=t,o(r,"setData",[e,t],{oldValue:a}),!0)}if(e instanceof Object){let t=e;return Object.keys(t).forEach(e=>{let a=t[e];r.setData(e,a)}),!0}}getData(e){let t;if(e.includes&&e.includes(".")){let r=e.split(".");t=this;do{t=t[r.shift()]}while(r.length)}else t=this[e];return t instanceof T&&(t=t[E]),t}remove(e){if(s(e)){let{parent:e}=this;e?e.remove(this.index):u(this)}else{let t=this[e];/\D/.test(e)?(delete this[e],u(t),o(this,"remove",[e])):this.splice(parseInt(e),1)}}deepClear(){Object.keys(this).forEach(e=>{if(/\D/.test(e)){let t=this[e];t instanceof T&&t.deepClear(),t instanceof L&&u(t)}}),this.forEach(e=>{e instanceof T&&e.deepClear(),e instanceof L&&u(e)}),u(this)}add(e){!this.includes(e)&&this.push(e)}delete(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)}has(e){return this.includes(e)}clear(){this.splice(0,this.length)}before(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index,0,e),this}after(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index+1,0,e),this}clone(){return p(i(this))[E]}emitHandler(e,t){let r=b(e,this);if("update"===r.type){let{_unBubble:e,_update:t,_unpush:a}=this,{fromKey:s}=r.trend;(!1===t||e&&e.includes(s))&&(r.bubble=!1),a&&a.includes(s)&&Object.defineProperty(r,"_unpush",{value:!0})}return y.prototype.emitHandler.call(this,r,t),r}noStanz(e={childKey:"children"}){return f(this.object,e.childKey)}get object(){let e={},t=!0,{_unBubble:r=[]}=this;return Object.keys(this).forEach(a=>{if(/^_/.test(a)||!/\D/.test(a)||r.includes(a)||"length"===a)return;let s=this[a];if(s instanceof T||s instanceof L){if(!1===s._update)return;s=s.object}e[a]=s,t=!1}),this.forEach((t,r)=>{(t instanceof T||t instanceof L)&&(t=t.object),e[r]=t}),t&&(e.length=this.length,e=Array.from(e)),e}get string(){return JSON.stringify(this.object)}toJSON(){return JSON.stringify(this.object)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get prev(){if(!/\D/.test(this.index)&&this.index>0)return this.parent.getData(this.index-1)}get next(){if(!/\D/.test(this.index))return this.parent.getData(this.index+1)}get mirror(){return new L(this)}getTarget(e){let t=this;return e.length&&e.some(e=>{if(!t)return console.warn("getTarget failure"),!0;t=t[e]}),t}watch(e,t,r){let s,n=a(e);if("object"===n)return void Object.keys(e).forEach(r=>{this.watch(r,e[r],t)});/function/.test(n)&&(r=t,t=e,e=""),s=""===e?"watchSelf":e instanceof RegExp?"watchKeyReg":/\./.test(e)?"watchPointKey":"watchKey";let i=$(this,P).get(e);i||(i=new Set,$(this,P).set(e,i));let o,c={trends:[],callback:t,expr:e,push(e){this.trends.push(e)}};i.add(c);let h=this[E];switch(s){case"watchSelf":o=(e=>{c.push(e.trend),l(()=>{t.call(h,{trends:Array.from(c.trends)},h),c.trends.length=0},c)}),!0===r&&t.call(h,{trends:[]},h);break;case"watchKey":case"watchKeyReg":o=(r=>{let{trend:a}=r;("watchKeyReg"===s&&e.test(a.fromKey)||a.fromKey==e)&&(c.push(r.trend),c.cacheOld||(c._oldVal=r.oldValue instanceof T?r.oldValue.object:r.oldValue,c.cacheOld=!0),l(()=>{let r=this[e];t.call(h,{expr:e,val:r,old:c._oldVal,trends:Array.from(c.trends)},r),c.trends.length=0,c._oldVal=c.cacheOld=!1},c))}),!0===r&&t.call(h,{expr:e,val:h[e],trends:[]},h[e]);break;case"watchPointKey":let a=e.split("."),n=this.getTarget(a);n=n instanceof T?n.object:n,o=(r=>{let{trend:s}=r,i=s.keys.slice();if(i.length<a.length&&i.push(s.finalSetterKey),JSON.stringify(a)===JSON.stringify(i.slice(0,a.length))){let i;try{i=this.getTarget(a)}catch(r){}i!==n&&(c.push(s),l(()=>{(i=this.getTarget(a))!==n&&t.call(h,{expr:e,old:n,trends:Array.from(c.trends)},i),c.trends.length=0},c))}}),!0===r&&t.call(h,{expr:e,val:n},n)}return this.on("update",o),c.updateMethod=o,this}unwatch(e,t){let r=a(e);if("object"===r)return Object.keys(e).forEach(t=>{this.unwatch(t,e[t])}),this;/function/.test(r)&&(t=e,e="");let s=$(this,P).get(e);if(s){let r=Array.from(s).find(r=>r.callback===t&&r.expr===e);r&&(r.updateMethod&&this.off("update",r.updateMethod),s.delete(r),!s.size&&$(this,P).delete(e))}return this}watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r,a=new Function(`\n            try{with(this){\n                return ${e}\n            }}catch(e){}`).bind(this);this.watch(r=(()=>{let e=a();e&&(this.unwatch(r),t(e))}),!0)})}seek(e,t=!0){n(e)||(e=new Function(`with(this){return ${e}}`));let r=[],a=t=>{try{e.call(t,t)&&r.push(t)}catch(e){}};t&&a(this);let s=t=>{a(t),t instanceof T&&r.push(...t.seek(e,!1))};return Object.keys(this).forEach(e=>{/\D/.test(e)&&s(this[e])}),this.forEach(e=>s(e)),a=s=null,r}entrend(e){let{mid:t,keys:r,name:a,args:s,_unpush:n}=e;if(n)return;let{_unpull:i}=this,l=D(e);if(i&&i.includes(l))return;if(!t)throw{text:"Illegal trend data"};let o=this.getTarget(r);if(o){let e=o[j];if($(e,O).includes(t))return!1;e._modifyId=t,e[a](...s),e._modifyId=null}return!0}}const D=e=>{let t=e.keys[0];return!s(t)||"setData"!==e.name&&"remove"!==e.name||(t=e.args[0]),t};class I{constructor(e){if(e instanceof w){let{modify:{name:t,args:r,mid:a},keys:s}=i(e),{_unpush:n}=e;n&&Object.defineProperty(this,"_unpush",{value:!0}),Object.assign(this,{name:t,args:r,mid:a,keys:s})}else Object.assign(this,e)}get string(){return JSON.stringify(this)}get finalSetterKey(){switch(this.name){case"remove":case"setData":return this.args[0]}}get fromKey(){return D(this)}set fromKey(e){let t=this.keys[0];s(t)?"setData"!==this.name&&"remove"!==this.name||(this.args[0]=e):this.keys[0]=e}}class L{constructor(e){this[C]=this,this.mirrorHost=e,this.parent=void 0,this.index=void 0;let t=e=>{this.parent&&o(this.parent,"",[],{},t=>{Object.assign(t,{keys:i(e.keys),modify:i(e.modify),currentTarget:e.currentTarget,target:e.target,oldValue:e.oldValue}),t.keys.unshift(this.index)})};return e.on("update",t),this[N]=t,new Proxy(this,F)}remove(e){return T.prototype.remove.call(this,e)}}const N=Symbol("XMirrorUpdataBinder"),C=Symbol("XMirror_self"),M=new Set(["index","parent","remove",N,C]),F={get(e,t,r){if(M.has(t))return e[t];let a;return a="symbol"==typeof t?e.mirrorHost[t]:e.mirrorHost.getData(t),n(a)&&(a=a.bind(e.mirrorHost[E])),a},set:(e,t,r,a)=>M.has(t)?(e[t]=r,!0):e.mirrorHost.setData(t,r)},H=(e,t,r)=>{t.trends.forEach(t=>{t.fromKey===e&&r.entrend(t)})},U=(e,t,r)=>{t.trends.forEach(t=>{e.includes(t.fromKey)&&r.entrend(t)})},R=(e,t,r)=>{i(t.trends).forEach(t=>{t=new I(t);let{fromKey:a}=t;if(!s(a)){let s=e.get(a);s&&(t.fromKey=s,r.entrend(t))}})},B=e=>(e instanceof T&&(e=e.object),e),V={sync(e,t,r){let s,n;switch(a(t)){case"string":r&&e.setData(t,B(this[t])),s=(r=>H(t,r,e)),n=(e=>H(t,e,this));break;case"array":r&&t.forEach(t=>{e.setData(t,B(this[t]))}),s=(r=>U(t,r,e)),n=(e=>U(t,e,this));break;case"object":let i=new Map(Object.entries(t)),l=new Map(Object.entries(t).map(e=>e.reverse()));r&&Object.keys(t).forEach(r=>{e.setData(t[r],B(this[r]))}),s=(t=>R(i,t,e)),n=(e=>R(l,e,this));break;default:if(r){let t=this.object;Object.keys(t).forEach(r=>{e.setData(r,t[r])})}s=(t=>t.trends.forEach(t=>e.entrend(t))),n=(e=>e.trends.forEach(e=>this.entrend(e)))}this.watch(s),e.watch(n);let i=$(this,A);i.has(e)&&this.unsync(e),i.set(e,{selfWatch:s,oppWatch:n}),$(e,A).set(this,{selfWatch:n,oppWatch:s})},unsync(e){let t=$(this,A).get(e);if(t){let{selfWatch:r,oppWatch:a}=t;this.unwatch(r),e.unwatch(a),$(this,A).delete(e),$(e,A).delete(this)}}};Object.keys(V).forEach(e=>{Object.defineProperty(T.prototype,e,{writable:!0,value:V[e]})}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(T.prototype,e,{value(...e){return t.apply(this,e)}})});const K=(e,t,r)=>{(e instanceof T||e instanceof L)&&t!==r&&(e.index=t,e.emitHandler("updateIndex",{oldIndex:r,index:t}))};["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(T.prototype,e,{value(...r){let a=[],s=this[j],n=s.object;r.forEach(e=>{if(e instanceof T){let t=e[j];t.remove(),a.push(t)}else if(e instanceof L)e.parent=s,a.push(e);else{let t=p(e,{parent:s});a.push(t)}});let i=t.apply(s,a);switch(s.forEach((e,t)=>{let r=e.index;K(e,t,r)}),e){case"shift":case"pop":(i instanceof T||i instanceof L)&&u(i);break;case"splice":i.forEach(e=>{(e instanceof T||e instanceof L)&&u(e)})}return o(s,e,r,{oldValue:n}),i}})}),Object.defineProperties(T.prototype,{sort:{value(e){let t=[],r=this[j],a=r.object,s=Array.from(r);if(n(e)||!e){Array.prototype.sort.call(r,e),r.forEach((e,t)=>{let r=e.index;K(e,t,r)}),t=[s.map(e=>e.index)],s=null}else e instanceof Array&&(e.forEach((e,t)=>{let a=r[e]=s[t],n=a.index;K(a,e,n)}),t=[e]);return o(r,"sort",t,{oldValue:a}),this}}});const z=(e,t)=>{if(!e.tagName)return!1;if(e===t)return!0;if(e===document)return!1;let r=document.createElement("template"),a=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`;return r.innerHTML=a,!!r.content.querySelector(t)},G=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let{data:r}=e;if(r&&Object.keys(r).forEach(e=>{let a=r[e];t.dataset[e]=a}),t.xvele){let r=$e(t);r[te].forEach(t=>{let a=e[t];s(a)||(r[t]=a)})}let a=0;for(;a in e;){let r=G(e[a]);t.appendChild(r),a++}return t},J=Object.getOwnPropertyDescriptor,W=e=>{let t;if(e instanceof ie)return e.ele;switch(a(e)){case"string":/\<.+\>/.test(e)&&(t=(t=(e=>{let t=document.createElement("div");return t.innerHTML=e,Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e))[0]);break;case"object":t=G(e);break;default:(e instanceof Element||e instanceof DocumentFragment||e instanceof Document)&&(t=e)}return t},q=(e,t)=>{let r=e.querySelectorAll(t);return r?Array.from(r):[]},X=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),Z=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),Q={get:function(e,t){return e._ele.getAttribute(Z(t))},set:function(e,t,r){return null===r?e._ele.removeAttribute(Z(t)):e._ele.setAttribute(Z(t),String(r)),!0}};const Y=e=>{let t=e.__p_attrs;return t||(e.__p_attrs=t=new Proxy(new class{constructor(e){Object.defineProperties(this,{_ele:{get:()=>e}})}}(e),Q)),t},ee=(e,t)=>{Object.keys(t).forEach(r=>{let{get:a,set:s,value:n}=J(t,r);n?e.hasOwnProperty(r)?e[r]=n:Object.defineProperty(e,r,{value:n}):(Object.defineProperty(e,r,{get:a,set:s}),s&&ae.add(r))})},te=Symbol("cansetkeys"),re=Symbol("orignEvents"),ae=new Set(["text","html","display","style"]),se=new Set(["parent","slot"]),ne=T.prototype.setData;class ie extends T{constructor(e){super({}),delete this.parent,delete this.index,delete this.length,Object.defineProperties(e,{__xhear__:{value:this,configurable:!0}});let t=e.tagName?e.tagName.toLowerCase():"";Object.defineProperties(this,{tag:{enumerable:!0,value:t},ele:{value:e},[re]:{writable:!0,value:""}})}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?Se(e):null}get index(){let{ele:e}=this;return Array.from(e.parentNode.children).indexOf(e)}get length(){return this.ele.children.length}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get display(){return getComputedStyle(this.ele).display}set display(e){this.ele.style.display=e}get style(){return this.ele.style}set style(e){if("string"==a(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),s=Object.keys(e);r.forEach(e=>{s.includes(e)||(t[e]="")}),Object.assign(t,e)}get $shadow(){let{shadowRoot:e}=this.ele;return e&&Se(e)}get $root(){let e=this.ele;for(;e.parentNode;)e=e.parentNode;return e&&Se(e)}get $host(){let{$root:e}=this;return e&&e.ele.host&&Se(e.ele.host)}get attrs(){return Y(this.ele)}moni(e,t){let r;this.watch(()=>{let a=this.all(e),s=!0;if(r&&r.length==a.length?a.some(e=>{if(!r.includes(e))return s=!1,!0}):s=!1,s)return;let n={old:r,val:a};r=a,t(a,n)},!0)}setData(e,t){if(se.has(e))return console.warn("can't set this key => ",e),!1;e=X(e);let r=this[j],a=this[te];if(ae.has(e)){let a=J(r,e);return a&&a.set?a.set.call(this[E],t):r[e]=t,!0}if(a&&a.has(e)||/^_.+/.test(e))return ne.call(r,e,t);if(!/\D/.test(e)){let a=Te(t),s=r.ele.children[e];if(s){let n=r.getData(e).object;r.ele.insertBefore(a.ele,s),r.ele.removeChild(s),o(r,"setData",[e,t],{oldValue:n})}else r.ele.appendChild(a.ele),o(r,"setData",[e,t],{oldValue:void 0})}return!0}getData(e){e=X(e);let t,r=this[j];if(/\D/.test(e)){let a=J(r,e);if(a){let{get:r,value:n}=a;s(n)?r&&(t=r.call(this[E],e)):t=n}else t=r[e]}else(t=r.ele.children[e])&&(t=Se(t));return t instanceof T&&(t=t[E]),t}siblings(e){let t=Array.from(this.parent.ele.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(z(t,e))return!0})),t.map(e=>Se(e))}empty(){return this.splice(0,this.length),this}parents(e,t){let r=[],s=this.parent;if(e){if("string"==a(e))for(;s&&s;)z(s.ele,e)&&r.push(s),s=s.parent}else for(;s;)r.push(s),s=s.parent;if(t)if(t instanceof ie){let e=[];r.some(r=>{if(r===t)return!0;e.push(r)}),r=e}else if("string"==a(t)){let e=[];r.some(r=>{if(r.is(t))return!0;e.push(r)}),r=e}return r}is(e){return z(this.ele,e)}$(e){let t=this.ele.querySelector(e);if(t)return Se(t)}all(e){return q(this.ele,e).map(e=>Se(e))}clone(){let e=Se(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}}const le=ie.prototype,oe=e.MouseEvent||Event,ce=e.TouchEvent||Event,he=new Map([["click",oe],["mousedown",oe],["mouseup",oe],["mousemove",oe],["mouseenter",oe],["mouseleave",oe],["touchstart",ce],["touchend",ce],["touchmove",ce]]),de=e=>{let t,r,s,n=e[0];if("object"==a(n)){let e=n;n=e.event,r=e.callback,s=e.data,t=e.selector}else switch(a(e[1])){case"string":t=e[1],r=e[2],s=e[3];break;default:r=e[1],s=e[2]}return{eventName:n,selector:t,callback:r,data:s}};function ue(e,t={count:1/0}){let{eventName:r,selector:a,callback:s,data:n}=de(e),i=this[re]||(this[re]=new Map);if(!i.has(r)){let e=e=>{let a,{_para_x_eve_:n}=e;if(n){(a=n).target.ele!==e.target&&(a.target=Se(e.target));let t=[],r=e.target;for(;r!==e.currentTarget;){let e=r.parentNode;if(!e)break;let a=Array.from(e.children).indexOf(r);t.unshift(a),r=e}a.keys=t}else(a=new w({type:r,target:Se(e.target)})).on("set-bubble",(t,r)=>!r&&e.stopPropagation()),a.on("set-cancel",(t,r)=>r&&e.stopImmediatePropagation()),a.preventDefault=e.preventDefault.bind(e),e._para_x_eve_=a;a.originalEvent=e,this.emitHandler(a),a.originalEvent=null,t.count--,t.count||this.off(r,s)};i.set(r,e),this.ele.addEventListener(r,e)}if(this.addListener({type:r,count:t.count,data:n,callback:s}),a){m(r,this).forEach(e=>{e.callback==s&&(e.before=(e=>{let t,{self:r,event:s}=e,n=s.target;return(t=n.is(a)?n:n.parents(a)[0])?(Object.assign(s,{selector:a,delegateTarget:t}),1):0}),e.after=(e=>{let{self:t,event:r}=e;delete r.selector,delete r.delegateTarget}))})}}ee(le,{on(...e){return ue.call(this,e),this},off(...e){let t=e[0],r=m(t,this);if(T.prototype.off.apply(this,e),!r.length){let e=this[re]||(this[re]=new Map),r=e.get(t);r&&this.ele.removeEventListener(t,r),e.delete(t)}return this},one(...e){return ue.call(this,e,{count:1}),this},trigger(e,t){let r,a={bubbles:!0,cancelable:!0};if(Object.assign(a,t),e instanceof Event)r=e;else{r=new(he.get(e)||Event)(e,{bubbles:a.bubbles,cancelable:a.cancelable})}return this.ele.dispatchEvent(r),this}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(le,e,{value(...e){return t.apply(Array.from(this.ele.children).map(e=>Se(e)),e)}})});const pe=(e,t)=>{e.forEach((e,r)=>{let a=t.findIndex(t=>t===e);-1!==a&&a!==r&&K(e,r,a)})},fe=(e,t,r,a=[])=>{let s=e[j],n=[];t<0&&(t+=s.length);let i=s.ele,{children:l}=i,c=/\D/.test(r)?s.length:r,h=s.map(e=>e);for(;c>0;){let e=l[t];if(!e)break;n.push(Se(e)),i.removeChild(e),c--}let d=l[t];if(a.length){let e=document.createDocumentFragment();a.forEach(t=>e.appendChild(W(t))),t>=0&&d?i.insertBefore(e,d):i.appendChild(e)}return pe(s,h),o(s,"splice",[t,r,...a]),n},ge=(e,t)=>{let r=e[j],{ele:a}=r,s=Array.from(a.children),n=document.createDocumentFragment();t.forEach(e=>{let t=s[e];t.xvele&&(t[ye]=1),n.appendChild(t)}),a.appendChild(n),s.forEach(e=>e.xvele&&(e[ye]=0))};ee(le,{push(...e){return fe(this,this.length,0,e),this.length},splice(e,t,...r){return fe(this,e,t,r)},unshift(...e){return fe(this,0,0,e),this.length},shift(){return fe(this,0,1)},pop(){return fe(this,this.length-1,1)},reverse(){let e=this.map(e=>e),t=Array.from(this.ele.children),r=t.length;ge(this,t.map((e,t)=>r-1-t)),pe(this,e),o(this[j],"reverse",[])},sort(e){let r=this.map(e=>e);if(n(e)){let r=Array.from(this.ele.children).map(e=>Se(e)),a=Array.from(r);r.sort(e),e=[];let s=t();r.forEach(t=>{let r=a.indexOf(t);a[r]=s,e.push(r)})}e instanceof Array&&ge(this,e),pe(this,r),o(this[j],"sort",[e])}});const me=({useTempName:e,temps:t,itemData:r,host:a,parent:s,index:n})=>{let i,l=t.get(e);if(!l)throw{desc:"find out the template",name:e,targetElement:a.ele};(i=p(r instanceof T?{$data:r.mirror,$host:(a.$host&&a.$data?a.$host:a).mirror,get $parent(){return s},get $index(){return void 0!==r.index?r.index:n}}:{get $data(){return r},set $data(e){s[n]=e},$host:(a.$host&&a.$data?a.$host:a).mirror,get $parent(){return s},get $index(){return void 0!==r.index?r.index:n}}))[te]=new Set,i=i[E];let o=$e(W(l.innerHTML));return o._update=!1,o.__fill_item=r,o.__fake_item=i,Oe({sroot:o.ele,proxyEle:i,temps:t}),{itemEle:o,fakeData:i}},be=new Map,ye=Symbol("runArray"),we=Symbol("renderend"),ve=Symbol("renderend_resove"),xe=(Symbol("renderend_reject"),t(),e=>(ke.lastIndex=0,ke.test(e.trim()))),ke=/(".*?"|'.*?'|\(|\)|\[|\]|\{|\}|\|\||\&\&|\?|\!|:| |\+|\-|\*|%|\,|\<|\>)/g,Ee=e=>new Function("...args",`\n    const $event = args[0];\n    const $args = args;\n    args = undefined;\n    with(this){\n        try{\n            return ${e}\n        }catch(e){\n            let ele = this.ele;\n            if(!ele && this.$host){\n                ele = this.$host.ele;\n            }\n            let errObj = {\n                expr:'${e.replace(/'/g,"\\'").replace(/"/g,'\\"')}',\n                target:ele,\n                error:e\n            }\n            ele && ele.__xInfo && Object.assign(errObj,ele.__xInfo);\n            console.error(errObj);\n        }\n    }\n        `),je=e=>{let t=document.createTextNode(""),r=e.parentNode;return r.insertBefore(t,e),r.removeChild(e),{textnode:t,par:r}},Pe=(e,t,r={rmAttr:!0})=>{let a=q(e,t).map(e=>({ele:e}));e instanceof Element&&$e(e).is(t)&&a.unshift({ele:e});let s=/^\[(.+)\]$/.exec(t);if(a.length&&s){let e=s[1];a.forEach(t=>{let{ele:a}=t,s=a.getAttribute(e);r.rmAttr&&(a.removeAttribute(e),a.setAttribute(`rendered-${e}`,s)),t.attrVal=s})}return a};const Oe=({sroot:e,proxyEle:r,temps:a,templateId:s})=>{let i=new class{constructor(e){this.processObj=new Map,this.proxyEle=e,this._hasAdd=!1}init(){if(!this._hasAdd)return;let{processObj:e,proxyEle:t}=this;const r=t[te];for(let[a,s]of e){let{calls:e,target:n}=s;if(n=n||t,r.has(a)){let r;n.watch(a,r=((t,r)=>{e.forEach(e=>e.change(r,t.trends))})),l(()=>r({},n[a])),t.on("clearxdata",e=>{n.unwatch(a,r)})}else{let r,s,i=Ee(a),o=1;n.watch(s=(t=>{let a=i.call(n);if(o)o=0;else if(a===r||a instanceof T&&a.string===r)return;let s=t?t.trends:void 0;e.forEach(e=>e.change(a,s)),r=a instanceof T?a.string:a})),l(()=>s({})),t.on("clearxdata",e=>{n.unwatch(s)}),n.on("updateIndex",s),n.on("reloadView",s)}}}add(e,t){let r=this.processObj,a=r.get(e.trim());a?a=a.calls:(a=[],r.set(e,{calls:a})),a.push({change:t}),this._hasAdd=!0}remove(e,t){let r=this.processObj.get(e.trim());if(r){let e=(r=r.calls).findIndex(e=>e.change===t);r.splice(e,1)}}}(r);const o=r[te];Pe(e,"[x-if]").forEach(t=>{let n,{ele:l,attrVal:o}=t,{textnode:c,par:h}=je(l),d=t.ele;i.add(o,t=>{!t&&n?(h.removeChild(n.ele),n=null):t&&!n&&(n=Se(W(d.innerHTML)),h.insertBefore(n.ele,c),Oe({sroot:e,proxyEle:r,temps:a,xpAgent:i,templateId:s}))})});let c=Pe(e,"[x-fill]");c.length&&c.forEach(e=>{let{ele:t,attrVal:s}=e,n=s.match(/(.+?) +use +(.+)/);if(!n)return void console.error({expr:s,desc:"fill expression error"});let[,i,o]=n;(({ele:e,attrName:t,useTempName:r,host:a,temps:s})=>{let n=Se(e);n._update=!1;let i=a[t];i.forEach((t,n)=>{let{itemEle:l}=me({useTempName:r,itemData:t,temps:s,host:a,parent:i,index:n});e.appendChild(l.ele)}),a.watch(t,e=>{let i=a[t];e.trends.forEach(e=>{let o=e.keys.slice();"setData"==e.name&&e.keys.length<t.split(".").length&&o.push(e.args[0]),t==o.join(".")&&l(()=>{i=a[t],n.forEach(e=>{let t=e.__fill_item;t instanceof T?i.includes(t)?e.ele[ye]=1:(e.__fill_item=null,e.ele.parentNode.removeChild(e.ele)):e.ele.parentNode.removeChild(e.ele)});let e=n.map(e=>e.ele),l=document.createDocumentFragment();i.forEach((e,t)=>{let o=n.find(t=>t.__fill_item==e);if(o)l.appendChild(o.ele);else{let{itemEle:n}=me({useTempName:r,itemData:e,temps:s,host:a,parent:i,index:t});l.appendChild(n.ele)}}),n.ele.appendChild(l),e.forEach(e=>e[ye]=0)},i)})})})({ele:t,attrName:i,useTempName:o,host:r,temps:a})}),Pe(e,"[x-target]").forEach(e=>{let{ele:t,attrVal:a}=e;Object.defineProperty(r,"$"+a,{get:()=>Se(t)})}),Pe(e,"[x-show]").forEach(e=>{let{ele:t,attrVal:r}=e;i.add(r,e=>{t.style.display=e?"":"none"})}),Pe(e,"x-span").forEach(e=>{let{ele:t}=e,{textnode:r,par:a}=je(t),s=t.getAttribute("xvkey");i.add(s,e=>{e=e instanceof T?e.string:String(e),r.textContent=e})}),Pe(e,"[x-on]").forEach(t=>{let{ele:a,attrVal:s}=t,i=JSON.parse(s),l=$e(a);Object.keys(i).forEach(t=>{let a,[s,...o]=t.split("."),c=i[t];a=xe(c)?Ee(c):r[c];let h="on";o.includes("once")&&(h="one");let d=n(a);d||console.warn({target:e,eventName:s,desc:"no binding functions"}),l[h](s,(e,t)=>{o.includes("prevent")&&e.preventDefault(),o.includes("stop")&&(e.bubble=!1),d&&a.call(r,e,t)})})}),Pe(e,"[x-bind]").forEach(e=>{let{ele:t,attrVal:a}=e,s=JSON.parse(a);Object.keys(s).forEach(e=>{let a=s[e],n=/^#(.+)/.exec(e);if(n){if(e=n[1],n=!!n,xe(a))throw{desc:"Function expressions cannot be used for sync binding"};o.has(a)||/^\$data\./.test(a)||"$data"===a||console.error({desc:"the key can't sync bind",key:"attrName",target:t,host:r}),$e(t).watch(e,(e,t)=>{r.setData(a,t)})}i.add(a,r=>{r instanceof ie&&(r=r.object),t.xvele?$e(t).setData(e,r):(e=Z(e),void 0===r||null===r?t.removeAttribute(e):t.setAttribute(e,r))})})});let h=new Set;Pe(e,"[x-model]").forEach(a=>{let{ele:n,attrVal:i}=a;if(h.has(n))return;let o=i;switch(n.tagName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":let a=Pe(e,`input[type="checkbox"][rendered-x-model="${o}"][x-model-id="${s}"]`);return void(a.length>1?(a.forEach(e=>{e.ele.addEventListener("change",e=>{let{value:t,checked:a}=e.target,s=r.getData(o);a?s.add(t):s.delete(t)})}),a.forEach(e=>{h.add(e)})):(r.watch(o,(e,t)=>{n.checked=t},!0),n.addEventListener("change",e=>{let{checked:t}=n;r.setData(o,t)})));case"radio":let i=Pe(e,`input[type="radio"][rendered-x-model="${o}"][x-model-id="${s}"]`),l=t();return void i.forEach(e=>{let t=e.ele;t.setAttribute("name",`radio_${o}_${l}`),t.addEventListener("change",e=>{t.checked&&r.setData(o,t.value)})})}case"textarea":case"text":r.watch(o,(e,t)=>{n.value=t}),l(()=>n.value=r[o]),n.addEventListener("input",e=>{r.setData(o,n.value)});break;case"select":r.watch(o,(e,t)=>{n.value=t}),l(()=>n.value=r[o]),n.addEventListener("change",e=>{r.setData(o,n.value)});break;default:if(n.xvele){let e=n.__xhear__;e.watch("value",(e,t)=>{r.setData(o,t)}),r.watch(o,(t,r)=>{e.setData("value",r)},!0)}else console.warn("can't x-model with thie element => ",n)}}),h.clear(),h=null,i.init()},Ae=e=>{let r=document.createElement("template");r.innerHTML=e,Array.from(r.content.querySelectorAll("[x-if]")).forEach(e=>{if("template"==e.tagName.toLowerCase())return;let t=document.createElement("template");t.setAttribute("x-if",e.getAttribute("x-if")),e.removeAttribute("x-if"),e.parentNode.insertBefore(t,e),t.content.appendChild(e)}),Array.from(r.content.querySelectorAll("template")).forEach(e=>{let{html:t}=Ae(e.innerHTML);e.innerHTML=t});let{templateId:a}=(e=>{let r=t();return Pe(e,"*").forEach(e=>{let{ele:t}=e,a=Array.from(t.attributes),s=new Set,n={},i={};a.forEach(e=>{let{name:r,value:a}=e;if("$"===(r=X(r)))return t.setAttribute("x-target",a),void s.add(r);let l=/^@(.+)/.exec(r);if(l)return n[l[1]]=a,void s.add(r);let o=/^:(.+)/.exec(r);return o?(i[o[1]]=a,void s.add(r)):void 0});let l=JSON.stringify(n);"{}"!=l&&t.setAttribute("x-on",l);let o=JSON.stringify(i);"{}"!=o&&t.setAttribute("x-bind",o),s.forEach(e=>{t.removeAttribute(Z(e))}),t.getAttribute("x-model")&&t.setAttribute("x-model-id",r)}),{templateId:r}})(r.content);return{templateId:a,html:r.innerHTML}},_e=(e,t)=>{let r=$e(e),a=[];t.proto&&ee(r,t.proto);let n,{temp:i}=t,o=Object.assign({},t.data),c=Object.keys(o);c.push(...t.attrs),c.push(...Object.keys(t.watch)),(c=new Set(c)).forEach(e=>{/^_.+/.test(e)&&c.delete(e)});let h=r[te];if(h?c.forEach(e=>h.add(e)):Object.defineProperty(r,te,{value:c}),c.has("value")&&Object.defineProperty(e,"value",{get:()=>r.value,set(e){r.value=e}}),r.watch(t.watch),t.attrs.forEach(t=>{r.watch(t,r=>{null===r.val||void 0===r.val?e.removeAttribute(Z(t)):e.setAttribute(Z(t),r.val)})}),Object.keys(o).forEach(e=>{let t=o[e];s(t)||r.setData(e,t)}),i){n=e.attachShadow({mode:"open"});var d=(i=i.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);d&&d.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(i=i.replace(e,`<x-span xvkey="${t[1].trim()}"></x-span>`))});let{html:t,templateId:a}=Ae(i);n.innerHTML=t;let s=new Map,l=Array.from(n.querySelectorAll("template[name]"));l.length&&l.forEach(e=>{e.parentNode.removeChild(e);let t=e.getAttribute("name");s.set(t,e)}),Oe({sroot:n,proxyEle:r[E],temps:s,templateId:a})}if(n){let t=q(n,"link");t.length&&t.forEach(t=>{a.push(new Promise((r,a)=>{t.sheet?r():(t.addEventListener("load",e=>{r()}),t.addEventListener("error",t=>{a({desc:"link load error",error:t,target:e})}))}))})}let u=()=>{l(()=>e.setAttribute("x-ele",1),e.xvid),r[ve](),r.trigger("renderend",{bubbles:!1}),u=null};a.length?Promise.all(a).then(()=>{u()}):u()},$e=e=>e.__xhear__||new ie(e),Se=e=>$e(e)[E];let Te=e=>{if(e instanceof ie)return e;let t;return(t="string"!==a(e)||/\<.+\>/.test(e)?W(e):document.querySelector(e))?Se(t):null};Object.assign(Te,{register:e=>{let r={tag:"",temp:"",attrs:[],data:{},watch:{}};Object.assign(r,e);let s=r.attrs,n=a(s);if("object"==n){let e=Object.keys(s);e.forEach(e=>{r.data[X(e)]=s[e]}),s=r.attrs=e.map(e=>X(e))}else"array"==n&&(s=r.attrs=s.map(e=>X(e)));r.data=i(r.data),r.watch=Object.assign({},r.watch);let o=r.tag=Z(r.tag);const c=class extends ie{constructor(...e){super(...e),this[we]=new Promise((e,t)=>{this[ve]=e})}get finish(){return this[we]}};r.proto&&ee(c.prototype,r.proto);let h=document.currentScript&&document.currentScript.src;const d=class extends HTMLElement{constructor(){super(),this.__xInfo={scriptSrc:h},delete this.__xhear__;let e=new c(this);Object.defineProperty(this,"xvele",{value:!0}),Object.defineProperty(e,"xvele",{value:!0});let a=this.xvid="xv"+t(),s=Object.assign({},r);this.parentElement?this.setAttribute("x-ele",""):l(()=>this.setAttribute("x-ele",""),a),_e(this,s),s.ready&&s.ready.call(e[E]),s.slotchange&&e.$shadow.on("slotchange",t=>s.slotchange.call(e[E],t)),Object.defineProperties(this,{[ye]:{writable:!0,value:0}})}connectedCallback(){this[ye]||r.attached&&r.attached.call(Se(this))}disconnectedCallback(){if(this[ye])return;let e=Se(this);r.detached&&r.detached.call(e),e.deepClear()}attributeChangedCallback(e,t,r){let a=this.__xhear__;r!=a[e=X(e)]&&a.setData(e,r)}static get observedAttributes(){return s.map(e=>Z(e))}};Object.assign(r,{XhearElement:d}),be.set(r.tag,r),customElements.define(o,d)},nextTick:l,xdata:e=>p(e)[E],v:5004e3,version:"5.4.0",fn:le,isXhear:e=>e instanceof ie,ext:e=>{e({renderComponent:_e})},all:e=>q(document,e).map(e=>Se(e))}),e.$=Te})(window),(glo=>{const getRandomId=()=>Math.random().toString(32).substr(2);var objectToString=Object.prototype.toString,getType=e=>objectToString.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const isFunction=e=>getType(e).search("function")>-1;var isEmptyObj=e=>!(0 in Object.keys(e));const nextTick=(()=>{if(null!==document.currentScript.getAttribute("debug")){let e=new Map;return(t,r)=>{r||(r=getRandomId());let a=e.get(r);clearTimeout(a),e.set(r,setTimeout(()=>{t(),e.delete(r)}))}}let e=new Map,t=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(t=process.nextTick);let r=!1;return(a,s)=>{s||(s=getRandomId()),e.set(s,{key:s,fun:a}),r||(r=!0,t(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(e){console.error(e)}e.delete(t)}),e.clear(),r=!1}))}})(),getFileType=e=>{let t,r=e.split("/").pop().match(/(.+)\.(.+)/);return r&&(t=r[2]),t},getDir=e=>{let t=(e=(e=e.replace(/(.+)#.+/,"$1")).replace(/(.+)\?.+/,"$1")).match(/(.+\/).*/);return t&&t[1]},getFullPath=(e,t)=>{!t&&(t=getDir(document.location.href));let r=e;return/^.+:\/\//.test(t)||(t=getDir(getFullPath(t))),/^.+:\/\//.test(e)||(r=/^\/.+/.test(e)?location.origin+e:t+e),r},removeParentPath=e=>{let t=[];return e.split(/\//g).forEach(e=>{".."==e&&t.length&&".."!=t.slice(-1)[0]?t.pop():t.push(e)}),t.join("/")},processors=new Map,loaders=new Map,bag=new Map,paths=new Map,dirpaths={};let offline=!1;const cacheDress=new Map;let errInfo={time:100,backups:[]},baseUrl=getDir(location.href),base={processors:processors,loaders:loaders,bag:bag,paths:paths,dirpaths:dirpaths,errInfo:errInfo,baseUrl:"",tempM:{}};loaders.set("css",e=>new Promise((t,r)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=e.link;let s=!1;a.onload=(async()=>{t(async e=>(s||(s=!0,e.param.includes("-unAppend")&&document.head.removeChild(a)),a))}),a.onerror=(e=>{r({desc:"load link error",target:a,event:e})}),document.head.appendChild(a)})),loaders.set("json",async e=>{let t=await fetch(e.link);return t=await t.json(),async()=>t}),loaders.set("wasm",async e=>{let t=await fetch(e.link);t=await t.arrayBuffer();let r=await WebAssembly.compile(t);const a=new WebAssembly.Instance(r);return async()=>a.exports}),loaders.set("frame",async e=>{let t=document.createElement("iframe");Object.assign(t.style,{position:"absolute","z-index":"-1",border:"none",outline:"none",opacity:"0",width:"0",height:"0"});let{link:r,path:a}=e,s=a.replace(/\.frame$/,"/frame.html"),n=r.replace(a,s);t.src=n;let i=new Map,l=()=>{bag.delete(a),document.body.removeChild(t),window.removeEventListener("message",o),o=e=l=null};e.timer=setTimeout(l,1e4);let o,c=r=>new Promise(a=>{let s=getRandomId();clearTimeout(e.timer),i.set(s,{res:a}),t.contentWindow.postMessage({type:"drillFrameTask",taskId:s,data:r.data},"*")});return window.addEventListener("message",o=(t=>{let{data:r,taskId:a}=t.data;if(i.has(a)){let e=i.get(a);i.delete(a),e.res(r)}i.size||(e.timer=setTimeout(l,1e4))})),new Promise((e,r)=>{t.addEventListener("load",t=>{e(c)}),t.addEventListener("error",e=>{l(),r()}),document.body.appendChild(t)})}),loaders.set("js",e=>new Promise((t,r)=>{let a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=e.link,a.addEventListener("load",async()=>{let r,{tempM:a}=base,{type:s}=a,n=processors.get(s||"file");if(!n)throw"no such this processor => "+s;r=await n(e),t(r)}),a.addEventListener("error",()=>{r()}),document.head.appendChild(a)}));try{eval('\n    loaders.set("mjs", async packData => {\n        let d = await import(packData.link);\n\n        return async () => {\n            return d;\n        }\n    });\n    ')}catch(e){console.warn("browser does not support asynchronous es module")}const returnUrlSets=new Set(["png","jpg","jpeg","bmp","gif","webp"]),getLoader=e=>{let t=loaders.get(e);return t||(t=getByUtf8),returnUrlSets.has(e)&&(t=getByUrl),t},getByUtf8=async e=>{let t=await fetch(e.link);return t=await t.text(),async()=>t},getByUrl=async e=>{if(e.offlineUrl)return async()=>e.offlineUrl;let t=await fetch(e.link),r=await t.blob(),a=URL.createObjectURL(r);return async()=>a},isHttpFront=e=>/^http/.test(e);class PackData{constructor(e){Object.assign(this,e),this.stat=1,this.passPromise=new Promise((e,t)=>{this._passResolve=e,this._passReject=t}),this.errPaths=[]}get dir(){return getDir(this.path)}get nextLink(){this.stat=2;let e=void 0!=this._backupId?++this._backupId:this._backupId=0,{backups:t}=errInfo,r=t[e-1]||base.baseUrl,a=t[e];if(!a)return;let s=getFullPath(r),n=getFullPath(a);this.errPaths.push(this.link);let i=this.link.replace(s,n);return this.link=i,i}resolve(e){this.getPack=e,this.stat=3,this._passResolve()}reject(){this.stat=4,this._passReject({desc:"load source error",link:this.errPaths,packData:this})}}let agent=async e=>{if(e.param&&e.param.includes("-getLink")&&!offline)return Promise.resolve(e.link);let t=bag.get(e.path);if(!t)for(t=new PackData({path:e.path,link:e.link,fileType:e.fileType}),bag.set(e.path,t);;)try{t.link=await cacheSource({packData:t});let r=await getLoader(e.fileType)(t)||(async()=>{});t.resolve(r);break}catch(r){if(t.stat=2,isHttpFront(e.str)){t.reject();break}if(!t.nextLink){t.reject();break}await new Promise(e=>setTimeout(e,errInfo.time))}return await t.passPromise,e.param&&e.param.includes("-getLink")&&offline?Promise.resolve(t.link):await t.getPack(e)};const drill={load:(...e)=>load(toUrlObjs(e)),remove(e){let{path:t}=fixUrlObj({str:e});if(bag.has(t))return bag.delete(t),!0;console.warn(`pack %c${e}`,"color:red","does not exist")},has(e){let{path:t}=fixUrlObj({str:e}),r=bag.get(t);return r&&r.stat},config(e){e.baseUrl&&(base.baseUrl=e.baseUrl);let t=e.paths;t&&Object.keys(t).forEach(e=>{let r=t[e];if(/^@.+\/$/.test(e)){let t="^"+e;r=r.replace(/\/\.\//,"/"),/^\.\./.test(r)?r=removeParentPath(getDir(document.location.href)+base.baseUrl+r):/^\//.test(r)&&(r=location.origin+r);let a=new RegExp(t);dirpaths[e]={reg:a,value:r}}else/^\w+$/.test(e)?paths.set(e,r):console.warn("this Paths settings do not meet specifications",e)}),base.baseUrl&&e.backups&&e.backups.forEach(e=>errInfo.backups.push(e))},ext(e,t){if(isFunction(e))e(base);else{let r,a=(...e)=>t(e,r,base);switch(e){case"fixUrlObj":r=fixUrlObj,fixUrlObj=a;break;case"load":r=load,load=a;break;case"agent":r=agent,agent=a;break;case"cacheSource":r=cacheSource,cacheSource=a}}},cacheInfo:{k:"d_ver",v:""},get offline(){return offline},set offline(e){offline?console.error("offline mode has been activated"):offline=e},debug:{bag:bag},version:"3.5.5",v:3005005},setProcessor=(e,t)=>{processors.set(e,async e=>{let r=base.tempM.d;return base.tempM={},await t(e,r,{relativeLoad:(...t)=>load(toUrlObjs(t,e.dir))})});let r=t=>{base.tempM={type:e,d:t}};drill[e]||(drill[e]=r),glo[e]||(glo[e]=r)},setCacheDress=(e,t)=>{cacheDress.set(e,async({file:e,packData:r})=>{let a=e,s=await e.text(),n=await t({fileText:s,file:e,relativeLoad:(...e)=>load(toUrlObjs(e,r.dir))});return s!==n&&(a=new File([n],e.name,{type:e.type})),a})};let load=e=>{let t,r=new Promise((r,a)=>{let s=[],{length:n}=e,i=n,l=[];e.forEach(async(e,o)=>{let c,h="succeed";await new Promise(e=>nextTick(e)),c=await agent(e).catch(t=>{h="error",Object.assign(e,{type:"error",descript:t}),l.push(e)}),s[o]=c,t&&t({id:o,sum:i,ready:i-n+1,stat:h}),--n||(l.length?a(l):r(1==i?c:s),s=null)})});return r.post=function(t){return e.forEach(e=>e.data=t),this},r.pend=function(e){return t=e,this},r},fixUrlObj=e=>{let t,r,a,s,n,{str:i,relative:l}=e;if(bag.has(i)){let t=bag.get(i);return Object.assign(e,{path:t.path,link:t.link}),e}[t,...n]=i.split(/\s/).filter(e=>e&&e),(a=t.match(/(.+)\?(\S+)$/)||"")&&(t=a[1],a=a[2]);let o=paths.get(t);if(o)t=o;else for(let e in dirpaths){let r=dirpaths[e];if(r.reg.test(t)){t=t.replace(r.reg,r.value);break}}/^.+:\/\//.test(t)||(t=n.includes("-r")?getFullPath(t):/^\./.test(t)?getFullPath(t,l||base.baseUrl):getFullPath(t,base.baseUrl)),t=t.replace(/\/\.\//,"/"),/\.\.\//.test(t)&&(t=removeParentPath(t)),(s=getFileType(t))||/\/$/.test(t)||(n.includes("-p")&&(t=t+"/"+t.replace(/.+\/(.+)/,"$1")),t+=".js",s="js"),r=a?t+"?"+a:t;{let{k:e,v:t}=drill.cacheInfo;e&&t&&!n.includes("-unCacheSearch")&&(r=r.includes("?")?`${r}&${e}=${t}`:`${r}?${e}=${t}`)}return n.includes("-mjs")&&(s="mjs"),Object.assign(e,{link:r,search:a,fileType:s,path:t.replace(location.origin,""),param:n}),e};const toUrlObjs=(e,t)=>{let r=getRandomId();return e.map((e,a)=>fixUrlObj({loadId:getRandomId(),id:a,str:e,groupId:r,relative:t}))};processors.set("file",e=>{}),setProcessor("define",async(e,t,{relativeLoad:r})=>{let a={},s={exports:a};if(isFunction(t)){let{path:n,dir:i}=e;t=t(r,a,s,{FILE:n,DIR:i})}return t instanceof Promise&&(t=await t),t||isEmptyObj(s.exports)||(t=s.exports),async()=>t}),setProcessor("task",(e,t,{relativeLoad:r})=>{if(!isFunction(t))throw"task must be a function";let{path:a,dir:s}=e;return async e=>{return await t(r,e.data,{FILE:a,DIR:s})}}),setProcessor("init",(e,t,{relativeLoad:r})=>{if(!isFunction(t))throw"init must be a function";let a,{path:s,dir:n}=e,i=0;return async e=>i?a:(a=await t(r,e.data,{FILE:s,DIR:n}),i=1,a)}),setCacheDress("css",async({fileText:e,relativeLoad:t})=>{let r=e.match(/@import ["'](.+?)["']/g);r&&await Promise.all(r.map(async r=>{let a=r.replace(/@import ["'](.+?)["']/,"$1"),s=await t(`${a} -getLink`);e=e.replace(r,`@import "${s}"`)}));let a=e.match(/url\((.+?)\)/g);return a&&await Promise.all(a.map(async r=>{let a=r.replace(/url\((.+?)\)/,"$1").replace(/["']/g,"");if(/(^http:)|(^https:)/.test(a))return Promise.resolve("");let s=await t(`${a} -getLink`);e=e.replace(r,`url("${s}")`)})),e}),setCacheDress("mjs",async({fileText:e,relativeLoad:t})=>{let r=e.match(/import .+ from ['"](.+?)['"];/g);r&&await Promise.all(r.map(async r=>{let a=r.match(/(import .+ from) ['"](.+?)['"];/,"$1");if(a){let s=a[2],n=await t(`${s} -getLink`);e=e.replace(r,`${a[1]} "${n}"`)}}));let a=e.match(/import\(.+?\)/g);return a&&await Promise.all(a.map(async r=>{let a=r.replace(/import\(["'](.+?)['"]\)/,"$1"),s=await t(`${a} -getLink`);e=e.replace(r,`import("${s}")`)})),e});const DBNAME="drill-cache-db",FILESTABLENAME="files";let mainDB,isInitDB=new Promise((e,t)=>{const r=glo.indexedDB||glo.webkitIndexedDB||glo.mozIndexedDB||glo.msIndexedDB;if(r){let t=r.open(DBNAME,drill.cacheInfo.v||1);t.onupgradeneeded=(e=>{let t=e.target.result;t.objectStoreNames.contains(FILESTABLENAME)?(t.deleteObjectStore(FILESTABLENAME),t.createObjectStore(FILESTABLENAME,{keyPath:"path"})):t.createObjectStore(FILESTABLENAME,{keyPath:"path"})}),t.onsuccess=(t=>{mainDB=t.target.result,e()})}else t("rubish browser no indexDB")}),cacheSource=async({packData:e})=>{if(!offline)return e.link;await isInitDB;let t=await getFile(e.path);if(!t){let r=await fetch(e.link);if(200!=r.status)throw{type:"cacheSource",desc:"statusError",status:r.status};let a=r.headers.get("Content-Type").replace(/;.+/,""),s=e.path.replace(/.+\//,""),n=await r.blob();t=new File([n],s,{type:a}),await saveFile(e.path,t)}let r=cacheDress.get(e.fileType);return r&&(t=await r({file:t,packData:e})),e.offlineFile=t,e.offlineUrl=URL.createObjectURL(t)};const getFile=e=>new Promise((t,r)=>{let a=mainDB.transaction([FILESTABLENAME],"readonly").objectStore(FILESTABLENAME).get(e);a.onsuccess=(()=>{t(a.result&&a.result.data)}),a.onerror=(t=>{r(),console.error(`error load ${e}`,t)})}),saveFile=(e,t)=>new Promise((r,a)=>{let s=mainDB.transaction([FILESTABLENAME],"readwrite").objectStore(FILESTABLENAME).put({path:e,data:t});s.onsuccess=(()=>{r({stat:1}),console.log(`save ${e} succeed`)}),s.onerror=(t=>{r({stat:0}),console.error(`save (${e}) error`,t)})});Object.defineProperty(base,"main",{value:{get agent(){return agent},get load(){return load},get fixUrlObj(){return fixUrlObj},get toUrlObjs(){return toUrlObjs},get setProcessor(){return setProcessor}}}),glo.load||(glo.load=drill.load);let cScript=document.currentScript;if(!cScript&&(cScript=document.querySelector(["drill-cache"])),cScript){let e=cScript.getAttribute("drill-cache");e&&(drill.cacheInfo.v=e)}let oldDrill=glo.drill;Object.defineProperty(glo,"drill",{get:()=>drill,set(e){isFunction(e)?nextTick(()=>e(drill)):console.error("drill type error =>",e)}}),oldDrill&&nextTick(()=>oldDrill(drill))})(window);const getRandomId=()=>Math.random().toString(32).substr(2),getType=e=>Object.prototype.toString.call(e).toLowerCase().replace(/(\[object )|(])/g,""),isFunction=e=>getType(e).includes("function");let globalcss="";const CURRENTS=Symbol("currentPages"),APPNAVIGATE="_navigate",NAVIGATEDATA=Symbol("navigateData"),PAGEID=Symbol("pageId"),PAGEOPTIONS=Symbol("pageOptions");let routerTarget;const initJumpRouter=e=>{switch(e.router){case"router":case 1:case"1":case"fast":case"fastback":break;default:return}if(routerTarget)return void console.warn({desc:"Only one app can route",target:e,routerTarget:routerTarget});let t;routerTarget=e,history.state&&renderHistory((t=history.state).history,e);let r=location.hash.slice(1);r&&!history.state&&(history.replaceState(null,"",""),$.nextTick(()=>{e[APPNAVIGATE]({src:r})})),e.on("navigate",(r,s)=>{let{currentPage:n}=e,{animeParam:i,src:l}=n,o=getHistoryObj(e);switch(s.type){case"to":t={history:o},s._popstate_forward||history.pushState(t,"",`#${l}`);break;case"replace":t={history:o},s._popstate_replace||history.replaceState(t,"",`#${l}`);break;case"back":s._popstate_back||(a=1,history.go(-s.delta))}});let a=0;window.addEventListener("popstate",r=>{let s=t&&t.history||[],n=r.state&&r.state.history||[];if(s.length>n.length){if(a)return void(a=0);e[APPNAVIGATE]({type:"back",delta:s.length-n.length,_popstate_back:!0})}else{if(location.hash.replace(/^\#/,"")&&!r.state){let t=location.hash.replace(/^\#/,"");return e.currents.push({src:t}),history.replaceState({history:getHistoryObj(e)},"",`#${t}`),void $.nextTick(()=>e.emitHandler("navigate",{type:"to",src:t,_popstate_forward:!0}))}{let t=n.slice(-(n.length-s.length));if(t.length){e.currents.push(...t);let r=n.slice(-1)[0];$.nextTick(()=>e.emitHandler("navigate",{type:"to",src:r.src,_popstate_forward:!0}))}}}t=r.state})};function getHistoryObj(e){let t=[];return e.currents.object.forEach((e,r)=>{0!=r&&(delete e.pageId,t.push(e))}),t}function renderHistory(e,t){t.currents.push(...e),$.nextTick(()=>{t.currentPages.forEach(e=>e.style.transition="none"),setTimeout(()=>t.currentPages.forEach(e=>e.style.transition=""),100)})}const getPageAnimeData=(e,t)=>{let r=e,a=!1;e instanceof Element||(a=!0,(r=document.createElement("div")).setAttribute("o-page-anime",e),$("o-app").push(r));let s={},n=getComputedStyle(r);["opacity"].forEach(e=>{s[e]=n[e]});let i={t:t||"2d"};if(n.transform&&"none"!=n.transform&&("matrix3d"==n.transform&&(i.t="3d"),i.a=n.transform.replace(/matrix\((.+)\)/,"$1").split(",").map(e=>parseFloat(e.trim()))),"2d"!=i.t||i.a?"3d"!=i.t||i.a||(i.a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):i.a=[1,0,0,1,0,0],"2d"==i.t){let e=i.a;i.t="3d",i.a=[e[0],e[1],0,0,e[2],e[3],0,0,0,0,1,0,e[4],e[5],0,1]}return a&&r.remove(),s.transform=i,s},pageParamToStyle=e=>{let t=Object.assign({},e),{transform:r}=e;switch(r.t){case"2d":t.transform=`matrix(${r.a.join(",")})`;break;case"3d":t.transform=`matrix3d(${r.a.join(",")})`}return t},animeByPrecent=(e,t,r)=>{let a={};Object.keys(e).forEach(s=>{if("transform"===s)return;let n=e[s].replace(/[\d\.]+(\D*)/,"$1"),i=parseFloat(e[s]),l=parseFloat(t[s]);a[s]=(l-i)*r+i+n});let s=e.transform,n=t.transform;if(s&&n){if(s.t!==n.t)return void console.error("animeByPrecent transform type unequal");let e=a.transform={t:s.t,a:[]};s.a.forEach((t,a)=>{let s=n.a[a];e.a.push((s-t)*r+t)})}return a},getPoint=e=>e.changedTouches?e.changedTouches[0]:e.targetTouches?e.targetTouches[0]:e.touches[0],initSlideRouter=e=>{if("slide"!=e.router)return;if(routerTarget)return void console.warn({desc:"Only one app can route",target:e,routerTarget:routerTarget});routerTarget=e,fakeRouter(e);const t="_left"+getRandomId(),r="_right"+getRandomId();$("head").push(`<style>#${t},#${r}{position:fixed;z-index:10000;left:0;top:0;width:10px;height:100%;background-color:rgba(255,0,0,.0);}#${r}{left:auto;right:0;}</style>`);let a=$(`<div id="${t}"></div>`);$("body").push(a);let s=[];const n=()=>{if(s.length=0,e.currents.length<=1)return;let t=e.currents.map(e=>{let t=e.object;return t.page=e._page,t}),r=t.length-1;t.forEach((e,t)=>{let{page:a}=e,{animeParam:n}=a,i=n.back.slice();if(t!=r)if(t+1==r)s.push({currentAnimeParam:getPageAnimeData(i[0]),nextAnimeParam:getPageAnimeData(a.animeParam.current),page:a});else{let e=i[r-1-t]||i.slice(-1)[0],n=i[r-2-t]||i.slice(-1)[0];s.push({currentAnimeParam:getPageAnimeData(e),nextAnimeParam:getPageAnimeData(n),page:a})}else s.push({currentAnimeParam:getPageAnimeData(a.animeParam.current),nextAnimeParam:getPageAnimeData(a.animeParam.front),page:a})})};let i,l,o=e.width;a.on("touchstart",e=>{if(e.preventDefault(),!s.length)return;let t=getPoint(e.originalEvent);l=i=t.clientX,s.forEach(e=>{e._beforeStyle=e.page.attrs.style,e.page.style.transition="none"})});let c=!1;a.on("touchmove",e=>{if(e.preventDefault(),!s.length)return;let t=getPoint(e.originalEvent).clientX,r=Math.abs(t-i)/o;s.forEach(e=>{let t=animeByPrecent(e.currentAnimeParam,e.nextAnimeParam,r),a=pageParamToStyle(t);Object.assign(e.page.style,a)}),c=t-l>0&&r>.1,l=t}),a.on("touchend",t=>{t.preventDefault(),s.length&&(s.forEach(e=>{e.page.attrs.style=e._beforeStyle}),c&&e.back())}),e.watch("currents",e=>{setTimeout(()=>n(),100)}),setTimeout(()=>n(),100)},fakeRouter=e=>{const t="o-app-history-"+location.pathname;let r=sessionStorage.getItem(t);(r=r?JSON.parse(r):{history:[]}).history.length&&renderHistory(r.history,e),e.on("navigate",(a,s)=>{let{currentPage:n}=e,{animeParam:i}=n;switch(s.type){case"to":r.history.push({src:s.src,data:s.data,animeParam:i});break;case"replace":r.history.splice(-1,1,{src:s.src,data:s.data,animeParam:i});break;case"back":r.history.splice(-s.delta)}sessionStorage.setItem(t,JSON.stringify(r))})};drill.ext(e=>{let{main:t}=e;$.ext(({renderComponent:e})=>{const r=async({defaults:e,packData:r,options:a,relativeLoad:s})=>{isFunction(a)&&(a=a(s,{DIR:r.dir,FILE:r.path}))instanceof Promise&&(a=await a),Object.assign(e,a);let n=r.path.match(/.+\/(.+)/)[1];n=n.replace(/\.js$/,"");let i="",l="",o=s;if(e.temp){if(/\</.test(e.temp))i=e.temp;else{l=!0===e.temp?`./${n}.html`:e.temp,l=await s(l+" -getLink"),i=await s(l);const r=l.replace(/(^.+\/).+/,"$1");o=((...e)=>t.load(t.toUrlObjs(e,r)))}i=i.replace(/<\!--[\s\S]+?-->/g,""),await Promise.all(["href","src"].map(async e=>{const t=new RegExp(`<[\\w\\d\\-]+[\\w\\d '"=:#@]+?${e}=['"].+['"][\\w\\d '"=:#@]*>`,"g"),r=new RegExp(`<[\\w\\d\\-]+[\\w\\d '"=:#@]+${e}=['"](.+?)['"][\\w\\d '"=:#@]*>`);let a=i.match(t);a&&await Promise.all(a.map(async t=>{let a=t.replace(r,"$1");try{let r=await o(`${a} -getLink`),s=t.replace(new RegExp(` ${e}=['"]${a}['"]`),` ${e}="${r}"`);i=i.replace(t,s)}catch(t){console.error(`${e} request failed =>`,{[e]:e,path:t[0].path})}}))}));let r=i.match(/<style>[\s\S]+?<\/style>/g);r&&await Promise.all(r.map(async e=>{let t=e,r=e.match(/url\(.+?\)/g);r&&await Promise.all(r.map(async t=>{let r=t.replace(/url\((.+?)\)/,"$1");try{let a=await o(r.replace(/['"']/g,"")+" -getLink"),s=t.replace(r,a);e=e.replace(t,s)}catch(e){console.error("style url request failed =>",{url:r,path:e[0].path})}})),i=i.replace(t,e)})),globalcss&&(i=`<link rel="stylesheet" href="${globalcss}" />`+i)}if(e.temp=i,e.ready){let t=e.ready;e.ready=function(...e){return this.ele.__xInfo.tempUrl=l,t.apply(this,e)}}else e.ready=function(){this.ele.__xInfo.tempUrl=l}};t.setProcessor("Component",async(e,t,{relativeLoad:a})=>{let s={temp:!0,hostcss:"",ready(){}};if(await r({defaults:s,packData:e,options:t,relativeLoad:a}),s.hostcss){let e=s.ready,t="string"==getType(s.hostcss)?[s.hostcss]:s.hostcss;s.ready=async function(...r){await Promise.all(t.map(async e=>{e=await a(e+" -getLink");let t=this.ele.getRootNode();if(!t.querySelector(`link[href="${e}"]`)){let r=$(`<link rel="stylesheet" href="${e}">`);t===document?t.querySelector("head").appendChild(r.ele):t.appendChild(r.ele)}})),e.apply(this,r)}}$.register(s)});let a=$("<style>o-page{display:block;}</style>");$("head").push(a);const s=Symbol("_preparing"),n=Symbol("_preparing_resolve");t.setProcessor("Page",async(e,t,{relativeLoad:a})=>{let s={temp:!0,watch:{},data:{}};return await r({defaults:s,packData:e,options:t,relativeLoad:a}),async()=>s});$.fn.setData;$.register({tag:"o-page",temp:!1,data:{source:"",show:!0,status:""},proto:{get pageId(){return this[PAGEID]},get app(){let e=this.parents("o-app");return e&&e.length?e=e[0]:this.$host&&(e=this.$host.app),e},set animeParam(e){this._animeParam=e},get animeParam(){let e=this._animeParam;if(!e){let{app:t}=this;t&&(e=t.animeParam)}return e},get params(){let e=/\?(.+)/.exec(this.src);if(e){let t={};return e[1].split("&").forEach(e=>{let[r,a]=e.split("=");r&&a&&(t[r]=a)}),t}},navigate(e){let r,a=this;do{if(r=a.app){if(a.ele!==this.ele)return void a.navigate(e);break}{let e=a.$host;if(!e||!e.is("o-page"))return void console.warn("this page no app =>",this);a=a.$host}}while(a);let s={src:""};switch(getType(e)){case"object":Object.assign(s,e);break;case"string":s.src=e}if(s.self=this,"back"!==s.type){let e=this.source.replace(/(.+\/).+/,"$1"),r=s.src,a=t.toUrlObjs([r],e)[0],n=a.path;s.src=a.search?`${n}?${a.search}`:n}return r[APPNAVIGATE](s)},back(e=1){return this.navigate({type:"back",delta:e})}},attrs:{src:""},watch:{async src(t,r){if(this.attrs.oLoading="1",!r)return;if("unload"!==this.status&&"preparing"!==this.status)throw{target:this,desc:"o-page can't reset src"};this[s]&&await this[s],this.status="loading";let a,n,i=await load(r+" -getLink");this.source=i,this.ele.__xInfo.scriptSrc=i;try{a=await load(r)}catch(t){let a=t[0].descript;throw this.status="error",e(this.ele,{temp:ofa.get404({path:i,src:r}),attrs:[],watch:{}}),this.attrs.oLoading=null,a}"destory"!=this.status&&(this[PAGEOPTIONS]=a,e(this.ele,Object.assign({attrs:[],watch:{}},a)),this.attrs.oLoading=null,this.status="finish",this[NAVIGATEDATA]&&(n=this[NAVIGATEDATA],delete this[NAVIGATEDATA]),a.ready&&a.ready.call(this,{data:n}),this.emit("page-ready"),this.watch("show",(e,t)=>{t?a.onShow&&a.onShow.call(this):a.onHide&&a.onHide.call(this)},!0))}},ready(){this[PAGEID]=getRandomId(),this.status="unload",this.on("update",e=>{"setData"==e.modify.name&&"status"==e.modify.args[0]&&"destory"==e.modify.args[1]&&(e.cancel=!0)})},detached(){this.status="destory",this[PAGEOPTIONS]&&(this[PAGEOPTIONS].destory&&this[PAGEOPTIONS].destory.call(this),this.emit("page-destory"))}}),Object.defineProperties($.fn,{$page:{get(){let{$host:e}=this;for(;e.$host;)e=e.$host;return e}},$app:{get(){let{$page:e}=this;if(e)return e.parents("o-app")[0];console.warn("no app")}}});$.register({tag:"o-app",data:{currents:[],_animeParam:{back:["back"],current:"active",front:"front"},launched:!1,visibility:document.hidden?"hide":"show",router:0,screen:{width:"",height:"",angle:""},rect:{width:"",height:""}},attrs:["router"],proto:{_updateCurrents(e){let{currents:t}=this;if(!t.length)return;let r=e.old,a=t.length-1;if(t.forEach((e,r)=>{let{animeParam:i,data:l,src:o,_page:c}=e;clearTimeout(e._nextPageAnimeTimer);let h=c;h||(e._page=h=$({tag:"o-page",src:o}),h[NAVIGATEDATA]=l,this.push(h)),"unload"!==h.status||h._preparing||(h.status="preparing",h[s]=new Promise(e=>h[n]=(()=>{h[n]=h[s]=null,e()}))),r>=a-1&&h[s]&&h[n](),e.pageId||(e.pageId=h.pageId);let{current:d,front:u,back:p}=i||h.animeParam;r<a?(h.attrs["o-page-anime"]=p[a-1-r]||p.slice(-1)[0],h.show=!1):a==r&&(h.attrs["o-page-anime"]||1==t.length?(h.attrs["o-page-anime"]=d,h.show=!0,"fastback"==this.router&&(h.style["transition-duration"]="0s",setTimeout(()=>{h.style["transition-duration"]=""}))):(h.attrs["o-page-anime"]=u,e._nextPageAnimeTimer=setTimeout(()=>{h.attrs["o-page-anime"]=d,h.show=!0},50))),"fast"==this.router&&(h.style["transition-duration"]="0s")}),r&&r.length){let e=r.filter(e=>!t.find(t=>t.pageId===e.pageId));if(e&&e.length){let t=this.filter(t=>!!e.find(e=>e.pageId===t.pageId));t&&t.length&&("fast"==this.router||"fastback"==this.router?t.forEach(e=>{e.remove()}):t.forEach(e=>{let{front:t}=e.animeParam;e.attrs["o-page-anime"]=t;let r=t=>{e.ele.removeEventListener("transitionend",r),e.remove(),r=null};e.ele.addEventListener("transitionend",r),setTimeout(()=>r&&r(),1e3)}))}}},get animeParam(){return this._animeParam},set animeParam(e){this._animeParam=e},get currentPage(){return this.currents.slice(-1)[0]._page},get currentPages(){return this.currents.map(e=>e._page)},[APPNAVIGATE](e){let t={self:"",type:"to",delta:1,src:"",data:null};if(Object.assign(t,e),/^.+:\/\//.test(t.src))throw{desc:"navigate can't use protocol path"};if(t.data&&(t.data=JSON.parse(JSON.stringify(t.data))),t.self){let e=this.currents.findIndex(e=>e._page===t.self);e>-1&&e<this.currents.length-1&&this.currents.splice(e+1)}return new Promise((e,r)=>{switch(t.type){case"to":this.currents.push({src:t.src,data:t.data});break;case"replace":this.currents.splice(-1,1,{src:t.src,data:t.data});break;case"back":if(this.currents.length<=1)return;("home"==t.delta||t.delta>=this.currents.length)&&(t.delta=this.currents.length-1),this.currents.splice(-t.delta)}$.nextTick(()=>this.emitHandler("navigate",Object.assign({},t)))})},back(e=1){this.currentPage.back(e)},navigate(...e){this.currentPage.navigate(...e)},_fixSize(){this.rect.width=this.ele.clientWidth,this.rect.height=this.ele.clientHeight}},ready(){$.nextTick(()=>{let e=()=>{let t=this.$("o-page");this.currents=[{src:t.src,data:{},_page:t,animeParam:t.animeParam,pageId:t.pageId}],this.launched=!0,e=null};this.$("o-page")?e():this.one("page-ready",e)}),window.addEventListener("visibilitychange",e=>{this.visibility=document.hidden?"hide":"show"}),this.watchUntil("launched").then(e=>{initSlideRouter(this),initJumpRouter(this)});let e=[];if(this.on("update",t=>{(1==t.keys.length&&"currents"==t.keys[0]||0===t.keys.length&&"setData"===t.modify.name&&"currents"===t.modify.args[0])&&(this._updateCurrents({old:e}),e=this.currents.object)}),$.nextTick(()=>this._updateCurrents({old:[]})),this._fixSize(),window.ResizeObserver){new ResizeObserver(e=>{this._fixSize()}).observe(this.ele)}else{let e;window.addEventListener("resize",t=>{clearTimeout(e),e=setTimeout(()=>this._fixSize(),300)})}}})})}),drill.config({paths:{"@ofa/":"https://kirakiray.github.io/ofa.js/lib/","@libs/":"https://kirakiray.github.io/ofa_lib/v2/"}});const ofa={set globalcss(e){globalcss=e},get globalcss(){return globalcss},drill:drill,$:$,get config(){return drill.config},get offline(){return drill.offline},set offline(e){this.drill.offline=e},get cacheInfo(){return this.drill.cacheInfo},get404:e=>`\n            <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:300px;">\n                <div style="margin-bottom:16px;width:45px;height:45px;font-size:30px;line-height:45px;border-radius:32px;text-align:center;font-weight:bold;background-color:#fb4747;color:#fff;">!</div>\n                <div style="font-size:13px;color:#888;text-align:center;">\n                Failed to load<br>\n                path: <a style="color:#477efd;text-decoration: underline;" href="${e.path}" target="_blank">${e.path}</a> <br>\n                src: <span style="color:#477efd;text-decoration: underline;">${e.src}</span>\n                </div>\n            </div>\n            `,v:2009e3,version:"2.9.0"};let oldOfa=glo.ofa;const runOFA=e=>getType(e).includes("function")&&e();Object.defineProperties(glo,{ofa:{get:()=>ofa,set(e){runOFA(e)}}}),oldOfa&&runOFA(oldOfa)})(window);