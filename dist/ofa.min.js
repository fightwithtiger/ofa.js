(e=>{"use strict";(e=>{function t(e,t={count:1/0}){let{eventName:a,selector:r,callback:s,data:n}=ne(e),i=this[J]||(this[J]=new Map);if(!i.has(a)){let e=e=>{let r,{_para_x_eve_:n}=e;if(n){(r=n).target.ele!==e.target&&(r.target=pe(e.target));let t=[],a=e.target;for(;a!==e.currentTarget;){let e=a.parentNode;if(!e)break;let r=Array.from(e.children).indexOf(a);t.unshift(r),a=e}r.keys=t}else(r=new w({type:a,target:pe(e.target)})).on("set-bubble",(t,a)=>!a&&e.stopPropagation()),r.on("set-cancel",(t,a)=>a&&e.stopImmediatePropagation()),r.preventDefault=e.preventDefault.bind(e),e._para_x_eve_=r;r.originalEvent=e,this.emitHandler(r),r.originalEvent=null,t.count--,t.count||this.off(a,s)};i.set(a,e),this.ele.addEventListener(a,e)}if(this.addListener({type:a,count:t.count,data:n,callback:s}),r){b(a,this).forEach(e=>{e.callback==s&&(e.before=(e=>{let t,{self:a,event:s}=e,n=s.target;return(t=n.is(r)?n:n.parents(r)[0])?(Object.assign(s,{selector:r,delegateTarget:t}),1):0}),e.after=(e=>{let{self:t,event:a}=e;delete a.selector,delete a.delegateTarget}))})}}const a=()=>Math.random().toString(32).substr(2);let r=Object.prototype.toString;const s=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),n=e=>void 0===e,i=e=>s(e).includes("function"),l=e=>JSON.parse(JSON.stringify(e)),c=(()=>{let e=!1,t=new Map,r=setTimeout;return"object"==typeof process&&process.nextTick&&(r=process.nextTick),(s,n)=>{e||(e=!0,r(()=>{t.size&&t.forEach(({key:e,fun:a})=>{a(),t.delete(e)}),t.clear(),e=!1})),n||(n=a()),t.set(n,{key:n,fun:s})}})(),o=(e,t,r,s)=>{let n;n=e._modifyId?e._modifyId:a(),S(e,P).push(n),p(e);let i=new w({type:"update",target:e[E]||e});Object.defineProperties(i,{trend:{get:()=>new C(i)}}),s&&Object.assign(i,s),i.modify={name:t,args:l(r),mid:n},e.emit(i)};let h,d=new Set;const p=e=>{e[P].length<50||(clearTimeout(h),d.add(e),h=setTimeout(()=>{let e=Array.from(d);setTimeout(()=>{e.forEach(e=>p(e))},1e3),d.forEach(e=>{let t=e[P];t.splice(0,Math.ceil(t.length/2))}),d.clear()},3e3))},u=e=>{if(!(e instanceof I))return;let t=e[O];if(t&&(t.index=void 0,t.parent=void 0),e instanceof q){let{mappingXData:a}=e,r=a[$].find(e=>e.data===t),{leftUpdate:s,rightUpdate:n}=r;e.off("update",n),a.off("update",s),t.mappingXData=null}if(t[_])for(let[e,a]of t[_])t.unsync(e);t[$]&&(t[$].forEach(e=>{let{data:a,leftUpdate:r,rightUpdate:s}=e;a.off("update",s),t.off("update",r),a.mappingXData=null}),t[$].splice(0)),t[D]&&t[D].clear(),t[m]&&t[m].clear()},f=(e,t)=>{let a=e;switch(s(e)){case"object":case"array":a=new I(e,t)}return a},g=(e,t)=>{if(e instanceof Array)return e.map(e=>g(e,t));if(e instanceof Object){let a={},r=[];return Object.keys(e).forEach(s=>{/\D/.test(s)?a[s]=g(e[s]):r.push(g(e[s],t))}),r.length&&(a[t]=r),a}return e},m=Symbol("events"),b=(e,t)=>{let a=t[m];a||(a=new Map,Object.defineProperty(t,m,{value:a}));let r=a.get(e);return r||(r=[],a.set(e,r)),r},y=(e,t)=>{let a;return e instanceof w?e=(a=e).type:a=new w({type:e,target:t[E]||t}),a};class v{constructor(e={}){Object.defineProperties(this,{parent:{writable:!0,value:e.parent,configurable:!0},index:{writable:!0,value:e.index,configurable:!0}})}on(e,t,a){this.addListener({type:e,data:a,callback:t})}one(e,t,a){this.addListener({count:1,type:e,data:a,callback:t})}addListener(e={}){let{type:t,data:a,callback:r,count:s=1/0,eventId:i}=e;if(!t)throw{desc:"addListener no type",options:e};let l=t.split("#");1 in l&&(t=l[0],i=l[1]);let c=b(t,this);n(i)||Array.from(c).some(e=>{if(e.eventId===i){let t=c.indexOf(e);return t>-1&&c.splice(t,1),!0}}),r&&c.push({type:t,data:a,callback:r,eventId:i,count:s})}off(e,t){if(e)if(t){let a=b(e,this),r=a.findIndex(e=>e.callback==t);r>-1&&a.splice(r,1)}else this[m]&&this[m].delete(e)}emitHandler(e,t){let a=y(e,this);e=a.type;let r=b(e,this),s=[];return a.currentTarget=this[E]||this,r.some(e=>{e.data&&(a.data=e.data),e.eventId&&(a.eventId=e.eventId);let r={self:this,event:a,emitData:t};if((e.before?e.before(r):1)&&e.callback.call(this[E]||this,a,t),e.after&&e.after(r),delete a.data,delete a.eventId,e.count--,e.count||s.push(e),a.cancel)return!0}),delete a.currentTarget,s.forEach(e=>{let t=r.indexOf(e);t>-1&&r.splice(t,1)}),a}emit(e,t){let a=this.emitHandler(e,t);if(a.bubble&&!a.cancel){let{parent:e}=this;e&&(a.keys.unshift(this.index),e.emit(a,t))}}}class w extends v{constructor(e){super(),this.type=e.type,this.target=e.target,this._bubble=!0,this._cancel=!1,this.keys=[]}get bubble(){return this._bubble}set bubble(e){this._bubble!==e&&(this.emitHandler("set-bubble",e),this._bubble=e)}get cancel(){return this._cancel}set cancel(e){this._cancel!==e&&(this.emitHandler("set-cancel",e),this._cancel=e)}}const k=/^_.+|^index$|^length$|^object$|^getData$|^setData$/,x=/^parent$|^index$|^length$|^object$/;let j={get:(e,t,a)=>"symbol"==typeof t||k.test(t)?Reflect.get(e,t,a):e.getData(t),set:(e,t,a,r)=>"symbol"==typeof t?Reflect.set(e,t,a,r):e.setData(t,a)};const E=Symbol("proxyThis"),O=Symbol("XDataSelf"),D=Symbol("WatchHost"),P=Symbol("ModifyIDS"),_=Symbol("SyncHost"),$=Symbol("VirDataHost"),S=(e,t)=>{let a=e[t];if(!a){switch(t){case D:case _:a=new Map;break;case P:case $:a=[]}Object.defineProperty(e,t,{value:a})}return a},A="undefined"!=typeof Element;class I extends v{constructor(e,t={}){super(t);let a=new Proxy(this,j),r=0;Object.keys(e).forEach(t=>{let a=e[t];/^\_/.test(t)||A&&a instanceof Element?Object.defineProperty(this,t,{configurable:!0,writable:!0,value:a}):(/\D/.test(t)||(t=parseInt(t))>=r&&(r=t+1),a instanceof Object?this[t]=new I(a,{parent:this,index:t}):this[t]=a)}),Object.defineProperties(this,{[O]:{get:()=>this},[E]:{value:a},_modifyId:{value:null,writable:!0},length:{configurable:!0,writable:!0,value:r}})}setData(e,t){if(x.test(e))return console.warn("you can't set this key in XData => ",e),!1;if(/^_.+/.test(e))return Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t}),!0;let a=this[O];if(/\./.test(e)){let r=e.split("."),s=r.length-1;return r.some((t,r)=>{if(r==s)return e=t,!0;a=a[t]}),a.setData(e,t),!0}if("string"===s(e)){let r=a[e];return t===r||(t instanceof I?((t=t[O]).remove(),t.parent=a,t.index=e):t instanceof Object&&(t=f(t,{parent:a,index:e})),a[e]=t,o(a,"setData",[e,t],{oldValue:r}),!0)}if(e instanceof Object){let t=e;return Object.keys(t).forEach(e=>{let r=t[e];a.setData(e,r)}),!0}}getData(e){let t=this[e];return t instanceof I&&(t=t[E]),t}remove(e){if(n(e)){let{parent:e}=this;e?e.remove(this.index):u(this)}else{let t=this[e];/\D/.test(e)?(delete this[e],u(t),o(this,"remove",[e])):this.splice(parseInt(e),1)}}add(e){!this.includes(e)&&this.push(e)}delete(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)}has(e){return this.includes(e)}clear(){this.splice(0,this.length)}before(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index,0,e),this}after(e){if(/\D/.test(this.index))throw{text:"It must be an array element",target:this,index:this.index};return this.parent.splice(this.index+1,0,e),this}clone(){return f(l(this))[E]}emitHandler(e,t){let a=y(e,this);if("update"===a.type){let{_unBubble:e,_update:t,_unpush:r}=this,{fromKey:s}=a.trend;(!1===t||e&&e.includes(s))&&(a.bubble=!1),r&&r.includes(s)&&Object.defineProperty(a,"_unpush",{value:!0})}return v.prototype.emitHandler.call(this,a,t),a}noStanz(e={childKey:"children"}){return g(this.object,e.childKey)}get object(){let e={},t=!0,{_unBubble:a=[]}=this;return Object.keys(this).forEach(r=>{if(/^_/.test(r)||!/\D/.test(r)||a.includes(r))return;let s=this[r];if(s instanceof I){if(!1===s._update)return;s=s.object}e[r]=s,t=!1}),this.forEach((t,a)=>{t instanceof I&&(t=t.object),e[a]=t}),t&&(e.length=this.length,e=Array.from(e)),e}get string(){return JSON.stringify(this.object)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get prev(){if(!/\D/.test(this.index)&&this.index>0)return this.parent.getData(this.index-1)}get next(){if(!/\D/.test(this.index))return this.parent.getData(this.index+1)}getTarget(e){let t=this;return e.length&&e.forEach(e=>{t=t[e]}),t}seek(e){let t=s(e);if("function"===t){let t=[],a=a=>{if(a instanceof I){e(a)&&t.push(a);let r=a.seek(e);t=[...t,...r]}};return Object.keys(this).forEach(e=>{/\D/.test(e)&&a(this[e])}),this.forEach(a),a=null,t}if("string"===t){let t,a=(e=e.replace(/[\[\]]/g,"")).split("=");if(2==a.length){let[e,r]=a;t=(t=>t[e]==r)}else{let[e]=a;t=(t=>Object.keys(t).includes(e))}return this.seek(t)}}watch(e,t,a){let r=s(e);if("object"===r)return void Object.keys(e).forEach(t=>{this.watch(t,e[t])});/function/.test(r)&&(a=t,t=e,e="");let n;n=""===e?"watchSelf":/\[.+\]/.test(e)?"seekData":/\./.test(e)?"watchPointKey":"watchKey";let i=S(this,D).get(e);i||(i=new Set,S(this,D).set(e,i));let l={trends:[],callback:t,expr:e};i.add(l);let o,h=this[E];switch(n){case"watchSelf":o=(e=>{l.trends.push(e.trend),c(()=>{t.call(h,{trends:Array.from(l.trends)},h),l.trends.length=0},l)}),!0===a&&t.call(h,{trends:[]},h);break;case"watchKey":o=(a=>{let{trend:r}=a;r.fromKey==e&&(l.trends.push(a.trend),c(()=>{let a=this[e];t.call(h,{expr:e,val:a,old:l.trends[0].args[1],trends:Array.from(l.trends)},a),l.trends.length=0},l))}),!0===a&&t.call(h,{expr:e,val:h[e],trends:[]},h[e]);break;case"watchPointKey":let r=e.split("."),s=r[0],i=this.getTarget(r);o=(a=>{let{trend:n}=a;if(n.fromKey==s){let s;try{s=this.getTarget(r)}catch(a){}s!==i&&(l.trends.push(n),c(()=>{(s=this.getTarget(r))!==i&&t.call(h,{expr:e,old:i,val:s,trends:Array.from(l.trends)},s),l.trends.length=0},l))}}),!0===a&&t.call(h,{expr:e,val:i},i);break;case"seekData":let d=h.seek(e);o=(a=>{c(()=>{let a=h.seek(e),r=1;a.length===d.length?a.some(e=>{if(!d.includes(e))return r=0,!0}):r=0,!r&&t.call(h,{expr:e,old:d,val:a},a),d=a},l)}),!0===a&&t.call(h,{expr:e,old:d,val:d},d)}return this.on("update",o),l.updateMethod=o,this}unwatch(e,t){let a=s(e);if("object"===a)return Object.keys(e).forEach(t=>{this.unwatch(t,e[t])}),this;/function/.test(a)&&(t=e,e="");let r=S(this,D).get(e);if(r){let a=Array.from(r).find(a=>a.callback===t&&a.expr===e);a&&(this.off("update",a.updateMethod),r.delete(a),!r.size&&S(this,D).delete(e))}return this}entrend(e){let{mid:t,keys:a,name:r,args:s,_unpush:n}=e;if(n)return;if(!t)throw{text:"Illegal trend data"};let i=this.getTarget(a)[O];return!S(i,P).includes(t)&&(i._modifyId=t,i[r](...s),i._modifyId=null,!0)}}class C{constructor(e){if(e instanceof w){let{modify:{name:t,args:a,mid:r},keys:s}=l(e),{_unpush:n}=e;n&&Object.defineProperty(this,"_unpush",{value:!0}),Object.assign(this,{name:t,args:a,mid:r,keys:s})}else Object.assign(this,e)}get string(){return JSON.stringify(this)}get finalSetterKey(){switch(this.name){case"remove":case"setData":return this.args[0]}}get fromKey(){let e=this.keys[0];return!n(e)||"setData"!==this.name&&"remove"!==this.name||(e=this.args[0]),e}set fromKey(e){let t=this.keys[0];n(t)?"setData"!==this.name&&"remove"!==this.name||(this.args[0]=e):this.keys[0]=e}}const T=(e,t,a)=>{t.trends.forEach(t=>{t.fromKey===e&&a.entrend(t)})},M=(e,t,a)=>{t.trends.forEach(t=>{e.includes(t.fromKey)&&a.entrend(t)})},L=(e,t,a)=>{l(t.trends).forEach(t=>{t=new C(t);let{fromKey:r}=t;if(!n(r)){let s=e.get(r);s&&(t.fromKey=s,a.entrend(t))}})},H=e=>(e instanceof I&&(e=e.object),e),N=(e,t,a)=>{Object.keys(e).forEach(r=>{let s=e[r];if(s instanceof Object){t[r]||(t.setData?t.setData(r,{}):t[r]={});let e=t[r];N(s,e,a)}else{let n=a([r,s],{self:e,target:t});if(n){let[e,a]=n;t[e]=a}}})},U=(e,t,a)=>{let{trend:r}=t;if(r){switch(r.name){case"setData":let e=r.args[1];if(e instanceof Object){let t={};N(e,t,a),r.args[1]=t}else n(e)||(r.args=a(r.args,{event:t}));break;default:r.args=r.args.map(e=>{let t=e;return e instanceof Object&&N(e,t={},a),t})}e.entrend(r)}},K={sync(e,t,a){let r,n;switch(s(t)){case"string":a&&e.setData(t,H(this[t])),r=(a=>T(t,a,e)),n=(e=>T(t,e,this));break;case"array":a&&t.forEach(t=>{e.setData(t,H(this[t]))}),r=(a=>M(t,a,e)),n=(e=>M(t,e,this));break;case"object":let i=new Map(Object.entries(t)),l=new Map(Object.entries(t).map(e=>e.reverse()));a&&Object.keys(t).forEach(a=>{e.setData(t[a],H(this[a]))}),r=(t=>L(i,t,e)),n=(e=>L(l,e,this));break;default:if(a){let t=this.object;Object.keys(t).forEach(a=>{e.setData(a,t[a])})}r=(t=>t.trends.forEach(t=>e.entrend(t))),n=(e=>e.trends.forEach(e=>this.entrend(e)))}this.watch(r),e.watch(n);let i=S(this,_);i.has(e)&&this.unsync(e),i.set(e,{selfWatch:r,oppWatch:n}),S(e,_).set(this,{selfWatch:n,oppWatch:r})},unsync(e){let t=S(this,_).get(e);if(t){let{selfWatch:a,oppWatch:r}=t;this.unwatch(a),e.unwatch(r),S(this,_).delete(e),S(e,_).delete(this)}},virData(e,t){let a=new q(this[O],{}),r=s(e),n=e;if("object"==r)if("mapKey"in n){let a=Object.entries(n.mapKey),r=new Map(a),s=new Map(a.map(e=>e.reverse()));e=(([e,t])=>r.has(e)?[r.get(e),t]:[e,t]),t=(([e,t])=>s.has(e)?[s.get(e),t]:[e,t])}else if("mapValue"in n){let a=n.key,r=Object.entries(n.mapValue),s=new Map(r),i=new Map(r.map(e=>e.reverse()));e=(([e,t])=>e===a&&s.has(t)?[e,s.get(t)]:[e,t]),t=(([e,t])=>e===a&&i.has(t)?[e,i.get(t)]:[e,t])}N(this,a,e);let i,l;return this.on("update",i=(t=>U(a,t,e))),a.on("update",l=(e=>U(this,e,t))),S(this,$).push({data:a,leftUpdate:i,rightUpdate:l}),a[E]}};Object.keys(K).forEach(e=>{Object.defineProperty(I.prototype,e,{writable:!0,value:K[e]})});class q extends I{constructor(e,...t){super(...t),Object.defineProperty(this,"mappingXData",{writable:!0,value:e})}}["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(I.prototype,e,{value(...e){return t.apply(this,e)}})}),["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(I.prototype,e,{value(...a){let r=[],s=this[O];a.forEach(e=>{if(e instanceof I){let t=e[O];t.remove(),r.push(t)}else{let t=f(e,{parent:s});r.push(t)}});let n=t.apply(s,r);switch(s.forEach((e,t)=>{e instanceof I&&(e.index=t)}),e){case"shift":case"pop":n instanceof I&&u(n);break;case"splice":n.forEach(e=>{e instanceof I&&u(e)})}return o(s,e,a),n}})}),Object.defineProperties(I.prototype,{sort:{value(e){let t=[],a=this[O],r=Array.from(a);if(i(e)){Array.prototype.sort.call(a,e),a.forEach((e,t)=>{e instanceof I&&(e.index=t)});t=[r.map(e=>e.index)],r=null}else e instanceof Array&&(e.forEach((e,t)=>{(a[e]=r[t]).index=e}),t=[e]);return o(a,"sort",t),this}}});const W=(e,t)=>{if(e===t)return!0;if(e===document)return!1;let a=document.createElement("template"),r=`<${e.tagName.toLowerCase()} ${Array.from(e.attributes).map(e=>e.name+'="'+e.value+'"').join(" ")} />`;return a.innerHTML=r,!!a.content.querySelector(t)},R=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.slot&&t.setAttribute("slot",e.slot),e.text&&(t.textContent=e.text);let{data:a}=e;if(a&&Object.keys(a).forEach(e=>{let r=a[e];t.dataset[e]=r}),t.xvele){let a=de(t);a[B].forEach(t=>{let r=e[t];n(r)||(a[t]=r)})}let r=0;for(;r in e;){let a=R(e[r]);t.appendChild(a),r++}return t},F=e=>{let t;if(e instanceof ee)return e.ele;switch(s(e)){case"string":/\<.+\>/.test(e)&&(t=(t=(e=>{let t=document.createElement("div");t.innerHTML=e;return Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e))[0]);break;case"object":t=R(e);break;default:(e instanceof Element||e instanceof DocumentFragment||e instanceof Document)&&(t=e)}return t},X=(e,t)=>{let a=e.querySelectorAll(t);return a?Array.from(a):[]},z=e=>(/\-/.test(e)&&(e=e.replace(/\-[\D]/g,e=>e.substr(1).toUpperCase())),e),V=e=>(/[A-Z]/.test(e)&&(e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())),e),B=Symbol("cansetkeys"),J=Symbol("orignEvents"),Z=new Set(["text","html","display","style"]),G=new Set(["text","html"]),Q=new Set(["parent","index","slot"]),Y=I.prototype.setData;class ee extends I{constructor(e){super({}),delete this.parent,delete this.index,delete this.length,Object.defineProperties(e,{__xhear__:{value:this,configurable:!0}});let t=e.tagName?e.tagName.toLowerCase():"";Object.defineProperties(this,{tag:{enumerable:!0,value:t},ele:{value:e},[J]:{writable:!0,value:""}})}get parent(){let{parentNode:e}=this.ele;if(!(e instanceof DocumentFragment))return e&&e!==document?pe(e):null}get index(){let{ele:e}=this;return Array.from(e.parentNode.children).indexOf(e)}get length(){return this.ele.children.length}get class(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get position(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}get offset(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get innerWidth(){return this.ele.clientWidth}get innerHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get display(){return getComputedStyle(this.ele).display}set display(e){this.ele.style.display=e}get style(){return this.ele.style}set style(e){if("string"==s(e))return void(this.ele.style=e);let{style:t}=this,a=Array.from(t),r=Object.keys(e);a.forEach(e=>{r.includes(e)||(t[e]="")}),Object.assign(t,e)}get $shadow(){let{shadowRoot:e}=this.ele;return e&&pe(e)}get $root(){let e=this.ele;for(;e.parentNode;)e=e.parentNode;return e&&pe(e)}get $host(){let{$root:e}=this;return e&&e.ele.host&&pe(e.ele.host)}setData(e,t){if(Q.has(e))return console.warn("can't set this key => ",e),!1;e=z(e);let a=this[O],r=this[B];if(Z.has(e)){let r=a[e];return a[e]=t,G.has(e)&&o(a,"setData",[e,t],{oldValue:r}),!0}if(r&&r.has(e)||/^_.+/.test(e))return Y.call(a,e,t);if(!/\D/.test(e)){let r=ue(t),s=a.ele.children[e];if(s){let n=a.getData(e).object;a.ele.insertBefore(r.ele,s),a.ele.removeChild(s),o(a,"setData",[e,t],{oldValue:n})}else a.ele.appendChild(r.ele),o(a,"setData",[e,t],{oldValue:void 0})}return!1}getData(e){e=z(e);let t,a=this[O];return/\D/.test(e)?t=a[e]:(t=a.ele.children[e])&&(t=pe(t)),t instanceof I&&(t=t[E]),t}siblings(e){let t=Array.from(this.ele.parentElement.children),a=t.indexOf(this.ele);return t.splice(a,1),e&&(t=t.filter(t=>{if(W(t,e))return!0})),t.map(e=>pe(e))}empty(){return this.splice(0,this.length),this}parents(e){let t=[],a=this.parent;if(e){if("string"!=s(e)){if(e instanceof ee&&(e=e.ele),e instanceof Element)for(;a;){if(a.ele==e)return!0;a=a.parent}return!1}for(;a;)W(a.ele,e)&&t.push(a),a=a.parent}else for(;a;)t.push(a),a=a.parent;return t}is(e){return W(this.ele,e)}attr(e,t){if(n(t)){if(!(e instanceof Object))return this.ele.getAttribute(e);Object.keys(e).forEach(t=>{this.attr(t,e[t])})}else this.ele.setAttribute(e,t)}removeAttr(e){return this.ele.removeAttribute(e),this}que(e){let t=this.ele.querySelector(e);if(t)return pe(t)}queAll(e){return X(this.ele,e).map(e=>pe(e))}queShadow(e){let{$shadow:t}=this;if(t)return t.que(e);throw{target:this,msg:"it must be a customElement"}}queAllShadow(e){let{$shadow:t}=this;if(t)return t.queAll(e);throw{target:this,msg:"it must be a customElement"}}clone(){let e=pe(this.ele.cloneNode(!0));return Object.keys(this).forEach(t=>{"tag"!==t&&(e[t]=this[t])}),e}viewData(){let e=f({});return this.queAll("[xv-vd]").forEach(t=>{let a=t.attr("xv-vd");if(t.xvele){let r={};if(/ to /.test(a)){a.split(",").forEach(a=>{let s=a.split("to");if(2==s.length){let a=s[0].trim(),n=s[1].trim();e[n]=t[a],r[n]=a}})}else a=a.trim(),e[a]=t.value,r[a]="value";e.sync(t,r)}else{let{ele:a}=t;"checked"in a?(e[vd]=a.checked,e.watch(vd,t=>{a.checked=e[vd]}),a.addEventListener("change",t=>{e[vd]=a.checked})):(e[vd]=a.value,e.watch(vd,t=>{a.value=e[vd]}),a.addEventListener("change",t=>{e[vd]=a.value}),a.addEventListener("input",t=>{e[vd]=a.value}))}t.removeAttr("xv-vd")}),e}extend(e){return Object.keys(e).forEach(t=>{let{get:a,set:r,value:s}=Object.getOwnPropertyDescriptor(e,t);s?Object.defineProperty(this,t,{value:s}):(Object.defineProperty(this,t,{get:a,set:r}),r&&Z.add(t))}),this}}const te=ee.prototype,ae=e.MouseEvent||Event,re=e.TouchEvent||Event,se=new Map([["click",ae],["mousedown",ae],["mouseup",ae],["mousemove",ae],["mouseenter",ae],["mouseleave",ae],["touchstart",re],["touchend",re],["touchmove",re]]),ne=e=>{let t,a,r,n=e[0];if("object"==s(n)){let e=n;n=e.event,a=e.callback,r=e.data,t=e.selector}else switch(s(e[1])){case"string":t=e[1],a=e[2],r=e[3];break;default:a=e[1],r=e[2]}return{eventName:n,selector:t,callback:a,data:r}};te.extend({on(...e){return t.call(this,e),this},off(...e){let t=e[0],a=b(t,this);if(I.prototype.off.apply(this,e),!a.length){let e=this[J]||(this[J]=new Map),a=e.get(t);a&&this.ele.removeEventListener(t,a),e.delete(t)}return this},one(...e){return t.call(this,e,{count:1}),this},trigger(e,t){let a,r={bubbles:!0,cancelable:!0};if(Object.assign(r,t),e instanceof Event)a=e;else{a=new(se.get(e)||Event)(e,{bubbles:r.bubbles,cancelable:r.cancelable})}return this.ele.dispatchEvent(a),this}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&Object.defineProperty(te,e,{value(...e){return t.apply(Array.from(this.ele.children).map(e=>pe(e)),e)}})});const ie=(e,t,a,r=[])=>{let s=e[O],n=[],i=s.ele,{children:l}=i,c=a;for(;c>0;){let e=l[t];if(!e)break;n.push(pe(e)),i.removeChild(e),c--}let h=l[t];if(r.length){let e=document.createDocumentFragment();r.forEach(t=>e.appendChild(F(t))),t>=0&&h?i.insertBefore(e,h):i.appendChild(e)}return o(s,"splice",[t,a,...r]),n},le=(e,t)=>{let a=e[O],{ele:r}=a,s=Array.from(r.children),n=document.createDocumentFragment();t.forEach(e=>{let t=s[e];t.xvele&&(t[oe]=1),n.appendChild(t)}),r.appendChild(n),s.forEach(e=>e.xvele&&(e[oe]=0))};te.extend({push(...e){let t=document.createDocumentFragment();return e.forEach(e=>{let a=F(e);t.appendChild(a)}),this.ele.appendChild(t),o(this[O],"push",e),this.length},splice(e,t,...a){return ie(this,e,t,a)},unshift(...e){return ie(this,0,0,e),this.length},shift(){return ie(this,0,1)},pop(){return ie(this,this.length-1,1)},reverse(){let e=Array.from(this.ele.children),t=e.length;le(this,e.map((e,a)=>t-1-a)),o(this[O],"reverse",[])},sort(e){if(i(e)){let t=Array.from(this.ele.children).map(e=>pe(e)),r=Array.from(t);t.sort(e),e=[];let s=a();t.forEach(t=>{let a=r.indexOf(t);r[a]=s,e.push(a)})}e instanceof Array&&le(this,e),o(this[O],"sort",[e])}});const ce=new Map,oe=Symbol("runArray"),he=(a(),(e,t)=>{let r=de(e);t.proto&&r.extend(t.proto);let{temp:s}=t;if(s){let t=e.attachShadow({mode:"open"});var i=(s=s.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);i&&i.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(s=s.replace(e,`<xv-span xvkey="${t[1].trim()}"></xv-span>`))}),t.innerHTML=s,X(t,"[xv-tar]").forEach(e=>{let t=e.getAttribute("xv-tar");Object.defineProperty(r,"$"+t,{get:()=>pe(e)})}),X(t,"xv-span").forEach(e=>{var t=document.createTextNode("");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e);var a=e.getAttribute("xvkey");r.watch(a,(e,a)=>t.textContent=a)}),X(t,"*").forEach(e=>{let t="";Array.from(e.attributes).forEach(a=>{let{name:s,value:n}=a,i=n;s=z(s);let l=/^:(.+)/.exec(s);if(l){let a=l[1],c=/^#(.+)/.exec(a);c&&(a=c[1],c=!!c);let o;e.xvele?(o=((t,r)=>{r instanceof ee&&(r=r.Object),de(e).setData(a,r)}),c&&de(e).watch(a,(e,t)=>{r.setData(i,t)})):o=((t,r)=>{e.setAttribute(a,r)}),r.watch(i,o),e.removeAttribute(l[0]),t+=`${s}=${n},`}t&&(t=t.slice(0,-1),e.setAttribute("xv-binding-expr",t));let c=/^@(.+)/.exec(s);if(c){let[t,...a]=c[1].split(".")||"",s="on";a.includes("once")&&(s="one"),de(e)[s](t,(e,t)=>{a.includes("prevent")&&e.preventDefault(),a.includes("stop")&&(e.bubble=!1),r[i].call(r[E],e,t)})}})});let n=new Set;X(t,"[xv-model]").forEach(e=>{if(n.has(e))return;let s=e.getAttribute("xv-model");switch(e.tagName.toLowerCase()){case"input":switch(e.getAttribute("type")){case"checkbox":let i=X(t,`input[type="checkbox"][xv-model="${s}"]`);return void(i.length>1?(i.forEach(e=>{e.addEventListener("change",e=>{let{value:t,checked:a}=e.target,n=r.getData(s);a?n.add(t):n.delete(t)})}),i.forEach(e=>{n.add(e)})):(r.watch(s,(t,a)=>{e.checked=a}),e.addEventListener("change",t=>{let{checked:a}=e;r.setData(s,a)})));case"radio":let l=X(t,`input[type="radio"][xv-model="${s}"]`),c=a();return void l.forEach(e=>{e.setAttribute("name",`radio_${s}_${c}`),e.addEventListener("change",t=>{e.checked&&r.setData(s,e.value)})})}case"textarea":r.watch(s,(t,a)=>{e.value=a}),e.addEventListener("input",t=>{r.setData(s,e.value)});break;case"select":r.watch(s,(t,a)=>{e.value=a}),e.addEventListener("change",t=>{r.setData(s,e.value)});break;default:if(e.xvele){let t=e.__xhear__;t.watch("value",(e,t)=>{r.setData(s,t)}),r.watch(s,(e,a)=>{t.setData("value",a)})}else console.warn("can't xv-model with thie element => ",e)}}),n.clear(),n=null}r.watch(t.watch);let l=Object.assign({},t.data);t.attrs.forEach(t=>{r.watch(t,a=>{e.setAttribute(V(t),a.val)})});let c=Object.keys(l);c.push(...t.attrs),c.push(...Object.keys(t.watch)),(c=new Set(c)).forEach(e=>{/^_.+/.test(e)&&c.delete(e)});let o=r[B];o?c.forEach(e=>o.add(e)):Object.defineProperty(r,B,{value:c}),c.has("value")&&Object.defineProperty(e,"value",{get:()=>r.value,set(e){r.value=e}}),Object.keys(l).forEach(e=>{let t=l[e];n(t)||r.setData(e,t)}),r.trigger("renderend",{bubbles:!1})}),de=e=>e.__xhear__||new ee(e),pe=e=>de(e)[E];let ue=e=>{if(e instanceof ee)return e;let t;return(t="string"!==s(e)||/\<.+\>/.test(e)?F(e):document.querySelector(e))?pe(t):null};Object.assign(ue,{register:e=>{let t={tag:"",temp:"",attrs:[],data:{},watch:{}};Object.assign(t,e);let a=t.attrs=t.attrs.map(e=>z(e));t.data=l(t.data),t.watch=Object.assign({},t.watch);let r=t.tag=V(t.tag);const s=class extends ee{constructor(...e){super(...e)}};t.proto&&s.prototype.extend(t.proto);const n=class extends HTMLElement{constructor(){super(),delete this.__xhear__;let e=new s(this);Object.defineProperty(this,"xvele",{value:!0}),Object.defineProperty(e,"xvele",{value:!0});let a=Object.assign({},t);he(this,a),a.ready&&a.ready.call(e[E]),Object.defineProperties(this,{[oe]:{writable:!0,value:0}})}connectedCallback(){this[oe]||t.attached&&t.attached.call(pe(this))}disconnectedCallback(){this[oe]||t.detached&&t.detached.call(pe(this))}attributeChangedCallback(e,t,a){let r=this.__xhear__;a!=r[e=z(e)]&&(r[e]=a)}static get observedAttributes(){return a.map(e=>V(e))}};Object.assign(t,{XhearElement:n}),ce.set(t.tag,t),customElements.define(r,n)},nextTick:c,xdata:e=>f(e)[E],versinCode:5e6,fn:te,isXhear:e=>e instanceof ee,ext:e=>{e({renderEle:he})},queAll:e=>X(document,e).map(e=>pe(e))}),e.$=ue})(window),(e=>{const t=new Map,a=new Map,r=new Map,s=new Map,n={};let i={loadNum:3,time:1e3,backups:new Set},l={processors:t,loaders:a,bag:r,paths:s,dirpaths:n,errInfo:i,baseUrl:"",tempM:{}};const c=()=>Math.random().toString(32).substr(2);var o=Object.prototype.toString;const h=e=>(e=>o.call(e).toLowerCase().replace(/(\[object )|(])/g,""))(e).search("function")>-1;const d=(()=>{let e=!1,t=[];return a=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(a)}})(),p=e=>{let t=e.match(/(.+\/).+/);return t&&t[1]},u=e=>{let t=[];return e.split(/\//g).forEach(e=>{".."==e&&t.length&&".."!=t.slice(-1)[0]?t.pop():t.push(e)}),t.join("/")},f=p(document.location.href);a.set("css",e=>{let t=document.createElement("link");t.rel="stylesheet",t.href=e.link,t.onload=(()=>{e.stat=3}),t.onerror=(()=>{e.stat=2}),document.head.appendChild(t)}),a.set("json",async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.json(),e.getPack=(async()=>t),e.stat=3}),a.set("wasm",async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.arrayBuffer();let a=await WebAssembly.compile(t);const r=new WebAssembly.Instance(a);e.getPack=(async()=>r.exports),e.stat=3}),a.set("frame",async e=>{let t=document.createElement("iframe");Object.assign(t.style,{position:"absolute","z-index":"-1",border:"none",outline:"none",opacity:"0",width:"0",height:"0"});let{link:a,path:s}=e,n=s.replace(/\.frame$/,"/frame.html"),i=a.replace(s,n);t.src=i;let l=new Map,o=()=>{r.delete(s),document.body.removeChild(t),window.removeEventListener("message",h),h=e=o=null};e.timer=setTimeout(o,1e4),e.getPack=(a=>new Promise(r=>{let s=c();clearTimeout(e.timer),l.set(s,{res:r}),t.contentWindow.postMessage({type:"drillFrameTask",taskId:s,data:a.data},"*")}));let h;window.addEventListener("message",h=(t=>{let{data:a,taskId:r}=t.data;if(l.has(r)){let e=l.get(r);l.delete(r),e.res(a)}l.size||(e.timer=setTimeout(o,1e4))})),t.addEventListener("load",t=>{e.stat=3}),t.addEventListener("error",t=>{e.stat=2}),document.body.appendChild(t)}),a.set("js",e=>{let a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=e.link,a.addEventListener("load",()=>{let{tempM:a}=l,{type:s,moduleId:n}=a;n&&(r.get(n)||r.set(n,e));let i=t.get(s||"file");if(!i)throw"no such this processor => "+s;i(e),l.tempM={}}),a.addEventListener("error",()=>{e.stat=2}),document.head.appendChild(a)}),t.set("file",e=>{e.stat=3}),t.set("define",async e=>{let t=l.tempM.d,a={},r={exports:a};if(h(t)){let{path:s,dir:n}=e;t=t((...e)=>y(w(e,n)),a,r,{FILE:s,DIR:n})}t instanceof Promise&&(t=await t),t||(e=>!(0 in Object.keys(e)))(r.exports)||(t=r.exports),e.getPack=(async()=>t),e.stat=3}),t.set("task",e=>{let t=l.tempM.d;if(!h(t))throw"task must be a function";let{path:a,dir:r}=e;e.getPack=(async e=>{return await t((...e)=>y(w(e,r)),e.data,{FILE:a,DIR:r})}),e.stat=3}),t.set("init",e=>{let t=l.tempM.d;if(!h(t))throw"init must be a function";let a,{path:r,dir:s}=e,n=0;e.getPack=(async e=>n?a:(a=await t((...e)=>y(w(e,s)),e.data,{FILE:r,DIR:s}),n=1,a)),e.stat=3});const g=e=>{let t=a.get(e);return t||(console.log("no such this loader => "+e),t=m),t},m=async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.text(),e.getPack=(async()=>t),e.stat=3};let b=e=>{let t=r.get(e.path);if(!t){let a=1;t={get stat(){return a},set stat(e){let t=a;a=e,this.changes.forEach(e=>e({change:"stat",oldStat:t,stat:a}))},dir:e.dir,path:e.path,link:e.link,dir:e.dir,changes:new Set,fileType:e.fileType,async getPack(e){}},r.set(e.path,t),g(e.fileType)(t)}return new Promise((a,r)=>{switch(t.stat){case 2:case 1:let s;t.changes.add(s=(n=>{let{stat:l}=n;switch(l){case 3:t.getPack(e).then(a),t.changes.delete(s),t=null;break;case 2:if((void 0!=t.loadCount?t.loadCount:t.loadCount=0)<i.loadNum)t.loadCount++,setTimeout(()=>g(t.fileType)(t),i.time);else{let{backups:e}=i;if(e.size){let a=void 0!=t.backupId?t.backupId:t.backupId=-1;if(a<e.size){let r=Array.from(e),s=r[a]||t.dir,n=r[a=++t.backupId];return t.loadCount=1,t.link=t.link.replace(new RegExp("^"+s),n),void setTimeout(()=>g(t.fileType)(t),i.time)}}t.stat=4}break;case 4:r("source error")}}));break;case 3:d(()=>{t.getPack(e).then(a)});break;case 4:r("source error")}})},y=e=>{let t,a=new Promise((a,r)=>{let s=[],{length:n}=e,i=n,l=[];e.forEach(async(e,c)=>{let o,h="succeed";o=e.param&&e.param.includes("-getPath")?e.link:await b(e).catch(t=>{h="error",Object.assign(e,{type:"error",descript:t}),l.push(e)}),s[c]=o,t&&t({id:c,sum:i,ready:i-n+1,stat:h}),--n||(l.length?r(l):a(1==i?o:s),s=null)})});return a.post=function(t){return e.forEach(e=>e.data=t),this},a.pend=function(e){return t=e,this},a},v=e=>{let{str:t}=e;if(r.has(t)){let a=r.get(t);return Object.assign(e,{path:a.path,link:a.link,dir:a.dir}),e}let a=t.split(/\s/).filter(e=>e&&e),i=a.slice(1),c=a[0],o=c.match(/(.+)\?(\S+)$/)||"";o&&(c=o[1],o=o[2]);let{k:h,v:d}=k.cacheInfo;h&&d&&(o&&(o+="&"),o+=h+"="+d);let g=s.get(c);if(g)c=g;else for(let e in n){let t=n[e];if(t.reg.test(c)){c=c.replace(t.reg,t.value);break}}let m=(e=>{let t,a=e.split("/").pop().match(/(.+)\.(.+)/);return a&&(t=a[2]),t})(c)||"js";c=c.replace(new RegExp("\\."+m+"$"),"");let b;if(b=i.indexOf("-r")>-1||/^.+:\/\//.test(c)?c:/^\./.test(c)?e.relative?c=e.relative+c:c.replace(/^\.\//,""):l.baseUrl+c,i.includes("-pack")){let e=b.match(/(.+)\/(.+)/);c=b=e&&2 in e?e[1]+"/"+e[2]+"/"+e[2]:`${b}/${b}`}/^.+:\/\//.test(b)||(b=f+b),b=b.replace(/\/\.\//,"/"),c=c.replace(/\/\.\//,"/"),/\.\.\//.test(b)&&(b=u(b),c=u(c));let y=p(b+="."+m),v=o?b+"?"+o:b;return Object.assign(e,{link:v,search:o,ori:c,fileType:m,path:b,dir:y,param:i}),e};const w=(e,t)=>{let a=c();return e.map((e,r)=>v({loadId:c(),id:r,str:e,groupId:a,relative:t}))},k={load:(...e)=>y(w(e)),remove(e){let{path:t}=v({str:e});if(r.has(t))return r.delete(t),!0;console.warn(`pack %c${e}`,"color:red","does not exist")},has(e){let{path:t}=v({str:e}),a=r.get(t);return a&&a.stat},config(e){e.baseUrl&&(l.baseUrl=e.baseUrl);let t=e.paths;t&&Object.keys(t).forEach(e=>{/\/$/.test(e)?n[e]={reg:new RegExp("^"+e),value:t[e]}:s.set(e,t[e])}),l.baseUrl&&e.backups&&e.backups.forEach(e=>{i.backups.add(e)})},define(e,t){l.tempM={type:"define",d:e,moduleId:t}},task(e,t){l.tempM={type:"task",d:e,moduleId:t}},init(e,t){l.tempM={type:"init",d:e,moduleId:t}},ext(e,t){if(h(e))e(l);else{let a,r=(...e)=>t(e,a,l);switch(e){case"fixUrlObj":a=v,v=r;break;case"load":a=y,y=r;break;case"agent":a=b,b=r}}},cacheInfo:{k:"d_ver",v:""},debug:{bag:r},version:3002002};let x={get agent(){return b},get load(){return y},get fixUrlObj(){return v},get toUrlObjs(){return w}};Object.defineProperty(l,"main",{value:x}),e.load||(e.load=k.load),e.define||(e.define=k.define),e.task||(e.task=k.task),e.init||(e.init=k.init);let j=document.currentScript;if(!j&&(j=document.querySelector(["drill-cache"])),j){let e=j.getAttribute("drill-cache");e&&(k.cacheInfo.v=e)}let E=e.drill;Object.defineProperty(e,"drill",{get:()=>k,set(e){h(e)?d(()=>e(k)):console.error("drill type error =>",e)}}),E&&d(()=>E(k))})(window);const t=e=>Object.prototype.toString.call(e).toLowerCase().replace(/(\[object )|(])/g,"");drill.ext(a=>{let{loaders:r,processors:s,main:n}=a;$.ext(({renderEle:r})=>{s.set("component",async e=>{let r={temp:!1,link:!1,hostlink:"",ready(){},use:[]};const s=(...t)=>n.load(n.toUrlObjs(t,e.dir));let i=a.tempM.d;(e=>t(e).includes("function"))(i)&&(i=i(s,{DIR:e.dir,FILE:e.path}))instanceof Promise&&(i=await i),Object.assign(r,i);let l=e.path.match(/.+\/(.+)/)[1];l=l.replace(/\.js$/,""),r.use&&r.use.length&&await s(...r.use);let c="";if(r.temp){if(/\n/.test(r.temp))c=r.temp;else{let e;e=!0===r.temp?await s(`./${l}.html -getPath`):await s(`${r.temp} -getPath`),c=await fetch(e),c=await c.text()}let e=r.link;e&&(e=!0===r.link?await s(`./${l}.css -getPath`):await s(`${r.link} -getPath`))&&(c=`<link rel="stylesheet" href="${e}">\n`+c)}if(r.temp=c,r.hostlink){let e=r.ready;r.ready=async function(...t){let a=this.ele.getRootNode(),n=await s(r.hostlink+" -getPath");if(!a.querySelector(`link[href="${n}"]`)){let e=$(`<link rel="stylesheet" href="${n}">`);a===document?a.querySelector("head").appendChild(e.ele):a.appendChild(e.ele)}e.apply(this,t)}}$.register(r),e.stat=3}),drill.Component=((e,t)=>{a.tempM={type:"component",d:e,moduleId:t}}),e.Component||(e.Component=drill.Component);const i=Symbol("pageStat"),l=Symbol("navigateData");let c=$("<style>xd-page{display:block;}</style>");$("head").push(c),$.register({tag:"xd-page",temp:!1,proto:{get stat(){return this[i]},get app(){return this.parents("xd-app")[0]},set pageParam(e){this._pageParam=e},get pageParam(){let e=this._pageParam;if(!e){let{app:t}=this;t&&(e=t.pageParam)}return e},get params(){let e=/\?(.+)/.exec(this.src);if(e){let t={};return e[1].split("&").forEach(e=>{let[a,r]=e.split("=");a&&r&&(t[a]=r)}),t}},navigate(e){let{app:t}=this;t?(e.self=this,t.navigate(e)):console.warn("no app =>",this)},back(){this.navigate({type:"back"})}},data:{src:"",_pageOptions:null},attrs:["src"],watch:{async src(e,t){if(!t)return;if("unload"!==this[i])throw{target:this,desc:"xd-page can't reset src"};this[i]="loading";let a=await load(t+" -r");this._pageOptions=a;let s={temp:!0,link:!1,watch:{},data:{}};Object.assign(s,a);let c="",o="",h=/(.+)\??(.*)/.exec(t);h&&(c=h[1],o=h[2]);let d,p,u=/.+\/(.+)/.exec(c);u&&(p=d=u[1],d=d.replace(/\..+/,""));let f=/.+\//.exec(c);f&&(f=f[0]);const g=(...e)=>n.load(n.toUrlObjs(e,f));s.use&&s.use.length&&await g(...s.use);let m="";if(!s.temp)throw{desc:"page need template!"};m=/\n/.test(s.temp)?s.temp:!0===s.temp?await g(`./${d}.html`):await g(`${s.temp}`);let b=s.link;b&&(b=!0===s.link?await load(`${f+d}.css -getPath -r`):await load(`${f+s.link} -getPath -r`))&&(m=`<link rel="stylesheet" href="${b}">\n`+m),r(this.ele,Object.assign({attrs:[],watch:{}},s,{temp:m})),this[i]="finish";let y;this[l]&&(y=this[l],delete this[l]),s.ready&&s.ready.call(this,{data:y}),this.emit("page-ready")}},ready(){this[i]="unload"},detached(){this[i]="destory",this._pageOptions&&(this._pageOptions.destory&&this._pageOptions.destory.call(this),this.emit("page-destory"))}}),$.fn.extend({get $page(){let{$host:e}=this;for(;e.$host;)e=e.$host;return e},get $app(){let{$page:e}=this;if(e)return e.parents("xd-app")[0];console.warn("no app")}});const o=Symbol("appStat"),h=Symbol("currentPages");$.register({tag:"xd-app",data:{src:"",_pageParam:{back:["back"],current:"active",front:"front"},_appOptions:{}},proto:{get pageParam(){return this._pageParam},set pageParam(e){this._pageParam=e},get stat(){return this[o]},get currentPage(){return this[h].slice(-1)[0]},get currentPages(){return this[h].slice()},navigate(e){let a={self:"",type:"to",delta:1,src:"",pageid:"",target:"",data:null};switch(t(e)){case"object":Object.assign(a,e);break;case"string":a.src=e}return new Promise((e,t)=>{switch(a.type){case"back":let t,r=this[h],s=r.length,{currentPage:i}=this,{delta:c}=a;if(2==s&&(c=1),s>=2){t=r[s-(c+1)];let{current:a}=t.pageParam,{front:n}=i.pageParam;t.attr("xd-page-anime",a),i.attr("xd-page-anime",n);let l=r.splice(s-c,c);setTimeout(()=>{l.forEach(e=>e.remove()),e()},300)}break;case"replace":case"to":default:if(!a.target&&!a.id&&a.src){let{src:t}=a,r=a.self&&a.self.src;if(r){let e=/(.+\/)(.+)/.exec(r);if(e){let a=n.toUrlObjs([t],e[1]);a&&(a=a[0]),t=a.ori,a.search&&(t+=".js?"+a.search)}}let s=$({tag:"xd-page",src:t});s[l]=a.data,this.push(s);let{front:i,current:c}=s.pageParam;s.attr("xd-page-anime",i),$.nextTick(()=>{s.attr("xd-page-anime",c)});let o=this.currentPage,{back:d}=o.pageParam;o.attr("xd-page-anime",d[0]),this[h].push(s),setTimeout(()=>{if("replace"==a.type){this[h].splice(this[h].length-2,1)[0].remove()}e()},300)}}})},back(e=1){this.navigate({type:"back",delta:e})}},watch:{},ready(){this[o]="unload",$.nextTick(()=>{let e=this.que("xd-page");e&&(this[h]=[e]),this.emitHandler("app-launch")}),window.addEventListener("visibilitychange",e=>{this.emitHandler(document.hidden?"app-hide":"app-show")})}})})}),drill.config({paths:{"^\\$/":"https://kirakiray.github.io/ofa_lib/dollar2/"}}),e.ofa={drill:drill,$:$,version:2e6}})(window);