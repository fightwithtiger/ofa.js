(e=>{"use strict";(e=>{function t(e,t={}){let r=new Proxy(this,W),a=0;Object.keys(e).forEach(t=>{let s=e[t];/\D/.test(t)||(t=parseInt(t))>=a&&(a=t+1),this[t]=P(s,{parent:r,hostkey:t})});return c(this,{length:a}),d(this,{[O]:{value:new Map},[S]:{value:new Set},[T]:{value:new Map},[C]:{value:new Map},[M]:{writable:!0,value:0},status:{writable:!0,value:t.parent?"binding":"root"},parent:{writable:!0,value:t.parent},hostkey:{writable:!0,value:t.hostkey}}),r}function r(e,t){d(this,{type:{enumerable:!0,value:e},keys:{enumerable:!0,value:[]},target:{enumerable:!0,value:t},bubble:{enumerable:!0,writable:!0,value:!0},cancel:{enumerable:!0,writable:!0,value:!1},currentTarget:{enumerable:!0,writable:!0,value:t}})}function a(e){return d(this,{tag:{enumerable:!0,value:e.tagName.toLowerCase()},ele:{value:e}}),d(this,{[O]:{value:new Map},[S]:{value:new Set},[T]:{value:new Map},[C]:{value:new Map},[M]:{writable:!0,value:0},[p]:{value:new Map}}),new Proxy(this,U)}const s=()=>Math.random().toString(32).substr(2);let l=Object.prototype.toString;const n=e=>l.call(e).toLowerCase().replace(/(\[object )|(])/g,""),i=e=>void 0===e,o=e=>JSON.parse(JSON.stringify(e)),c=(e,t)=>{for(let r in t)h(e,r,{writable:!0,value:t[r]})};let{defineProperty:h,defineProperties:d,assign:u}=Object;const f=(()=>{let e=!1,t=[];return r=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(r)}})(),p=Symbol("xhearEvents"),y=Symbol("xhearElement"),m=Symbol("exkeys"),v=Symbol("attached"),g=Symbol("detached"),b=new Map,k=new Set(["display","text","html","style"]),w=e=>{let t=e;for(;t.xvRender;){let e=t[y];if(e){let{$content:r}=e;if(!r)break;t=r.ele}}return t},x=(e,t)=>{if(e===t)return!0;let r=document.createElement("div");return e!==document&&(r.appendChild(e.cloneNode(!1)),!!r.querySelector(t))},E=e=>{if(!e.tag)throw console.error("this data need tag =>",e),"";let t=document.createElement(e.tag);if(e.class&&t.setAttribute("class",e.class),e.text&&(t.textContent=e.text),e.data){let{data:r}=e;Object.keys(r).forEach(e=>{let a=r[e];t.dataset[e]=a})}let r,{xvele:a}=e;if(a){let a={};Object.keys(e).forEach(t=>{"xvele"!==t&&"tag"!==t&&/\D/.test(t)&&(a[t]=e[t])}),t.setAttribute("xv-ele",""),Q(t,a),r=A(t)}let s=0;for(;s in e;){let a=E(e[s]);if(r){let{$content:e}=r;e&&e.ele.appendChild(a)}else t.appendChild(a);s++}return t},A=e=>{let t=e[y];return t||(t=new a(e),e[y]=t),t},j=e=>{if(e instanceof a)return e;let t;switch(n(e)){case"object":t=E(e),t=A(t);break;case"string":e=(e=>{let t=document.createElement("div");t.innerHTML=e;return Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return t.removeChild(e),e})})(e)[0];default:e instanceof Element&&((e=>{let t=e.querySelectorAll("[xv-ele]");Array.from(t).forEach(e=>{Q(e)});let r=e.getAttribute("xv-ele");i(r)||null===r||Q(e)})(e),t=A(e))}return t},O=Symbol("xEves"),I=Symbol("runArrMethod"),S=Symbol("modifyHost"),M=Symbol("modifyTimer"),T=Symbol("watchHost"),C=Symbol("syncHost");let N=e=>e instanceof t;const q=(e,t,r,a,s)=>{let l=0;switch(r){case"keyValue":let i=s[e];switch(a){case"=":i==t&&(l=1);break;case":=":N(i)&&i.findIndex(e=>e==t)>-1&&(l=1);break;case"*=":"string"==n(i)&&i.search(t)>-1&&(l=1);break;case"~=":"string"==n(i)&&i.split(" ").findIndex(e=>e==t)>-1&&(l=1)}break;case"hasValue":switch(a){case"=":Object.values(s).findIndex(e=>e==t)>-1&&(l=1);break;case":=":Object.values(s).some(e=>{if(N(e)&&e.findIndex(e=>e==t)>-1)return l=1,!0});break;case"*=":Object.values(s).some(e=>{if("string"==n(e)&&e.search(t)>-1)return l=1,!0});break;case"~=":Object.values(s).some(e=>{if("string"==n(e)&&e.split(" ").findIndex(e=>e==t)>-1)return l=1,!0})}break;case"hasKey":s.hasOwnProperty(e)&&(l=1)}return l};let L=(e,t)=>{let r=[],a=t.k,s=t.v,l=t.type,n=t.eqType;return Object.keys(e).forEach(i=>{let o=e[i];if(N(o)){q(a,s,l,n,o)&&r.push(o);let e=L(o,t);r.push(...e)}}),r};const P=(e,r)=>{let a=e;switch(n(e)){case"object":case"array":a=new t(e,r)}return a};let $=e=>{if(N(e)){e.parent&&(e.parent=null),e.status="destory",e.hostkey=null;for(let t of e[C].keys())e.unsync(t);e[T].clear(),e[O].clear(),e[S].clear()}};const D=(e,t)=>{if(!(e instanceof Object))return e;let{key:r,type:a,mapping:s}=t;switch(a){case"mapKey":Object.keys(e).forEach(r=>{let a=e[r];switch(s[r]&&(e[s[r]]=a,delete e[r]),n(a)){case"object":D(a,t)}});break;case"mapValue":Object.keys(e).forEach(a=>{let l=e[a];switch(a==r&&s[l]&&(e[r]=s[l]),n(l)){case"object":D(l,t)}})}};let R=t.prototype={};d(r.prototype,{trend:{get(){let{modify:e}=this;if(!e)return;let t={genre:e.genre,keys:this.keys.slice()};switch(d(t,{oldVal:{value:e.oldVal},fromKey:{get(){let t=this.keys[0];return i(t)?e.key:t},enumerable:!0}}),e.genre){case"arrayMethod":var{methodName:r,args:a,modifyId:s,returnValue:l}=e;a=a.map(e=>N(e)?e.object:e),u(t,{methodName:r,args:a,modifyId:s}),d(t,{returnValue:{get:()=>l instanceof Object?o(l):l}});break;default:var{value:n,modifyId:s}=e;N(n)&&(n=n.object),u(t,{key:e.key,value:n,modifyId:s})}return Object.freeze(t)}}});const H=(e,t)=>{let r=e[O],a=r.get(t);return a||(a=new Set,r.set(t,a)),a};c(R,{on(e,t,r){let a;if("object"==n(e)){let s=e;e=s.event,t=s.callback,r=s.data,a=s.count}i(a)&&(a=1/0);let s,l=e.split("#");1 in l&&(s=l[1],e=l[0]);let o=H(this,e);return i(s)||Array.from(o).some(e=>{if(e.eventId===s)return o.delete(e),!0}),t&&o.add({eventName:e,callback:t,data:r,eventId:s,count:a}),this},one(e,t,r){return"object"==n(e)?(e.count=1,this.on(e)):this.on({event:e,callback:t,data:r,count:1}),this},off(e,t){if("object"==n(e)){let r=e;e=r.event,t=r.callback}let r=H(this,e);return Array.from(r).some(e=>{if(e.callback===t)return r.delete(e),!0}),this},emit(e,t){let a,s;if(e instanceof r?(s=e,e=e.type):s=new r(e,this),s.currentTarget=this,a=H(this,e),Array.from(a).some(e=>{if(s.cancel)return!0;let r=[s];!i(e.data)&&(s.data=e.data),!i(e.eventId)&&(s.eventId=e.eventId),s.count=e.count,!i(t)&&r.push(t);(e.before?e.before({self:this,event:s,emitData:t}):1)&&e.callback.apply(this,r),e.after&&e.after({self:this,event:s,emitData:t}),delete s.data,delete s.eventId,delete s.count,e.count--,e.count<=0&&a.delete(e)}),s.bubble&&!s.cancel){let{parent:e}=this;e&&(s.keys.unshift(this.hostkey),e.emit(s,t))}return this}});const K=e=>{let{target:t,key:a,value:l,receiver:n,modifyId:i,genre:o}=e;if(i){if(n[S].has(i))return!0}else i=s();n[S].add(i),V(n);let c=!0,h=new r("update",n);switch(o){case"handleSet":if((d=t[a])===l)return!0;if(N(l)){let e=l.object;l.remove(),l=e}let r;t.hasOwnProperty(a)||(r=1),t[a]=P(l,{parent:n,hostkey:a}),h.modify={genre:r?"new":"change",key:a,value:l,oldVal:d,modifyId:i};break;case"handleDelete":if(!t.hasOwnProperty(a))return!0;var d=t[a];delete t[a],$(d),h.modify={genre:"delete",key:a,oldVal:d,modifyId:i};break;case"arrayMethod":let{methodName:u,args:f}=e;switch(u){case"splice":case"push":case"unshift":f=f.map(e=>{if(N(e)){if(!e.parent)return e;let t=e.object;e.remove(),e=t}return P(e)})}if(n[I]=1,"sort"!=u||f[0]instanceof Array)c=_[u].apply(n,f);else{let e=n.slice(),t=(c=_[u].apply(n,f)).slice(),r=[],a=s();e.forEach(e=>{let s=t.indexOf(e);t[s]=a,r.push(s)}),f=[r]}switch(delete n[I],u){case"splice":case"pop":case"shift":c.forEach(e=>{$(e)})}h.modify={genre:"arrayMethod",methodName:u,modifyId:i,args:f,returnValue:c}}return n.emit(h),c},V=e=>{if(e[M])return;e[M]=1;let t=()=>{let{size:r}=e[S];if(r>10){let a=Math.floor(r/2);e[S].forEach((t,r)=>{r<a&&e[S].delete(t)}),setTimeout(t,3e3)}else e[M]=0,t=null};setTimeout(t,1e4)};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&h(R,e,{writable:!0,value(...e){return t.apply(this,e)}})});const _={};["pop","push","reverse","splice","shift","unshift","sort"].forEach(e=>{let t=Array.prototype[e];_[e]=t,t&&h(R,e,{writable:!0,value(...t){let r=this._entrendModifyId;return r&&delete this._entrendModifyId,K({genre:"arrayMethod",args:t,methodName:e,modifyId:r,receiver:this})}})}),u(_,{sort(e){if(e instanceof Array){let t=this.slice();return e.forEach((e,r)=>{this[e]=t[r]}),this}return Array.prototype.sort.call(this,e)}});const F=/^_.+|^parent$|^hostkey$|^status$|^length$/;let W={set(e,t,r,a){if("symbol"==typeof t||F.test(t))return Reflect.set(e,t,r,a);if(e.hasOwnProperty(I))return N(r)&&(r.parent=a,r.hostkey=t,r.status="binding"),Reflect.set(e,t,r,a);let s=e._entrendModifyId;return s&&delete e._entrendModifyId,K({genre:"handleSet",modifyId:s,target:e,key:t,value:r,receiver:a})},deleteProperty(e,t){if("symbol"==typeof t||/^_.+/.test(t)||e.hasOwnProperty(I))return Reflect.deleteProperty(e,t);let r=e._entrendModifyId;r&&delete e._entrendModifyId;let a;return e.parent?a=e.parent[e.hostkey]:(Object.values(e).some(e=>{if(N(e))return a=e.parent,!0}),a||(a=new Proxy(e,W))),K({genre:"handleDelete",modifyId:r,target:e,key:t,receiver:a})}};c(R,{seek(e){let t,r=[],a=e.match(/(^[^\[\]])\[.+\]/);a&&a.length>=2&&(t=a[1]);e.match(/\[.+?\]/g).forEach(e=>{let t=(e=e.replace(/\[|\]/g,"")).split(/(=|\*=|:=|~=)/),a=t[0];switch(t.length){case 3:a?r.push({type:"keyValue",k:a,eqType:t[1],v:t[2]}):r.push({type:"hasValue",eqType:t[1],v:t[2]});break;case 1:r.push({type:"hasKey",k:a})}});let s;return r.forEach((e,t)=>{let r=e.k,a=e.v,l=e.type,n=e.eqType;switch(t){case 0:s=L(this,e);break;default:s=s.filter(e=>q(r,a,l,n,e)?e:void 0)}}),t&&(s=s.filter(e=>e.hostkey==t?e:void 0)),s},watch(e,t,r){let a=n(e);if("object"===a)return void Object.keys(e).forEach(t=>{this.watch(t,e[t])});/function/.test(a)&&(t=e,e="");let s;s=""==e?"watchOri":/\[.+\]/.test(e)?"seekOri":"watchKey";let l=this[T].get(e);l||(l=new Set,this[T].set(e,l));let i={modifys:[],isNextTick:0,callback:t};l.add(i);let o;switch(s){case"watchOri":this.on("update",o=(e=>{i.modifys.push(e.trend),i.isNextTick||(i.isNextTick=1,f(()=>{i.callback.call(this,{modifys:Array.from(i.modifys)}),i.modifys.length=0,i.isNextTick=0}))}));break;case"watchKey":this.on("update",o=(t=>{let{trend:r}=t;r.fromKey==e&&(i.modifys.push(r),i.isNextTick||(i.isNextTick=1,f(()=>{let t=this[e];i.callback.call(this,{expr:e,val:t,modifys:Array.from(i.modifys)},t),i.modifys.length=0,i.isNextTick=0})))}));let a=this[e];!0===r&&t.call(this,{expr:e,val:a,modifys:[]},a);break;case"seekOri":let l=i.oldVals=this.seek(e);this.on("update",o=(t=>{i.isNextTick||(i.isNextTick=1,f(()=>{let{oldVals:t}=i,r=this.seek(e),a=1;r.length!=t.length&&(a=0),a&&r.some((e,r)=>{if(t[r]!=e)return a=0,!0}),a||i.callback.call(this,{expr:e,old:t,val:r},r),i.oldVals=r,i.isNextTick=0}))})),t({expr:e,val:l},l)}i.updateFunc=o},unwatch(e,t){let r=n(e);/function/.test(r)&&(t=e,e="");let a=this[T].get(e);if(a){let r;Array.from(a).some(e=>{e.callback!==t||(r=e)}),r?(this.off("update",r.updateFunc),a.delete(r),a.size||this[T].delete(e)):console.warn("can't find this watch callback => ",t)}return this},entrend(e){let t=this,{modifyId:r}=e;if(!r)throw"illegal trend data";if(e.keys.forEach(e=>{t=t[e]}),t)switch(t._entrendModifyId=r,e.genre){case"arrayMethod":t[e.methodName](...e.args);break;case"delete":delete t[e.key];break;default:t[e.key]=e.value}else console.warn("data not found => ",this,e);return this},sync(e,t,r){let a,s;switch(n(t)){case"string":r&&(e[t]=this[t]),this.watch(a=(r=>{r.modifys.forEach(r=>{r.fromKey==t&&e.entrend(r)})})),e.watch(s=(e=>{e.modifys.forEach(e=>{e.fromKey==t&&this.entrend(e)})}));break;case"array":r&&t.forEach(t=>{e[t]=this[t]}),this.watch(a=(r=>{r.modifys.forEach(r=>{t.includes(r.fromKey)&&e.entrend(r)})})),e.watch(s=(e=>{e.modifys.forEach(e=>{t.includes(e.fromKey)&&this.entrend(e)})}));break;case"object":let l=Object.keys(t),c={};r?l.forEach(r=>{let a=t[r];e[a]=this[r],c[a]=r}):l.forEach(e=>{c[t[e]]=e}),this.watch(a=(r=>{r.modifys.forEach(r=>{let a=(r=o(r)).fromKey;t.hasOwnProperty(a)&&(i(r.keys[0])?r.key=t[a]:r.keys[0]=t[a],e.entrend(r))})})),e.watch(a=(e=>{e.modifys.forEach(e=>{let t=(e=o(e)).fromKey;c.hasOwnProperty(t)&&(i(e.keys[0])?e.key=c[t]:e.keys[0]=c[t],this.entrend(e))})}));break;default:r&&e.extend(this.object),this.watch(a=(t=>{t.modifys.forEach(t=>{e.entrend(t)})})),e.watch(s=(e=>{e.modifys.forEach(e=>{this.entrend(e)})}))}return this[C].set(e,{oppWatchFunc:s,watchFunc:a}),e[C].set(this,{oppWatchFunc:a,watchFunc:s}),this},unsync(e){let t=this[C].get(e);if(t){let{oppWatchFunc:r,watchFunc:a}=t;this.unwatch(a),e.unwatch(r),this[C].delete(e),e[C].delete(this)}else console.warn("not found => ",e);return this},virData(e){let t=this.object;D(t,e),t=P(t);let{mapping:r,type:a,key:s}=e,l={};Object.keys(r).forEach(e=>{let t=r[e];!i(t)&&(l[t]=e)});let n,c;switch(a){case"mapKey":this.on("update",n=(a=>{let{trend:s}=a;(s=o(s)).args?D(s.args,e):s.value&&D(s.value,e);let l=r[s.key];i(l)||(s.key=l),t.entrend(s)})),t.on("update",c=(e=>{let{trend:t}=e;(t=o(t)).args?D(t.args,{type:a,mapping:l}):t.value&&D(t.value,{type:a,mapping:l});let r=l[t.key];i(r)||(t.key=r),this.entrend(t)}));break;case"mapValue":this.on("update",n=(a=>{let{trend:l}=a;if((l=o(l)).args?D(l.args,e):l.value&&D(l.value,e),l.key==s){let e=l.value;r.hasOwnProperty(e)&&(l.value=r[e])}t.entrend(l)})),t.on("update",c=(e=>{let{trend:t}=e;if((t=o(t)).args?D(t.args,{type:a,key:s,mapping:l}):t.value&&D(t.value,{type:a,key:s,mapping:l}),t.key==s){let e=t.value;l.hasOwnProperty(e)&&(t.value=l[e])}this.entrend(t)}))}return h(t,"remove",{value(...e){e.length||(this.off("update",n),t.off("update",c),n=c=t=null),R.remove.call(t,...e)}}),t},removeByKey(e){/\D/.test(e)?delete this[e]:this.splice(parseInt(e),1)},remove(e){if(i(e)){let{parent:e}=this;e?e.removeByKey(this.hostkey):$(this)}else if(N(e))e.parent==this&&this.removeByKey(e.hostkey);else{let t=this.indexOf(e);t>-1&&this.removeByKey(t)}},before(e){if(/\D/.test(this.hostkey))throw console.error("can't use before in this data =>",this,e),"";return this.parent.splice(this.hostkey,0,e),this},after(e){if(/\D/.test(this.hostkey))throw console.error("can't use after in this data =>",this,e),"";return this.parent.splice(this.hostkey+1,0,e),this},add(e){!this.includes(e)&&this.push(e)},clone(){return P(this.object)},reset(e){let t=Object.keys(e);return Object.keys(this).forEach(e=>{t.includes(e)||"length"===e||delete this[e]}),u(this,e),this},extend(...e){u(this,...e)}}),d(R,{object:{get(){let e={};return Object.keys(this).forEach(t=>{let r=this[t];N(r)?e[t]=r.object:e[t]=r}),e}},string:{get(){return JSON.stringify(this.object)}},root:{get(){let e=this;for(;e.parent;)e=e.parent;return e}},prev:{get(){if(!/\D/.test(this.hostkey)&&this.hostkey>0)return this.parent[this.hostkey-1]}},next:{get(){if(!/\D/.test(this.hostkey))return this.parent[this.hostkey+1]}}});const U={get(e,t,r){if("symbol"==typeof t||/\D/.test(t))return Reflect.get(e,t,r);{let e=w(r.ele).children[t];return e&&A(e)}},set(e,t,r,a){if("symbol"==typeof t||/^_.+/.test(t)||k.has(t))return Reflect.set(e,t,r,a);let s=e._entrendModifyId;return s&&delete e._entrendModifyId,!(!/\D/.test(t)||e[m].has(t))||J({genre:"handleSet",modifyId:s,target:e,key:t,value:r,receiver:a})},deleteProperty:(e,t)=>"symbol"==typeof t||/^_.+/.test(t)?Reflect.deleteProperty(e,t):(console.error("you can't use delete with xhearElement"),!1)};let B=a.prototype=Object.create(R);d(B,{hostkey:{get(){return Array.from(this.ele.parentElement.children).indexOf(this.ele)}},parent:{get(){let e=(e=>{let{parentElement:t}=e;if(t){for(;t.hostId;)t=t[y].$host.ele;return t}})(this.ele);if(e)return A(e)}},xvele:{get(){let{attributes:e}=this.ele;return e.hasOwnProperty("xv-ele")||e.hasOwnProperty("xv-render")}},class:{get(){return this.ele.classList}},data:{get(){return this.ele.dataset}},object:{get(){let e={tag:this.tag};if(this.xvRender){let t=this[m];t&&t.forEach(t=>{e[t]=this[t]}),e.xvele=1}else{let t=this.ele.classList.value;t&&(e.class=t)}return this.forEach((t,r)=>{e[r]=t instanceof a?t.object:t}),e}},length:{get(){return w(this.ele).children.length}},marks:{get(){let e=this.attr("xv-shadow"),t={};return this.queAll("[xv-mark]").forEach(r=>{e===r.attr("[xv-shadow]")&&(t[r.attr("xv-mark")]=r)}),t}}}),L=((e,t)=>{let r=[],s=t.k,l=t.v,n=t.type,i=t.eqType,o=a=>{let o=e[a];if(N(o)){q(s,l,n,i,o)&&r.push(o);let e=L(o,t);r.push(...e)}};if(e instanceof a){[...e[m]||[],...Object.keys(w(e.ele).children)].forEach(o)}else Object.keys(e).forEach(o);return o=null,r}),c(B,{on(...e){let t,a,s,l=e[0];if("object"==n(l)){let e=l;l=e.event,a=e.callback,s=e.data,t=e.selector}else{switch(n(e[1])){case"string":t=e[1],a=e[2],s=e[3];break;default:a=e[1],s=e[2]}e=[{event:l,callback:a,data:s}]}if(!this[p].get(l)){let e;this.ele.addEventListener(l,e=(e=>{e.stopImmediatePropagation();let t=A(e.target),a=new r(l,t);a.originalEvent=e,a.preventDefault=e.preventDefault.bind(e);let s=e.target.getAttribute("xv-shadow");return s&&(a.shadow=s),t.emit(a),!1})),this[p].set(l,e)}let i=R.on.apply(this,e);if(t){let e=H(this,l);Array.from(e).some(e=>{e.callback==a&&(e.before=(e=>{let r=e.event,a=r.target,s=a.parents(t)[0];return!s&&a.is(t)&&(s=a),s?(u(r,{selector:t,delegateTarget:s}),1):0}),e.after=(e=>{let t=e.event;delete t.selector,delete t.delegateTarget}))})}return i},one(...e){let t=e[0],r=R.one.apply(this,e);return z(this,t),r},off(...e){let t=e[0],r=R.off.apply(this,e);return z(this,t),r},emit(...e){let t=e[0];if(t instanceof r&&t.shadow&&t.shadow==this.xvRender){if("update"==t.type)return;let a=new r(t.type,this),s=this.ele.getAttribute("xv-shadow");s&&(t.shadow=s);let{originalEvent:l,preventDefault:n}=t;l&&u(a,{originalEvent:l,preventDefault:n,fromShadowEvent:t}),e=[a]}return R.emit.apply(this,e)},que(e){return re.que(e,this.ele)},extend(...e){let t={};u(t,...e),Object.keys(t).forEach(e=>{let r=t[e];r!==this[e]&&(this[e]=r)})},viewData(){let e=this.attr("xv-shadow"),t=re.xdata({});return this.queAll("[xv-vd]").forEach(r=>{if(e!==r.attr("[xv-shadow]"))return;let a=r.attr("xv-vd");if(r.xvele){let e={};if(/ to /.test(a)){a.split(",").forEach(a=>{let s=a.split("to");if(2==s.length){let a=s[0].trim(),l=s[1].trim();t[l]=r[a],e[l]=a}})}else a=a.trim(),t[a]=r.value,e[a]="value";t.sync(r,e)}else{let{ele:e}=r;"checked"in e?(t[a]=e.checked,t.watch(a,r=>{e.checked=t[a]}),e.addEventListener("change",r=>{t[a]=e.checked})):(t[a]=e.value,t.watch(a,r=>{e.value=t[a]}),e.addEventListener("change",r=>{t[a]=e.value}),e.addEventListener("input",r=>{t[a]=e.value}))}}),t}});const z=(e,t)=>{let r=e[O][t];if(r&&!r.length){let r=e[p].get(t);e.ele.removeEventListener(t,r),e[p].delete(t)}},J=e=>{let{target:t,key:l,value:n,receiver:i,modifyId:c,genre:h}=e;if(c){if(i[S].has(c))return!0}else c=s();i[S].add(c),V(i);let d=!0,u=new r("update",i),{ele:f}=i,p=f.getAttribute("xv-shadow");switch(p&&(u.shadow=p),h){case"handleSet":let r;if(/\D/.test(l)){if((r=t[l])===n)return!0;(y=n)instanceof Object&&(y=o(y),y=P(y,{parent:i,hostkey:l})),t[l]=y}else{var y=j(n);p&&y.ele.setAttribute("xv-shadow",p);let e=i[l];if(e){let{parentElement:t}=e.ele;t.insertBefore(y.ele,e.ele),t.removeChild(e.ele)}else{w(f).appendChild(y.ele)}r=e}u.modify={genre:"change",key:l,value:n,oldVal:r,modifyId:c};break;case"arrayMethod":let{methodName:v,args:g}=e;switch(v){case"splice":case"unshift":case"push":g=g.map(e=>e instanceof a&&e.parent?(e.remove(),e.object):e)}switch(v){case"splice":d=X(i,...g);break;case"unshift":X(i,0,0,...g),d=i.length;break;case"push":X(i,i.length,0,...g),d=i.length;break;case"shift":d=X(i,0,1,...g);break;case"pop":d=X(i,i.length-1,1,...g);break;case"reverse":m=w(i.ele);Array.from(m.children).reverse().forEach(e=>{m.appendChild(e)}),d=this;break;case"sort":var m=w(i.ele);let e=g[0];if(e instanceof Array){let t=Array.from(m.children);e.forEach(e=>{m.appendChild(t[e])})}else{let t=Array.from(m.children).map(e=>A(e)),r=Array.from(t);t.sort(e);let a=[],l=s();t.forEach(e=>{let t=r.indexOf(e);r[t]=l,a.push(t)}),t.forEach(e=>{m.appendChild(e.ele)}),g=[a]}}u.modify={genre:"arrayMethod",methodName:v,modifyId:c,args:g};break;default:return}return i.emit(u),d};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","includes"].forEach(e=>{let t=Array.prototype[e];t&&c(B,{[e](...e){return t.apply(Array.from(w(this.ele).children).map(e=>A(e)),e)}})}),["pop","push","reverse","splice","shift","unshift","sort"].forEach(e=>{h(B,e,{writable:!0,value(...t){let r=this._entrendModifyId;return r&&delete this._entrendModifyId,J({genre:"arrayMethod",args:t,methodName:e,modifyId:r,receiver:this})}})});const X=(e,t,r,...a)=>{let s=[],{ele:l}=e,n=w(l),{children:i}=n;for(;r>0;){let e=i[t];s.push(j(e)),n.removeChild(e),r--}let o=i[t],c=l.getAttribute("xv-shadow");return t>=0&&o?a.forEach(e=>{let t=j(e).ele;c&&t.setAttribute("xv-shadow",c),n.insertBefore(t,o)}):a.forEach(e=>{let t=j(e).ele;c&&t.setAttribute("xv-shadow",c),n.appendChild(t)}),s};d(B,{display:{get(){return getComputedStyle(this.ele).display},set(e){this.ele.style.display=e}},text:{get(){return w(this.ele).textContent},set(e){w(this.ele).textContent=e}},html:{get(){return w(this.ele).innerHTML},set(e){w(this.ele).innerHTML=e}},style:{get(){return this.ele.style},set(e){let{style:t}=this,r=Array.from(t),a=Object.keys(e);r.forEach(e=>{a.includes(e)||(t[e]="")}),u(t,e)}},css:{get(){return getComputedStyle(this.ele)}},position:{get(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}},offset:{get(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}},width:{get(){return parseInt(getComputedStyle(this.ele).width)}},height:{get(){return parseInt(getComputedStyle(this.ele).height)}},innerWidth:{get(){return this.ele.clientWidth}},innerHeight:{get(){return this.ele.clientHeight}},offsetWidth:{get(){return this.ele.offsetWidth}},offsetHeight:{get(){return this.ele.offsetHeight}},outerWidth:{get(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}},outerHeight:{get(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}}}),c(B,{siblings(e){let t=Array.from(this.ele.parentElement.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(x(t,e))return!0})),t.map(e=>A(e))},remove(){if(/\D/.test(this.hostkey))throw console.error(`can't delete this key => ${this.hostkey}`,this,data),"";this.parent.splice(this.hostkey,1)},empty(){return this.splice(0,this.length),this},parents(e){let t=[],r=this.parent;if(e){if("string"!=n(e)){if(e instanceof a&&(e=e.ele),e instanceof Element)for(;r&&"html"!=r.tag;){if(r.ele==e)return!0;r=r.parent}return!1}for(;r&&"html"!=r.tag;)x(r.ele,e)&&t.push(r),r=r.parent}else for(;r&&"html"!=r.tag;)t.push(r),r=r.parent;return t},parentsUntil(e){if(e){let t=this.parent;for(;t&&"html"!=t.tag;){if(x(t.ele,e))return t;t=t.parent}}},attr(e,t){if(i(t)){if(!(e instanceof Object))return this.ele.getAttribute(e);Object.keys(e).forEach(t=>{this.attr(t,e[t])})}else{if(this.xvRender){b.get(this.tag).attrs.includes(e)&&(this[e]=t)}this.ele.setAttribute(e,t)}},removeAttr(e){return this.ele.removeAttribute(e),this},is(e){return x(this.ele,e)},clone(){return re(this.ele.cloneNode(!0))},que(e){return re.que(e,this.ele)},queAll(e){return re.queAll(e,this.ele)},queAllShadow(e){let{xvRender:t}=this;if(t){let r=this.ele.querySelectorAll(e);return(r=Array.from(r).filter(e=>{if(e.getAttribute("xv-shadow")==t)return!0})).map(e=>A(e))}throw"it's must render element"},queShadow(e){return this.queAllShadow(e)[0]}});let G=100;const Q=(e,t)=>{let r=b.get(e.tagName.toLowerCase());if(!r)return void console.warn("not register tag "+e.tagName.toLowerCase());if(e.xvRender)return;let a=Array.from(e.childNodes);e.innerHTML=r.temp;let s=G++,l=A(e),{proto:n}=r;n&&Object.keys(n).forEach(e=>{let t=Object.getOwnPropertyDescriptor(n,e),{get:r,set:a,value:s}=t;s?h(l,e,{value:s}):h(l,e,{get:r,set:a})}),Array.from(e.querySelectorAll("*")).forEach(e=>e.setAttribute("xv-shadow",s)),Array.from(e.querySelectorAll(`[xv-ele][xv-shadow="${s}"]`)).forEach(e=>Q(e)),e.removeAttribute("xv-ele"),e.setAttribute("xv-render",s),h(l,"xvRender",{value:e.xvRender=s}),r.slotTags.length>0&&r.slotTags.forEach(t=>{let n=t.replace(r.tag+"-",""),i=e.querySelector(`[xv-slot="${n}"]`);if(i){h(l,"$"+n,{value:A(i)});let e=a.find(e=>{let{tagName:r}=e;if(r&&r.toLowerCase()===t&&!e.getAttribute("xv-ele")&&!e.getAttribute("xv-render"))return e});e&&(e.querySelectorAll("*").forEach(e=>{e.attributes.hasOwnProperty("xv-shadow")||e.setAttribute("xv-shadow",s)}),Array.from(e.childNodes).forEach(e=>{i.appendChild(e)}),a=a.filter(t=>t!==e))}});let c=r.tag+"-content";a.some(e=>{let{tagName:t}=e;if(t&&t.toLowerCase()===c&&!e.getAttribute("xv-ele")&&!e.getAttribute("xv-render"))return a=Array.from(e.childNodes),!0});let d=e.querySelector(`[xv-content][xv-shadow="${s}"],[xv-slot="content"][xv-shadow="${s}"]`);if(d){let e=A(d);for(h(l,"$content",{value:e}),h(e,"$host",{value:l}),d.hostId=s;d.xvRender;){let e=d[y].$content;e&&(d=e.ele)}a.forEach(e=>{d.appendChild(e)})}else a.forEach(t=>{e.appendChild(t)});Array.from(e.querySelectorAll(`[xv-tar][xv-shadow="${s}"]`)).forEach(e=>{let t=e.getAttribute("xv-tar");h(l,"$"+t,{value:A(e)})}),Array.from(e.querySelectorAll(`xv-span[xv-shadow="${s}"]`)).forEach(e=>{var t=document.createTextNode("");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e);var r=e.getAttribute("xvkey");l.watch(r,e=>t.textContent=l[r])}),Array.from(e.querySelectorAll(`[xv-module][xv-shadow="${s}"]`)).forEach(e=>{let t=e.getAttribute("xv-module"),r=r=>{l[t]=e.value};if(e.xvRender){A(e).watch("value",r)}else e.addEventListener("change",r),e.addEventListener("input",r);l.watch(t,r=>{e.value=l[t]})});let f=r.watch;Object.keys(f).forEach(e=>{l.watch(e,f[e])});let p=u({},r.data);t&&u(p,t),r.attrs.forEach(t=>{let r=e.getAttribute(t);i(r)||null==r||(p[t]=r),l.watch(t,r=>{e.setAttribute(t,r.val)})}),r.props.forEach(t=>{let r=e.getAttribute(t);!i(r)&&null!=r&&(p[t]=r)});let g=Object.keys(p);g.push(...r.attrs),g.push(...r.props),g.push(...Object.keys(f)),g=new Set(g),h(l,m,{value:g}),g.forEach(e=>{let t=p[e];t instanceof Object&&(t=o(t),t=P(t,{parent:l,hostkey:e})),i(t)||(l[e]=t)}),g.has("value")&&h(e,"value",{get:()=>l.value,set(e){l.value=e}}),Array.from(e.querySelectorAll("[xv-ele]")).forEach(e=>Q(e)),r.inited&&r.inited.call(l),r.attached&&!e[v]&&e.getRootNode()===document&&(r.attached.call(l),e[v]=1)};let Y=0;const Z=()=>{if(Y)return;Y=1;new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:t,removedNodes:r}=e;t&&ee(Array.from(t),"attached",v),r&&ee(Array.from(r),"detached",g)})}).observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0})},ee=(e,t,r)=>{e.forEach(e=>{e.xvRender&&te(e,t,r),e instanceof Element&&Array.from(e.querySelectorAll("[xv-render]")).forEach(e=>{te(e,t,r)})})},te=(e,t,r)=>{if(!e.xvRender||e[r])return;let a=b.get(e.tagName.toLowerCase());a[t]&&(a[t].call(A(e)),e[r]=1)};let re=e=>{if(e instanceof a)return e;let t=e;return"string"===n(e)&&-1===e.search("<")?re.que(e):j(t)};const ae=(e,t)=>{let r=1,a=e.getAttribute("xv-shadow"),s=t.getAttribute("xv-shadow");return s&&a!==s&&(r=null),r};let se=document.querySelector("html");e.$=re,u(re,{fn:B,type:n,init:A,que:(e,t=se)=>{let r=t.querySelector(e);return r&&ae(t,r)&&A(r)},queAll:(e,t=se)=>{return Array.from(t.querySelectorAll(e)).filter(e=>ae(t,e)).map(e=>A(e))},nextTick:f,xdata:P,register:e=>{let t={tag:"",temp:"",attrs:[],props:[],data:{},watch:{}};u(t,e),t.attrs=t.attrs.slice(),t.props=t.props.slice(),t.data=o(t.data),t.watch=u({},t.watch);let r=t.slotTags=[];if(t.temp){let{temp:s}=t,l=document.createElement("div");if(l.innerHTML=s,!l.querySelector('[xv-content],[xv-slot="content"]'))return void console.error(t.tag+" need container!",e);let n=l.querySelectorAll("[xv-slot]");n&&n.forEach(e=>{let a=e.getAttribute("xv-slot");a&&"content"!==a&&r.push(t.tag+"-"+a)});var a=(s=s.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);a&&a.forEach(e=>{var t=/{{(.+?)}}/.exec(e);t&&(s=s.replace(e,`<xv-span xvkey="${t[1].trim()}"></xv-span>`))}),t.temp=s}(t.attached||t.detached)&&Z(),b.set(t.tag,t),Array.from(document.querySelectorAll(t.tag+"[xv-ele]")).forEach(e=>{Q(e)})},version:4e4});let le=document.createElement("style");le.innerHTML="[xv-ele]{display:none;}",document.head.appendChild(le),f(()=>{Array.from(document.querySelectorAll("[xv-ele]")).forEach(e=>{Q(e)})})})(window),(e=>{const t=new Map,r=new Map,a=new Map,s=new Map,l={};let n={loadNum:3,time:1e3,backups:new Set},i={processors:t,loaders:r,bag:a,paths:s,dirpaths:l,errInfo:n,baseUrl:"",tempM:{}};const o=()=>Math.random().toString(32).substr(2);var c=Object.prototype.toString;const h=e=>(e=>c.call(e).toLowerCase().replace(/(\[object )|(])/g,""))(e).search("function")>-1;const d=(()=>{let e=!1,t=[];return r=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(r)}})(),u=e=>{let t=e.match(/(.+\/).+/);return t&&t[1]},f=u(document.location.href);r.set("css",e=>{let t=document.createElement("link");t.rel="stylesheet",t.href=e.link,t.onload=(()=>{e.stat=3}),t.onerror=(()=>{e.stat=2}),document.head.appendChild(t)}),r.set("json",async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.json(),e.getPack=(async()=>t),e.stat=3}),r.set("wasm",async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.arrayBuffer();let r=await WebAssembly.compile(t);const a=new WebAssembly.Instance(r);e.getPack=(async()=>a.exports),e.stat=3}),r.set("frame",async e=>{let t=document.createElement("iframe");Object.assign(t.style,{position:"absolute","z-index":"-1",border:"none",outline:"none",opacity:"0",width:"0",height:"0"});let{link:r,path:s}=e,l=s.replace(/\.frame$/,"/frame.html"),n=r.replace(s,l);t.src=n;let i=new Map,c=()=>{a.delete(s),document.body.removeChild(t),window.removeEventListener("message",h),h=e=c=null};e.timer=setTimeout(c,1e4),e.getPack=(r=>new Promise(a=>{let s=o();clearTimeout(e.timer),i.set(s,{res:a}),t.contentWindow.postMessage({type:"drillFrameTask",taskId:s,data:r.data},"*")}));let h;window.addEventListener("message",h=(t=>{let{data:r,taskId:a}=t.data;if(i.has(a)){let e=i.get(a);i.delete(a),e.res(r)}i.size||(e.timer=setTimeout(c,1e4))})),t.addEventListener("load",t=>{e.stat=3}),t.addEventListener("error",t=>{e.stat=2}),document.body.appendChild(t)}),t.set("file",e=>{e.stat=3}),t.set("define",async e=>{let t=i.tempM.d,r={},a={exports:r};if(h(t)){let{path:s,dir:l}=e;t=t((...e)=>y(v(e,l)),r,a,{FILE:s,DIR:l})}t instanceof Promise&&(t=await t),t||(e=>!(0 in Object.keys(e)))(a.exports)||(t=a.exports),e.getPack=(async()=>t),e.stat=3}),t.set("task",e=>{let t=i.tempM.d;if(!h(t))throw"task must be a function";let{path:r,dir:a}=e;e.getPack=(async e=>{return await t((...e)=>y(v(e,a)),e.data,{FILE:r,DIR:a})}),e.stat=3}),t.set("init",e=>{let t=i.tempM.d;if(!h(t))throw"init must be a function";let r,{path:a,dir:s}=e,l=0;e.getPack=(async e=>l?r:(r=await t((...e)=>y(v(e,s)),e.data,{FILE:a,DIR:s}),l=1,r)),e.stat=3}),r.set("js",e=>{let r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=e.link,r.addEventListener("load",()=>{let{tempM:r}=i,{type:s,moduleId:l}=r;l&&(a.get(l)||a.set(l,e));let n=t.get(s||"file");if(!n)throw"no such this processor => "+s;n(e),i.tempM={}}),r.addEventListener("error",()=>{e.stat=2}),document.head.appendChild(r)});let p=e=>{let t=a.get(e.path);if(!t){let s=1;t={get stat(){return s},set stat(e){let t=s;s=e,this.changes.forEach(e=>e({change:"stat",oldStat:t,stat:s}))},dir:e.dir,path:e.path,link:e.link,dir:e.dir,changes:new Set,fileType:e.fileType,async getPack(e){}},a.set(e.path,t);let l=r.get(e.fileType);if(!l)throw"no such this loader => "+t.fileType;l(t)}return new Promise((a,s)=>{switch(t.stat){case 2:case 1:let l;t.changes.add(l=(i=>{let{stat:o}=i;switch(o){case 3:t.getPack(e).then(a),t.changes.delete(l),t=null;break;case 2:if((void 0!=t.loadCount?t.loadCount:t.loadCount=0)<n.loadNum){t.loadCount++;let e=r.get(t.fileType);setTimeout(()=>e(t),n.time)}else{let{backups:e}=n;if(e.size){let a=void 0!=t.backupId?t.backupId:t.backupId=-1;if(a<e.size){let s=Array.from(e),l=s[a]||t.dir,i=s[a=++t.backupId];t.loadCount=1,t.link=t.link.replace(new RegExp("^"+l),i);let o=r.get(t.fileType);return void setTimeout(()=>o(t),n.time)}}t.stat=4}break;case 4:s("source error")}}));break;case 3:d(()=>{t.getPack(e).then(a)});break;case 4:s("source error")}})},y=e=>{let t,r=new Promise((r,a)=>{let s=[],{length:l}=e,n=l,i=[];e.forEach(async(e,o)=>{let c="succeed",h=await p(e).catch(t=>{c="error",Object.assign(e,{type:"error",descript:t}),i.push(e)});s[o]=h,t&&t({id:o,sum:n,ready:n-l+1,stat:c}),--l||(i.length?a(i):r(1==n?h:s),s=null)})});return r.post=function(t){return e.forEach(e=>e.data=t),this},r.pend=function(e){return t=e,this},r},m=e=>{let{str:t}=e;if(a.has(t)){let r=a.get(t);return Object.assign(e,{path:r.path,link:r.link,dir:r.dir}),e}let r=t.split(/\s/).filter(e=>e&&e),n=r.slice(1),o=r[0],c=o.match(/(.+)\?(\S+)$/)||"";c&&(o=c[1],c=c[2]);let{k:h,v:d}=g.cacheInfo;h&&d&&(c&&(c+="&"),c+=h+"="+d);let p=s.get(o);if(p)o=p;else for(let e in l){let t=l[e];if(t.reg.test(o)){o=o.replace(t.reg,t.value);break}}let y=(e=>{let t,r=e.split("/").pop().match(/(.+)\.(.+)/);return r&&(t=r[2]),t})(o)||"js";o=o.replace(new RegExp("\\."+y+"$"),"");let m;if(m=n.indexOf("-r")>-1||/^.+:\/\//.test(o)?o:/^\./.test(o)?e.relative?e.relative+o:o.replace(/^\.\//,""):i.baseUrl+o,n.includes("-pack")){let e=m.match(/(.+)\/(.+)/);2 in e&&(o=m=e[1]+"/"+e[2]+"/"+e[2])}/^.+:\/\//.test(m)||(m=f+m),m=m.replace(/\/\.\//,"/"),/\.\.\//.test(m)&&(m=(e=>{let t=[];return e.split(/\//g).forEach(e=>{".."==e&&t.length&&".."!=t.slice(-1)[0]?t.pop():t.push(e)}),t.join("/")})(m));let v=u(m+="."+y),b=c?m+"?"+c:m;return Object.assign(e,{link:b,search:c,ori:o,fileType:y,path:m,dir:v,param:n}),e};const v=(e,t)=>{let r=o();return e.map((e,a)=>m({loadId:o(),id:a,str:e,groupId:r,relative:t}))},g={load:(...e)=>y(v(e)),remove(e){let{path:t}=m({str:e});if(a.has(t))return a.delete(t),!0;console.warn(`pack %c${e}`,"color:red","does not exist")},has(e){let{path:t}=m({str:e}),r=a.get(t);return r&&r.stat},config(e){e.baseUrl&&(i.baseUrl=e.baseUrl);let t=e.paths;t&&Object.keys(t).forEach(e=>{/\/$/.test(e)?l[e]={reg:new RegExp("^"+e),value:t[e]}:s.set(e,t[e])}),i.baseUrl&&e.backups&&e.backups.forEach(e=>{n.backups.add(e)})},define(e,t){i.tempM={type:"define",d:e,moduleId:t}},task(e,t){i.tempM={type:"task",d:e,moduleId:t}},init(e,t){i.tempM={type:"init",d:e,moduleId:t}},ext(e,t){if(h(e))e(i);else{let r,a=(...e)=>t(e,r,i);switch(e){case"fixUrlObj":r=m,m=a;break;case"load":r=y,y=a;break;case"agent":r=p,p=a}}},cacheInfo:{k:"d_ver",v:""},debug:{bag:a},version:30100};e.load||(e.load=g.load),e.define||(e.define=g.define),e.task||(e.task=g.task),e.init||(e.init=g.init);let b=document.currentScript;if(!b&&(b=document.querySelector(["drill-cache"])),b){let e=b.getAttribute("drill-cache");e&&(g.cacheInfo.v=e)}let k=e.drill;Object.defineProperty(e,"drill",{get:()=>g,set(e){h(e)?e(g):console.error("drill type error =>",e)}}),k&&k(g)})(window),drill.ext("fixUrlObj",(e,t,r)=>{let a=t(...e);if("dcode"==a.fileType){let e=a.link.replace(/\.dcode(\??.*)/,".html$1");e&&(a.link=e)}return a}),drill.ext(e=>{let{loaders:t}=e;t.set("dcode",async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}let r=(await t.text()).match(/<body>([\d\D]*)<\/body>/);r&&(r=r[1]);let a=document.createElement("div");a.innerHTML=r;let s=a.querySelectorAll("[domcode]"),l={};s&&Array.from(s).forEach(e=>{let t=e.getAttribute("domcode");e.removeAttribute("domcode"),"none"==e.style.display&&(e.style.display=""),t&&(l[t]=e.outerHTML)});let n=Object.assign({},l);Object.keys(n).forEach(e=>{let t=n[e],r=document.createElement("div");r.innerHTML=t,n[e]=r.children[0].innerHTML}),e.getPack=(async e=>e.param.includes("-inner")?n:l),e.stat=3})}),e.XDFrame={drill:drill,$:$,version:1e4}})(window);