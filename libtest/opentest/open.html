<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>open test</title>
    <script src="../../dist/ofa.js"></script>
</head>

<body>

    <button onclick="openapp()" id="open_btn">窗口方式打开应用</button>
    <br>
    <br>
    <input type="text" id="msg_inpuer" value="start!" disabled>
    <button onclick="postdata()" id="msg_btn" disabled>发送数据</button>
    <br>
    <br>
    <div id="consoler" style="border:#aaa solid 1px;padding:10px;">返回的数据 ↓ <br>
    </div>
    <script>
        let targetApp;

        // 打开应用
        async function openapp() {

            $("#open_btn").attr("disabled", "");
            $("#msg_inpuer").attr("disabled", null);
            $("#msg_btn").attr("disabled", null);

            const open = await load("../../lib/open.js");

            // targetApp = await open("http://127.0.0.1:5500/index.html");
            targetApp = await open("./frameApp.html");

            targetApp.watchKey({
                closed(closed) {
                    if (closed) {
                        console.log("app close => ", targetApp);
                        targetApp = null;

                        $("#open_btn").attr("disabled", null);
                        $("#msg_inpuer").attr("disabled", "");
                        $("#msg_btn").attr("disabled", "");
                    }
                },
                message(msg) {
                    console.log("msg change => ", msg);
                }
            });

            targetApp.onmessage = (data) => {
                console.log("onmessage => ", data);

                $("#consoler").html += data + "<br>";
            }
        }

        let count = 1;
        function postdata() {
            targetApp.post($("#msg_inpuer").value);

            $("#msg_inpuer").value = 'start! ' + count++;
        }
    </script>
</body>

</html>